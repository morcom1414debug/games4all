<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>à¹€à¸à¸¡à¸«à¸¡à¸¹à¸«à¸¡à¸²à¹à¸¡à¸§ - à¸à¸¹à¸”à¸•à¸²à¸¡à¸à¸¢à¸²à¸‡à¸„à¹Œ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;800;900&display=swap');
        * { box-sizing: border-box; }
        body {
            margin: 0; font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            height: 100vh; color: #333; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }
        .container { width: 100%; max-width: 480px; padding: 15px; position: relative; }
        #backToMenu {
            position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.4);
            padding: 8px 20px; border: none; border-radius: 50px; color: #333; font-weight: 600;
            font-size: 1rem; cursor: pointer; backdrop-filter: blur(12px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1000; transition: all 0.3s;
        }
        #backToMenu:hover { background: rgba(255,255,255,0.6); }
        #levelSelect { text-align: center; }
        h1 { font-size: 2.8rem; margin: 0 0 10px; text-shadow: 0 4px 15px rgba(0,0,0,0.2); color: #d32f2f; }
        .subtitle { font-size: 1.3rem; margin-bottom: 12px; opacity: 0.9; color: #444; }
        .friendly-msg {
            font-size: 1.5rem; font-weight: 700;
            color: #e91e63; margin: 0 0 30px 0;
            text-shadow: 0 2px 8px rgba(233,30,99,0.3);
        }
        .level-buttons { display: flex; flex-direction: column; gap: 18px; align-items: center; }
        .level-btn {
            width: 80%; max-width: 320px; padding: 22px; font-size: 2.1rem; font-weight: 900;
            border: none; border-radius: 50px; cursor: pointer;
            box-shadow: 0 12px 30px rgba(0,0,0,0.25); transition: all 0.3s; color: white;
            background: linear-gradient(45deg, #ff5252, #ff8a65);
        }
        .level-btn:hover { transform: translateY(-8px) scale(1.06); }

        #game { display: none; text-align: center; position: relative; }
        .question-heading {
            font-size: 2.1rem; font-weight: 900; margin: 30px 20px 20px;
            padding: 16px; background: rgba(255,255,255,0.55);
            border-radius: 30px; backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); color: #c62828;
        }
        .typing-display {
            font-size: 3.8rem; font-weight: bold; min-height: 110px;
            margin: 30px 20px; color: #d81b60;
            background: rgba(255,255,255,0.45); padding: 25px; border-radius: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); letter-spacing: 0.08em;
        }
        #typedByPlayer {
            font-size: 1.5rem; color: #ad1457; margin: 20px 20px 50px;
            min-height: 2rem; font-weight: 600;
        }
        .lives {
            position: absolute; top: 60px; right: 20px;
            font-size: 2.2rem; font-weight: 900; color: #e53935;
            text-shadow: 0 2px 10px rgba(229,57,53,0.6);
        }
        #speakCue {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            font-size: 3.8rem; opacity: 0; pointer-events: none;
            transition: opacity 0.4s ease; text-shadow: 0 0 20px rgba(255,193,7,0.9);
            z-index: 5;
        }
        #speakCue.show { opacity: 1; }

        #voiceInputBtn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            padding: 12px 28px; font-size: 1.6rem; background: #43A047; color: white;
            border: none; border-radius: 50px; cursor: pointer;
            box-shadow: 0 6px 18px rgba(0,0,0,0.25); transition: all 0.3s;
        }
        #voiceInputBtn:hover { background: #2e7d32; transform: translate(-50%, -6px); }

        #success-celebration, #fail-celebration {
            position: absolute; inset: 0; pointer-events: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 6.5rem; opacity: 0; transform: scale(0.5);
            transition: all 0.7s ease-out; z-index: 10;
        }
        #success-celebration.show { opacity: 0.95; transform: scale(1.5) rotate(12deg); }
        #fail-celebration { color: #e74c3c; text-shadow: 0 0 20px rgba(231,76,60,0.8); }
        #fail-celebration.show { opacity: 0.92; transform: scale(1.45) rotate(-8deg); }

        #result { display: none; text-align: center; }
        #result h2 { font-size: 3.6rem; margin: 30px 0 15px; color: #c62828; }
        #resultMsg { font-size: 1.9rem; line-height: 1.55; margin: 25px 0; color: #444; }
        #score { font-size: 4.5rem; font-weight: 900; margin: 30px 0; color: #e91e63; }
        .btn-restart {
            padding: 18px 70px; font-size: 1.9rem; background: #ff7043;
            border: none; border-radius: 50px; color: white; cursor: pointer;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
        }
        .btn-restart:hover { transform: translateY(-6px); background: #f4511e; }
    </style>
</head>
<body>

<div class="container">
    <button id="backToMenu">à¸à¸¥à¸±à¸šà¹€à¸¡à¸™à¸¹à¸«à¸¥à¸±à¸</button>

    <div id="levelSelect">
        <h1>à¹€à¸à¸¡à¸«à¸¡à¸¹à¸«à¸¡à¸²à¹à¸¡à¸§</h1>
        <p class="subtitle">à¸à¸¹à¸”à¸•à¸²à¸¡à¹ƒà¸«à¹‰à¹€à¸›à¹Šà¸°à¸—à¸¸à¸à¸à¸¢à¸²à¸‡à¸„à¹Œ<br>à¸«à¸¡à¸¹ à¸«à¸¡à¸² à¹à¸¡à¸§ à¸«à¸¡à¸µ à¹„à¸à¹ˆ à¸à¸² à¹à¸à¸° à¸à¸š</p>
        <p class="friendly-msg">à¸à¸£à¹‰à¸­à¸¡à¹à¸¥à¹‰à¸§ à¸à¸¹à¸”à¹€à¸¥à¸¢!</p>
        
        <div class="level-buttons">
            <button class="level-btn" id="startGame">à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡</button>
        </div>
    </div>

    <div id="game">
        <div class="lives" id="livesDisplay">â¤ï¸â¤ï¸â¤ï¸</div>
        <div id="success-celebration">ğŸ‰âœ¨ğŸ·ğŸ¶ğŸ˜º</div>
        <div id="fail-celebration">ğŸ’¥âŒ</div>
        <div id="speakCue">ğŸ—£ï¸ à¸à¸¹à¸”à¹€à¸¥à¸¢!</div>

        <h2 class="question-heading" id="question">à¸‚à¹‰à¸­ 1 : ...</h2>
        <div class="typing-display" id="typingDisplay">_ _ _ _</div>
        <div id="typedByPlayer">à¹€à¸ªà¸µà¸¢à¸‡à¸—à¸µà¹ˆà¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¹„à¸”à¹‰ : -</div>
        <button id="voiceInputBtn">à¸à¸¹à¸”à¹€à¸¥à¸¢!</button>
    </div>

    <div id="question-live" aria-live="polite" aria-atomic="true"></div>

    <div id="result">
        <h2 id="resultTitle">à¸œà¸¥à¸à¸²à¸£à¹€à¸¥à¹ˆà¸™</h2>
        <div id="resultMsg"></div>
        <div id="score">0 à¸„à¸°à¹à¸™à¸™</div>
        <button class="btn-restart" id="restartBtn">à¹€à¸¥à¹ˆà¸™à¹ƒà¸«à¸¡à¹ˆ</button>
    </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//                  AUDIO ENGINE (à¸„à¸‡à¹€à¸”à¸´à¸¡)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class AudioEngine {
  constructor() {
    this.ctx = null;
    this.isUnlocked = false;
    this.bgmSource = null;
    this.bgmGain = null;
    this.bgmBuffer = null;
    this.currentEndPromise = null;

    this.sounds = {
      correctSound: "https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-reward-952.mp3",
      wrongSound: "https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-946.mp3",
      bgm: "audio/b3.mp3",
      doorSound: "audio/door.mp3",
      t1Sound: "audio/t1.mp3",
      tSound: "audio/t.mp3",
      t2Sound: "audio/t2.mp3",
      fSound: "audio/f.mp3",
      endSound: "audio/end.mp3",
      end1Sound: "audio/end1.mp3",
      speak: "audio/speak.mp3"
    };

    this.buffers = {};
  }

  async initContext() { /* ... à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ... */ 
    if (this.ctx) return;
    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    await this.loadAllBuffers();
  }

  async loadAllBuffers() { /* ... à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ... */ 
    const promises = Object.entries(this.sounds).map(async ([key, url]) => {
      try {
        const response = await fetch(url);
        const arrayBuffer = await response.arrayBuffer();
        const audioBuffer = await this.ctx.decodeAudioData(arrayBuffer);
        this.buffers[key] = audioBuffer;
      } catch (e) {
        console.warn(`Failed to load sound: ${key}`, e);
      }
    });
    await Promise.all(promises);
  }

  async unlockAll() { /* ... à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ... */ }
  async startBGM() { /* ... à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ... */ }
  stopBGM() { /* ... à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ... */ }
  async playEffect(key) { /* ... à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ... */ }
}

const audioEngine = new AudioEngine();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//                  à¸•à¸±à¸§à¹à¸›à¸£à¹€à¸à¸¡à¹ƒà¸«à¸¡à¹ˆ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const syllables = ["à¹„à¸à¹ˆ","à¸à¸²","à¹à¸à¸°","à¸à¸š","à¸«à¸¡à¸¹","à¸«à¸¡à¸²","à¹à¸¡à¸§","à¸«à¸¡à¸µ"];

let currentQuestions = [];
let currentQ = 0;
let score = 0;
let lives = 3;
let isProcessing = false;
let recognition = null;
let isListening = false;

let backBtn, levelSelect, gameDiv, resultDiv, questionElem, typingDisplay, 
    typedByPlayerDiv, livesDisplay, questionLive;

const LEVEL_RULES = [
  // [rounds, length, pointPerCorrect]
  [3,  4,  100],
  [3,  5,  200],
  [3,  6,  400],
  [3,  7,  800],
  [3,  8, 1600],
  [5, 10, 3200]
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//                  à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸¸à¹ˆà¸¡à¸à¸¢à¸²à¸‡à¸„à¹Œ (à¸«à¹‰à¸²à¸¡à¸•à¸´à¸”à¸à¸±à¸™)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateSequence(length) {
  if (length < 1) return "";
  
  let seq = [];
  let last = null;
  
  for (let i = 0; i < length; i++) {
    let candidate;
    do {
      candidate = syllables[Math.floor(Math.random() * syllables.length)];
    } while (candidate === last);
    
    seq.push(candidate);
    last = candidate;
  }
  
  return seq.join("");
}

// à¸ªà¸£à¹‰à¸²à¸‡à¸Šà¸¸à¸”à¸„à¸³à¸–à¸²à¸¡à¸—à¸±à¹‰à¸‡ 20 à¸‚à¹‰à¸­ (à¹€à¸£à¸µà¸¢à¸à¸•à¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡)
function generateAllQuestions() {
  const questions = [];
  let idx = 0;

  for (const [count, len, pts] of LEVEL_RULES) {
    for (let i = 0; i < count; i++) {
      const answer = generateSequence(len);
      questions.push({ 
        answer, 
        hint: answer, 
        points: pts,
        round: idx + 1 
      });
      idx++;
    }
  }
  return questions;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//                  à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startGame() {
  levelSelect.style.display = 'none';
  gameDiv.style.display = 'block';
  resultDiv.style.display = 'none';
  backBtn.style.display = 'none';

  currentQuestions = generateAllQuestions(); // à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸«à¸¡à¹ˆà¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡
  currentQ = 0;
  score = 0;
  lives = 3;
  isProcessing = false;

  updateLivesDisplay();
  audioEngine.startBGM();
  nextQuestion(true);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateLivesDisplay() {
  livesDisplay.textContent = "â¤ï¸".repeat(lives) + "â™¡".repeat(3 - lives);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function nextQuestion(isFirst = false) {
  if (currentQ >= currentQuestions.length) {
    endGame(true);
    return;
  }

  isProcessing = false;
  typedByPlayerDiv.textContent = "à¹€à¸ªà¸µà¸¢à¸‡à¸—à¸µà¹ˆà¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¹„à¸”à¹‰ : -";

  const item = currentQuestions[currentQ];
  const { answer, hint, round } = item;

  questionElem.innerHTML = `à¸‚à¹‰à¸­ ${currentQ+1} (${round}) : ${hint}`;
  typingDisplay.textContent = "_ ".repeat(answer.length).trim();

  questionLive.textContent = '';
  requestAnimationFrame(() => {
    questionLive.textContent = questionElem.textContent;
  });

  setTimeout(() => {
    questionElem.focus();
    setTimeout(async () => {
      await audioEngine.playEffect('speak');
      const cue = document.getElementById('speakCue');
      cue.classList.add('show');
      setTimeout(() => cue.classList.remove('show'), 1200);
      setTimeout(startVoiceRecognitionSafe, 400);
    }, 800);
  }, 100);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//                  Voice Recognition (à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = 'th-TH';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onstart = () => { isListening = true; };
  recognition.onend   = () => { isListening = false; };

  recognition.onresult = function(event) {
    isListening = false;
    let transcript = event.results[0][0].transcript || "";
    
    // à¸à¸£à¸­à¸‡à¹ƒà¸«à¹‰à¹€à¸«à¸¥à¸·à¸­à¹€à¸‰à¸à¸²à¸°à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¹„à¸—à¸¢ + à¸ªà¸£à¸° + à¸§à¸£à¸£à¸“à¸¢à¸¸à¸à¸•à¹Œ
    let cleaned = transcript.replace(/[^\u0E00-\u0E7F]/g, '');

    typingDisplay.textContent = cleaned;
    typedByPlayerDiv.textContent = 'à¹€à¸ªà¸µà¸¢à¸‡à¸—à¸µà¹ˆà¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¹„à¸”à¹‰ : ' + (cleaned || '(à¹„à¸¡à¹ˆà¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸š)');

    checkAnswer(cleaned);
  };

  recognition.onerror = function() {
    isListening = false;
    if (!isProcessing) handleWrong();
  };

  recognition.onspeechend = () => {
    recognition.stop();
    isListening = false;
  };
}

function startVoiceRecognitionSafe() {
  if (!recognition) return;
  try {
    recognition.start();
  } catch(e){}
}

function checkAnswer(spoken) {
  if (isProcessing) return;
  isProcessing = true;

  const correctAnswer = currentQuestions[currentQ].answer;

  if (spoken === correctAnswer) {
    // à¸–à¸¹à¸
    document.getElementById('success-celebration').classList.add('show');
    setTimeout(() => document.getElementById('success-celebration').classList.remove('show'), 900);

    score += currentQuestions[currentQ].points;
    audioEngine.playEffect('tSound');
    currentQ++;
    setTimeout(nextQuestion, 900);
  } else {
    handleWrong();
  }
}

async function handleWrong() {
  if (isProcessing) return;
  isProcessing = true;

  lives--;
  updateLivesDisplay();

  document.getElementById('fail-celebration').classList.add('show');
  setTimeout(() => document.getElementById('fail-celebration').classList.remove('show'), 800);

  await audioEngine.playEffect('wrongSound');
  await audioEngine.playEffect('fSound');

  // à¸à¸à¸à¸´à¹€à¸¨à¸©: à¸£à¸­à¸š 20 à¸œà¸´à¸” = à¹à¸à¹‰à¸—à¸±à¸™à¸—à¸µ
  if (currentQ === 19 || lives <= 0) {
    endGame(false);
  } else {
    currentQ++;
    setTimeout(nextQuestion, 900);
  }
}

async function endGame(isWin) {
  // à¸«à¸¢à¸¸à¸”à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡
  if (recognition) recognition.stop();
  audioEngine.stopBGM();

  gameDiv.style.display = 'none';
  resultDiv.style.display = 'block';
  backBtn.style.display = 'block';

  const title = document.getElementById('resultTitle');
  const msg = document.getElementById('resultMsg');
  const scoreDiv = document.getElementById('score');

  scoreDiv.textContent = score.toLocaleString() + " à¸„à¸°à¹à¸™à¸™";

  if (isWin && currentQ >= 20) {
    // à¸œà¹ˆà¸²à¸™à¸„à¸£à¸š 20 à¸‚à¹‰à¸­
    title.textContent = "à¸•à¸³à¸™à¸²à¸™à¸«à¸¡à¸¹à¸«à¸¡à¸²à¹à¸¡à¸§!";
    msg.innerHTML = "à¸„à¸¸à¸“à¸„à¸·à¸­à¹€à¸‹à¸µà¸¢à¸™à¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡!<br>à¸ªà¸¡à¸­à¸‡à¹à¸¥à¸°à¸›à¸²à¸à¸›à¸£à¸°à¸ªà¸²à¸™à¸à¸±à¸™à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œà¹à¸šà¸š<br>ğŸ·ğŸ¶ğŸ˜ºğŸ» à¹„à¸”à¹‰à¸¢à¸­à¸¡à¸ªà¸¢à¸šà¹à¸¥à¹‰à¸§!";
    await audioEngine.playEffect('endSound');
  } 
  else if (score >= 18000) {
    title.textContent = "à¸ªà¸¸à¸”à¸¢à¸­à¸”à¸¡à¸²à¸!";
    msg.innerHTML = "à¹€à¸à¸·à¸­à¸šà¹„à¸”à¹‰à¹€à¸›à¹‡à¸™à¸•à¸³à¸™à¸²à¸™à¹à¸¥à¹‰à¸§!<br>à¸­à¸µà¸à¸™à¸´à¸”à¹€à¸”à¸µà¸¢à¸§à¸«à¸¡à¸¹à¸«à¸¡à¸²à¹à¸¡à¸§à¸ˆà¸°à¸¢à¸­à¸¡à¸ªà¸¢à¸šà¹ƒà¸«à¹‰à¸„à¸¸à¸“ ğŸ’ªâœ¨";
    await audioEngine.playEffect('endSound');
  } 
  else if (score >= 8000) {
    title.textContent = "à¹€à¸à¹ˆà¸‡à¸¡à¸²à¸à¹€à¸¥à¸¢!";
    msg.innerHTML = "à¸£à¸°à¸”à¸±à¸šà¸ªà¸¹à¸‡à¹à¸¥à¹‰à¸§à¸™à¸°!<br>à¸«à¸¡à¸²à¹à¸¡à¸§à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸£à¸‡à¹ƒà¸ˆà¸„à¸¸à¸“à¹à¸¥à¹‰à¸§ ğŸ¶ğŸ˜º";
    await audioEngine.playEffect('endSound');
  } 
  else {
    title.textContent = "à¸ªà¸¹à¹‰à¸•à¹ˆà¸­à¹„à¸›à¸™à¸°!";
    msg.innerHTML = "à¸ªà¸™à¸¸à¸à¸”à¸µà¹€à¸™à¸­à¸° à¸¡à¸²à¸à¸¶à¸à¹ƒà¸«à¸¡à¹ˆà¸à¸±à¸™à¸­à¸µà¸à¸™à¸°<br>à¸„à¸£à¸±à¹‰à¸‡à¸«à¸™à¹‰à¸²à¸•à¹‰à¸­à¸‡à¹€à¸›à¹Šà¸°à¸à¸§à¹ˆà¸²à¸™à¸µà¹‰à¹à¸™à¹ˆ ğŸ·â¤ï¸";
    await audioEngine.playEffect('end1Sound');
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//                  Event Listeners
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  backBtn         = document.getElementById('backToMenu');
  levelSelect     = document.getElementById('levelSelect');
  gameDiv         = document.getElementById('game');
  resultDiv       = document.getElementById('result');
  questionElem    = document.getElementById('question');
  typingDisplay   = document.getElementById('typingDisplay');
  typedByPlayerDiv= document.getElementById('typedByPlayer');
  livesDisplay    = document.getElementById('livesDisplay');
  questionLive    = document.getElementById('question-live');

  document.getElementById('startGame').onclick = () => {
    audioEngine.unlockAll().then(startGame);
  };

  document.getElementById('restartBtn').onclick = () => {
    audioEngine.playEffect('doorSound');
    resultDiv.style.display = 'none';
    levelSelect.style.display = 'block';
    backBtn.style.display = 'block';
  };

  backBtn.onclick = () => {
    audioEngine.stopBGM();
    audioEngine.playEffect('doorSound');
    location.href = '../index.html';
  };

  // à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸à¸²à¸£à¸ªà¸±à¸¡à¸œà¸±à¸ª/à¸„à¸¥à¸´à¸
  const unlockAudio = () => audioEngine.unlockAll();
  document.addEventListener("touchstart", unlockAudio, {once:true, passive:true});
  document.addEventListener("click", unlockAudio, {once:true});
});
</script>
</body>
</html>