<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hades Echo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #1a1a1a;
            --text-color: #f0f0f0;
            --accent-color: #e50914;
            --button-bg: #333;
            --button-hover: #e50914;
            --message-bg: rgba(0, 0, 0, 0.7);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.6;
            position: relative; /* เพิ่มเพื่อตำแหน่งปุ่ม "กลับเมนูหลัก" */
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            background-color: #2c2c2c;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid var(--accent-color);
        }

        h1 {
            color: var(--accent-color);
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(229, 9, 20, 0.5);
        }

        #story-text {
            background-color: #383838;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 200px;
            text-align: center;
            font-size: 1.1em;
            border: 1px solid #555;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
            white-space: pre-wrap; /* Preserve whitespace and line breaks from JS */
        }

        .weapon-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .weapon-buttons button, #restart-button, #destroy-button, #start-button {
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 2px solid #555;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .weapon-buttons button:hover, #restart-button:hover, #destroy-button:hover, #start-button:hover {
            background-color: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5);
        }

        #start-button, #destroy-button, #restart-button {
            display: block;
            margin-top: 20px;
            background-color: var(--accent-color);
            color: white;
            border: none;
        }

        #message-box {
            background-color: var(--message-bg);
            color: var(--text-color);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            display: none; /* Hidden by default */
            margin-top: 10px;
        }

        /* Style for the "Back to Main Menu" button */
        #back-to-menu-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 2px solid #555;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        #back-to-menu-button:hover {
            background-color: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5);
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .weapon-buttons button, #restart-button, #destroy-button, #start-button {
                padding: 10px 20px;
                font-size: 1em;
            }

            #back-to-menu-button {
                top: 10px;
                left: 10px;
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>

<button id="back-to-menu-button">กลับเมนูหลัก</button>

<div class="game-container">
    <h1>Hades Echo</h1>
    <div id="story-text"></div>
    <div class="intro-buttons" id="intro-buttons">
        <button id="start-button">เริ่มเกม</button>
    </div>
    <div class="weapon-buttons" id="weapon-buttons" style="display: none;">
        <button id="knife-button">มีด</button>
        <button id="gun-button">ปืน</button>
        <button id="bomb-button">ระเบิด</button>
    </div>
    <div id="message-box"></div>
    <button id="destroy-button" style="display: none;">ทำลายคาสิโน</button>
    <button id="restart-button" style="display: none;">เริ่มใหม่</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
<script>
    // Game State and data
    let currentSceneIndex = -1; // -1 for intro scene
    let gameIsOver = false;

    // Game scenes and logic
    const introScene = {
        title: "ภารกิจลับ: เสียงเพรียกจากนรก",
        story: "ในโลกที่เต็มไปด้วยความมืดมิดและไร้กฎหมาย คุณเป็นสมาชิกของ 'ทีมเสียงสะท้อน' ได้รับคำสั่งให้แทรกซึมและทำลายคาสิโนเฮดีส ซึ่งเป็นฐานบัญชาการของ 'ยมทูต' ผู้นำอาชญากรรมระดับโลก\\n\\nเป้าหมายของคุณคือการใช้ความสามารถด้านเสียงในการนำทาง, รวบรวมข้อมูล, เผชิญหน้ากับศัตรูที่นำโดยมือสังหาร 'เงา', และกำจัดยมทูตในท้ายที่สุด\\n\\nพร้อมแล้วใช่ไหม? ภารกิจเริ่มต้นขึ้น!",
    };
    const scenes = [
        {
            title: "ฉาก 1: การแทรกซึม (The Infiltration)",
            story: "คุณต้องเคลื่อนที่ผ่านตรอกซอกซอยที่มืดมิดและเต็มไปด้วยสิ่งกีดขวาง และต้องกำจัดยามที่ลาดตระเวนโดยไม่ให้เกิดเสียงเพื่อแทรกซึมเข้าคาสิโน\\n\\n**ภารกิจ:** แทรกซึมอย่างเงียบๆ และกำจัดยามโดยไม่ให้เกิดเสียง",
            correctWeapon: 'knife',
            successMessage: "คุณใช้มีดจัดการยามอย่างเงียบเชียบ ไม่มีใครรู้ตัวว่าคุณเข้ามาได้สำเร็จ! ภารกิจสำเร็จ คุณสามารถไปต่อได้",
            failureMessage: "คุณเลือกใช้อาวุธที่มีเสียงดัง ยามได้ยินเสียงและโจมตีคุณทันที\\n\\n**ภารกิจล้มเหลว!**",
            successSound: 'knife',
            failureSound: 'gun'
        },
        {
            title: "ฉาก 2: การปะทะในห้องโถงคาสิโน (Casino Floor Showdown)",
            story: "คุณเข้าสู่ห้องโถงคาสิโนที่เต็มไปด้วยผู้คนและเสียงรบกวน คุณถูกนักฆ่ากลุ่มหนึ่งของยมทูตเข้าโจมตีทันที! คุณไม่มีทางเลือกอื่นนอกจากต้องต่อสู้กับนักค่ากรุ่มนี้\\n\\n**ภารกิจ:** กำจัดนักฆ่ากรุ่มนี้",
            correctWeapon: 'gun',
            successMessage: "คุณใช้ปืนยิงตอบโต้ได้อย่างแม่นยำและรวดเร็ว ทำลายกลุ่มนักฆ่าลงได้ทั้งหมด! ภารกิจสำเร็จ คุณสามารถไปต่อได้",
            failureMessage: "คุณเลือกใช้อาวุธที่ไม่เหมาะสมในการปะทะด้วยอาวุธปืน ทำให้คุณเสียเปรียบและถูกโจมตี\\n\\n**ภารกิจล้มเหลว!**",
            successSound: 'gun',
            failureSound: 'knife'
        },
        {
            title: "ฉาก 3: ห้องเซิร์ฟเวอร์ (The Server Room)",
            story: "คุณมาถึงห้องเซิร์ฟเวอร์ที่เต็มไปด้วยเสียงพัดลมและกระแสไฟฟ้า หัวหน้ากลุ่มแฮ็กเกอร์ 'เสียงกระซิบ' อยู่ที่นี่และใช้อุปกรณ์สร้างเสียงรบกวนเพื่อขัดขวางคุณ\\n\\n**ภารกิจ:** ทำลายเซิร์ฟเวอร์หลักและจัดการกับหัวหน้าแฮ็กเกอร์ที่ใช้อุปกรณ์สร้างเสียงรบกวน",
            correctWeapon: 'bomb',
            successMessage: "คุณใช้ระเบิดแสงเสียงสร้างเสียงดังสนั่น ทำให้แฮ็กเกอร์ชะงักและคุณจัดการเขาได้สำเร็จ! ภารกิจสำเร็จ คุณสามารถไปต่อได้",
            failureMessage: "คุณเลือกใช้อาวุธที่ไม่สร้างเสียงดังมากพอ ทำให้แฮ็กเกอร์ยังสามารถขัดขวางคุณได้ และคุณถูกโจมตี\\n\\n**ภารกิจล้มเหลว!**",
            successSound: 'bomb',
            failureSound: 'knife'
        },
        {
            title: "ฉาก 4: การเผชิญหน้ากับเงา (The Confrontation with the Shadow)",
            story: "คุณมาถึงทางเข้าห้องของยมทูต แต่ถูกขวางโดย 'เงา' มือสังหารที่ไร้ความปรานีและเป็นมือขวาของยมทูต เขาเคลื่อนที่ในความมืดมิดราวกับสายลมและใช้อาวุธในการโจมตีคุณทันทีที่คุณมาถึง\\n\\n**ภารกิจ:** เผชิญหน้ากับเงาและกำจัดเขาให้สำเร็จ",
            correctWeapon: 'gun',
            successMessage: "คุณใช้ปืนยิงตอบโต้การโจมตีของเงาได้อย่างรวดเร็วและแม่นยำ ทำให้เขาพลาดท่าและคุณจัดการเขาได้ในที่สุด! ภารกิจสำเร็จ คุณสามารถไปต่อได้",
            failureMessage: "คุณเลือกใช้อาวุธที่ไม่สามารถต่อสู้กับการโจมตีของเงาได้อย่างมีประสิทธิภาพ เขาโจมตีคุณอย่างรวดเร็วจากเงามืด\\n\\n**ภารกิจล้มเหลว!**",
            successSound: 'gun',
            failureSound: 'knife'
        },
        {
            title: "ฉาก 5: การเผชิญหน้ากับยมทูต (The Reaper's Lair)",
            story: "คุณมาถึงห้องทำงานส่วนตัวของ 'ยมทูต' เขานั่งอยู่บนโซฟาตัวยาว ในมือเขาถือแก้ววายเขาจิบวายอย่างสบายใจ\\nเขากล่าวทักทายคุณ สวัสดี **ยินดี**ต้อนรับสู่คาสิโนแห่งนี้ผมขอแสดงความดีใจด้วยที่คุณเข้ามาถึงห้องทำงานของผม\\nผมหวังว่าคนของผมจะให้การต้อนรับคุณเป็นอย่างดีนะ\\nและผมก็ต้องกล่าวคำว่าขอแสดงความเสียใจด้วยที่คุณจะไม่ได้กลับออกไปจากที่นี่\\nใครก็ตามที่เข้ามายุ่งกับคาสิโนเฮดีผมจะไม่ปล่อยให้มันมีชีวิตอยู่\\nเขาใช้อาวุดโจมตีคุณทันที\\n\\n**ภารกิจ:** กำจัดยมทูตและเปิดใช้งานระบบทำลายตัวเองของคาสิโน",
            correctWeapon: 'gun',
            successMessage: "คุณใช้ปืนยิงโจมตีอย่างรวดเร็ว ทำให้ยมทูตพลาดท่าและคุณสามารถจัดการเขาได้สำเร็จ!",
            failureMessage: "คุณเลือกใช้อาวุธที่ไม่สามารถเจาะผ่านการป้องกันของยมทูตได้ และถูกเขาโจมตีกลับ\\n\\n**ภารกิจล้มเหลว!**",
            successSound: 'gun',
            failureSound: 'bomb'
        }
    ];

    // Select DOM elements
    const storyTextElement = document.getElementById('story-text');
    const introButtonsElement = document.getElementById('intro-buttons');
    const weaponButtonsElement = document.getElementById('weapon-buttons');
    const messageBoxElement = document.getElementById('message-box');
    const startButton = document.getElementById('start-button');
    const destroyButton = document.getElementById('destroy-button');
    const restartButton = document.getElementById('restart-button');
    const backToMenuButton = document.getElementById('back-to-menu-button'); // Select the new button

    // Setup Tone.js sound generators
    let knifeSynth, gunSynth, bombSynth;
    let isAudioContextReady = false;

    // Function to create sound generators with improved sound design
    function setupSounds() {
        // Knife sound: layering for a more realistic slice and impact
        const knifeNoise = new Tone.NoiseSynth({
            noise: { type: 'white' },
            envelope: { attack: 0.001, decay: 0.05, sustain: 0, release: 0.01 }
        }).toDestination();
        const knifePluck = new Tone.PluckSynth({
            attackNoise: 1, dampening: 4000
        }).toDestination();
        
        knifeSynth = {
            trigger: () => {
                knifeNoise.triggerAttackRelease('32n');
                knifePluck.triggerAttackRelease("G5", "16n");
            }
        };

        // Gun sound: layering a burst of noise with a powerful synth for a heavy shot
        const gunNoise = new Tone.NoiseSynth({
            noise: { type: 'brown' },
            envelope: {
                attack: 0.001,
                decay: 0.2,
                sustain: 0,
                release: 0.05
            }
        }).toDestination();
        const gunKick = new Tone.MembraneSynth({
            pitchDecay: 0.005,
            octaves: 4,
            envelope: {
                attack: 0.001,
                decay: 0.6,
                sustain: 0,
                release: 0.02,
            }
        }).toDestination();
        const gunHeavy = new Tone.MembraneSynth({
            pitchDecay: 0.002,
            octaves: 10,
            envelope: {
                attack: 0.001,
                decay: 0.4,
                sustain: 0,
                release: 0.02
            }
        }).toDestination();

        gunSynth = {
            trigger: () => {
                gunNoise.triggerAttackRelease('16n');
                gunKick.triggerAttackRelease("C1");
                gunHeavy.triggerAttackRelease("C0");
            }
        };

        // Bomb sound: a big, deep impact with a high-frequency explosion and reverb
        const bombImpact = new Tone.MembraneSynth({
            pitchDecay: 0.002,
            octaves: 10,
            envelope: {
                attack: 0.001,
                decay: 1,
                sustain: 0,
                release: 0.1
            }
        });
        const bombReverb = new Tone.Reverb(2).toDestination();
        const bombNoise = new Tone.NoiseSynth({
            noise: { type: 'pink' },
            envelope: {
                attack: 0.05,
                decay: 0.3,
                sustain: 0.1,
                release: 0.5
            },
            filter: { type: 'highpass', frequency: 1000 }
        }).toDestination();

        bombImpact.connect(bombReverb);
        
        bombSynth = {
            trigger: () => {
                bombImpact.triggerAttackRelease("C0", "1n");
                bombNoise.triggerAttackRelease('1n');
            }
        };
    }

    // Play specific sounds based on the weapon choice
    function playSound(weapon) {
        if (!isAudioContextReady) {
            Tone.start();
            isAudioContextReady = true;
        }

        switch (weapon) {
            case 'knife':
                knifeSynth.trigger();
                break;
            case 'gun':
                gunSynth.trigger();
                break;
            case 'bomb':
                bombSynth.trigger();
                break;
        }
    }

    // Function to update the UI based on the current scene
    function updateUI() {
        if (currentSceneIndex === -1) {
            storyTextElement.textContent = `${introScene.title}\\n\\n${introScene.story}`;
            introButtonsElement.style.display = 'block';
            weaponButtonsElement.style.display = 'none';
            destroyButton.style.display = 'none';
            restartButton.style.display = 'none';
        } else if (currentSceneIndex < scenes.length) {
            const currentScene = scenes[currentSceneIndex];
            storyTextElement.textContent = `${currentScene.title}\\n\\n${currentScene.story}`;
            introButtonsElement.style.display = 'none';
            weaponButtonsElement.style.display = 'flex';
            destroyButton.style.display = 'none';
            restartButton.style.display = 'none';
            messageBoxElement.style.display = 'none';
        } else {
            // End of game, player has defeated the Reaper
            storyTextElement.textContent = "ภารกิจสำเร็จ! คุณได้เอาชนะยมทูตแล้ว ตอนนี้ถึงเวลาทำลายคาสิโนแห่งนี้ให้สิ้นซาก!";
            introButtonsElement.style.display = 'none';
            weaponButtonsElement.style.display = 'none';
            destroyButton.style.display = 'block';
            restartButton.style.display = 'none';
            messageBoxElement.style.display = 'none';
        }
    }

    // Function to handle player's weapon choice
    function handleChoice(weapon) {
        if (gameIsOver || currentSceneIndex >= scenes.length) {
            return;
        }

        const currentScene = scenes[currentSceneIndex];
        const isCorrect = (weapon === currentScene.correctWeapon);

        if (isCorrect) {
            // Correct choice
            playSound(currentScene.successSound);
            messageBoxElement.textContent = currentScene.successMessage;
            messageBoxElement.style.display = 'block';

            currentSceneIndex++;
            setTimeout(updateUI, 2000); // Delay for better user experience
        } else {
            // Incorrect choice, game over
            playSound(currentScene.failureSound);
            gameIsOver = true;
            messageBoxElement.textContent = currentScene.failureMessage;
            messageBoxElement.style.display = 'block';
            weaponButtonsElement.style.display = 'none';
            restartButton.style.display = 'block';
        }
    }

    // Function to handle the final destruction
    function handleDestroy() {
        storyTextElement.textContent = "ตูมมมมม! เสียงระเบิดดังก้องไปทั่วทั้งเมือง คาสิโนเฮดีสถูกทำลายสิ้นซาก ภารกิจสำเร็จ!\\n\\n**ขอแสดงความยินดี คุณได้ชนะเกมแล้ว!**";
        playSound('bomb');
        destroyButton.style.display = 'none';
        restartButton.style.display = 'block';
    }

    // Function to restart the game
    function restartGame() {
        currentSceneIndex = -1;
        gameIsOver = false;
        updateUI();
    }

    // Event listener for "Back to Main Menu" button
    backToMenuButton.addEventListener('click', () => {
        window.location.href = 'index.html'; // Redirect to index.html
    });

    // Add event listeners
    startButton.addEventListener('click', () => {
        currentSceneIndex = 0;
        updateUI();
    });
    document.getElementById('knife-button').addEventListener('click', () => handleChoice('knife'));
    document.getElementById('gun-button').addEventListener('click', () => handleChoice('gun'));
    document.getElementById('bomb-button').addEventListener('click', () => handleChoice('bomb'));
    destroyButton.addEventListener('click', handleDestroy);
    restartButton.addEventListener('click', restartGame);

    // Initialize the game
    window.onload = function() {
        setupSounds();
        updateUI();
    };
</script>
</body>
</html>
