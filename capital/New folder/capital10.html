<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ó‡∏≤‡∏¢‡∏™‡∏¥‡πä ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: #fafafa;
  text-align: center;
  padding: 20px;
}
#game, #lobby, #room, #quiz, #result { display: none; }
button {
  background: #4CAF50; color: white; border: none;
  padding: 10px 20px; margin: 5px; border-radius: 6px; cursor: pointer;
}
button:hover { background: #45a049; }
input { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
h2, h3, h1 { color: #333; }
ul { list-style: none; padding: 0; }
li { margin: 5px 0; }
</style>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
</head>
<body>
<h1 id="mainTitle" tabindex="0">‡∏ó‡∏≤‡∏¢‡∏™‡∏¥‡πä ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠</h1>

<div id="game">
  <div id="nameInput">
    <p>‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞</p>
    <input id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"><br>
    <button onclick="confirmName()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
  </div>

  <div id="lobby">
    <h2 id="lobbyTitle" tabindex="0">‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ</h2>
    <button onclick="showCreateRoom()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
    <h3>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà</h3>
    <ul id="roomList"></ul>
  </div>

  <div id="room">
    <h2 id="roomName" tabindex="0"></h2>
    <p>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á:</p>
    <ul id="playerList"></ul>
    <button id="startBtn" onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
  </div>

  <div id="quiz">
    <h2 id="questionText" tabindex="0"></h2>
    <div id="options"></div>
    <p id="timer"></p>
  </div>

  <div id="result">
    <h2 id="resultHeading" tabindex="0">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
    <ul id="scoreList"></ul>
    <button onclick="backToLobby()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBIPeN4YUIrwM4MmFtDvT2DJ-v4toxc7tY",
  authDomain: "xo-game-134ec.firebaseapp.com",
  projectId: "xo-game-134ec",
  storageBucket: "xo-game-134ec.firebasestorage.app",
  messagingSenderId: "318375224157",
  appId: "1:318375224157:web:3ae89d6c20452f1bb77eb4",
  databaseURL: "https://xo-game-134ec-default-rtdb.asia-southeast1.firebasedatabase.app/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let playerName="",roomId="",playerId="",isHost=false;
let questionIndex=0,timerInterval,timeLeft=20,localAnswered=false;
let currentRoomListener=null;
let waitAudio=null; // ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á wait.mp3 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•

// üß† ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
const questions = [
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà","‡∏™‡∏á‡∏Ç‡∏•‡∏≤"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡πÇ‡∏ï‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß","‡πÇ‡∏≠‡∏ã‡∏≤‡∏Å‡πâ‡∏≤","‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡πÇ‡∏ï"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡∏õ‡∏≤‡∏£‡∏µ‡∏™","‡∏°‡∏≤‡∏£‡πå‡∏Å‡πÄ‡∏ã‡∏¢‡πå","‡∏•‡∏µ‡∏¢‡∏á"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏à‡∏µ‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡∏õ‡∏±‡∏Å‡∏Å‡∏¥‡πà‡∏á","‡πÄ‡∏ã‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏Æ‡πâ","‡∏Å‡∏ß‡∏≤‡∏á‡πÇ‡∏à‡∏ß"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏™‡πÄ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡πÅ‡∏Ñ‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏≤","‡∏ã‡∏¥‡∏î‡∏ô‡∏µ‡∏¢‡πå","‡πÄ‡∏°‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ô"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ‡πÉ‡∏ï‡πâ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡πÇ‡∏ã‡∏•","‡∏õ‡∏π‡∏ã‡∏≤‡∏ô","‡πÅ‡∏ó‡∏Å‡∏π"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏°‡∏≤‡πÄ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡∏Å‡∏±‡∏ß‡∏•‡∏≤‡∏•‡∏±‡∏°‡πÄ‡∏õ‡∏≠‡∏£‡πå","‡∏õ‡∏µ‡∏ô‡∏±‡∏á","‡∏¢‡∏∞‡πÇ‡∏Æ‡∏£‡πå‡∏ö‡∏≤‡∏´‡πå‡∏£‡∏π"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢","‡πÇ‡∏Æ‡∏à‡∏¥‡∏°‡∏¥‡∏ô‡∏´‡πå‡∏ã‡∏¥‡∏ï‡∏µ‡πâ","‡∏î‡∏≤‡∏ô‡∏±‡∏á"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÇ‡∏î‡∏ô‡∏µ‡πÄ‡∏ã‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡∏à‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏≤","‡∏ö‡∏≤‡∏´‡∏•‡∏µ","‡∏™‡∏∏‡∏£‡∏≤‡∏ö‡∏≤‡∏¢‡∏≤"], answer:0 },
  { q:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options:["‡∏ô‡∏¥‡∏ß‡πÄ‡∏î‡∏•‡∏µ","‡∏°‡∏∏‡∏°‡πÑ‡∏ö","‡∏Å‡∏±‡∏•‡∏Å‡∏±‡∏ï‡∏ï‡∏≤"], answer:0 }
];

document.getElementById("game").style.display="block";

// üéµ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
function playSound(name){
  const audio = new Audio(`audio/${name}.mp3`);
  audio.play().catch(()=>{});
  return audio;
}

function focusHeading(id){
  const el=document.getElementById(id);
  if(el){ el.focus(); }
}

function confirmName(){
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName){alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠");return;}
  playerId=Math.random().toString(36).substr(2,9);
  document.getElementById("nameInput").style.display="none";
  document.getElementById("lobby").style.display="block";
  focusHeading("lobbyTitle");
  loadRooms();
}

function loadRooms(){
  const list=document.getElementById("roomList");
  db.ref("guessGameRooms").on("value",snap=>{
    list.innerHTML="";
    snap.forEach(r=>{
      const room=r.val();
      if(room.status==="waiting"){
        const li=document.createElement("li");
        li.textContent=`${room.name} (${room.players?Object.keys(room.players).length:0} ‡∏Ñ‡∏ô)`;
        const btn=document.createElement("button");
        btn.textContent="‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°";
        btn.onclick=()=>joinRoom(r.key);
        li.appendChild(btn);
        list.appendChild(li);
      }
    });
  });
}

function showCreateRoom(){
  const name=prompt("‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á:");
  if(!name) return;
  const ref=db.ref("guessGameRooms").push();
  roomId=ref.key; isHost=true;
  ref.set({name,status:"waiting",host:playerId,created:Date.now(),players:{}});
  joinRoom(roomId);
}

function joinRoom(id){
  roomId=id;
  const ref=db.ref(`guessGameRooms/${roomId}/players/${playerId}`);
  ref.set({name:playerName,score:0,answered:false});
  ref.onDisconnect().remove();

  // ‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
  db.ref(`guessGameRooms/${roomId}/lastJoin`).set(Date.now());

  showRoom();
}

function showRoom(){
  document.getElementById("lobby").style.display="none";
  document.getElementById("room").style.display="block";
  focusHeading("roomName");

  if(currentRoomListener) currentRoomListener.off();
  currentRoomListener=db.ref(`guessGameRooms/${roomId}`);
  currentRoomListener.on("value",snap=>{
    const room=snap.val();
    if(!room){alert("‡∏´‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");backToLobby();return;}
    document.getElementById("roomName").textContent=`‡∏´‡πâ‡∏≠‡∏á: ${room.name}`;
    const list=document.getElementById("playerList"); list.innerHTML="";
    for(let id in room.players){
      const li=document.createElement("li");
      li.textContent=`${room.players[id].name} (${room.players[id].score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)`;
      list.appendChild(li);
    }

    const startBtn=document.getElementById("startBtn");
    startBtn.style.display=room.host===playerId?"inline":"none";

    // üéµ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô friend.mp3
    if(room.lastJoin && (!window._lastJoinTime || room.lastJoin !== window._lastJoinTime)){
      window._lastJoinTime = room.lastJoin;
      playSound("friend");
    }

    if(room.status==="playing") startQuiz();
    else if(room.status==="finished") showResult(room);
  });
}

function startGame(){
  playSound("start"); // üéµ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
  db.ref(`guessGameRooms/${roomId}`).update({
    status:"playing", current:0, questions:getRandomQuestions(7)
  });
}

function getRandomQuestions(n){
  const copy=[...questions];
  const res=[];
  for(let i=0;i<n;i++){
    const idx=Math.floor(Math.random()*copy.length);
    let q=copy.splice(idx,1)[0];
    const opts=[...q.options];
    const correctText=opts[q.answer];
    shuffleArray(opts);
    q.answer=opts.indexOf(correctText);
    q.options=opts;
    res.push(q);
  }
  return res;
}

function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function startQuiz(){
  document.getElementById("room").style.display="none";
  document.getElementById("quiz").style.display="block";
  document.getElementById("mainTitle").style.display="none";
  db.ref(`guessGameRooms/${roomId}`).once("value").then(snap=>{
    const data=snap.val();
    questionIndex=data.current||0;
    showQuestion(data.questions[questionIndex]);
  });
}

function showQuestion(q){
  if(!q){ if(isHost) endGameHost(); return; }
  localAnswered=false;
  timeLeft=Math.floor(Math.random()*11)+15;
  document.getElementById("questionText").textContent=`‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${questionIndex+1}: ${q.q}`;
  focusHeading("questionText");
  const opts=document.getElementById("options");
  opts.innerHTML="";
  q.options.forEach((opt,i)=>{
    const b=document.createElement("button");
    b.textContent=opt;
    b.onclick=()=>submitAnswer(i);
    opts.appendChild(b);
  });
  document.getElementById("timer").textContent=`‡πÄ‡∏ß‡∏•‡∏≤: ${timeLeft}`;
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent=`‡πÄ‡∏ß‡∏•‡∏≤: ${timeLeft}`;
    if(timeLeft<=0){ clearInterval(timerInterval); nextQuestion(); }
  },1000);
}

function submitAnswer(index){
  if(localAnswered) return;
  localAnswered=true;
  playSound("pop"); // üéµ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö

  db.ref(`guessGameRooms/${roomId}`).once("value").then(snap=>{
    const data=snap.val();
    const q=data.questions[data.current];
    const correct=(index===q.answer);
    if(correct){
      db.ref(`guessGameRooms/${roomId}/players/${playerId}/score`).transaction(v=>(v||0)+1);
    }
    db.ref(`guessGameRooms/${roomId}/players/${playerId}/answered`).set(true);
    checkAllAnswered();
  });
}

function checkAllAnswered(){
  db.ref(`guessGameRooms/${roomId}`).once("value").then(snap=>{
    const data=snap.val();
    const players=data.players||{};
    const allAnswered=Object.values(players).every(p=>p.answered);
    if(allAnswered){
      clearInterval(timerInterval);
      setTimeout(()=>playSound("next"),500); // üéµ ‡πÄ‡∏•‡πà‡∏ô next ‡∏´‡∏•‡∏±‡∏á pop ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
      nextQuestion();
    }
  });
}

function nextQuestion(){
  db.ref(`guessGameRooms/${roomId}`).once("value").then(snap=>{
    const data=snap.val();
    if(!data) return;
    const players=data.players||{};
    for(let id in players)
      db.ref(`guessGameRooms/${roomId}/players/${id}/answered`).set(false);
    const next=data.current+1;

    if(next<data.questions.length){
      db.ref(`guessGameRooms/${roomId}`).update({current:next});
      questionIndex=next;
      showQuestion(data.questions[next]);
    }else{
      // üéµ ‡∏´‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 7 ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö -> ‡πÄ‡∏•‡πà‡∏ô wait.mp3
      waitAudio = playSound("wait");
      if(isHost) endGameHost();
    }
  });
}

// ‚úÖ Host ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® finished
function endGameHost(){
  clearInterval(timerInterval);
  db.ref(`guessGameRooms/${roomId}`).once("value").then(snap=>{
    const room=snap.val();
    if(!room || !room.players) return;
    const players=Object.values(room.players);
    players.sort((a,b)=>b.score-a.score);
    const max=players[0].score;
    const winners=players.filter(p=>p.score===max).map(p=>p.name);

    db.ref(`guessGameRooms/${roomId}`).update({
      status:"finished",
      result:{winners,players}
    });
  });
}

// ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ
function showResult(roomData){
  clearInterval(timerInterval);
  document.getElementById("quiz").style.display="none";
  document.getElementById("result").style.display="block";
  document.getElementById("mainTitle").style.display="none";

  // üéµ ‡∏´‡∏¢‡∏∏‡∏î wait.mp3 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡πà‡∏ô new4.mp3 ‡∏ï‡πà‡∏≠
  if(waitAudio){ waitAudio.pause(); waitAudio=null; }
  playSound("new4");

  const list=document.getElementById("scoreList");
  list.innerHTML="";

  const players=roomData.result?.players || [];
  const winners=roomData.result?.winners || [];

  document.getElementById("resultHeading").textContent=
    `‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏∑‡∏≠ ${winners.join(", ")}`;

  players.forEach(p=>{
    const li=document.createElement("li");
    li.textContent=`${p.name}: ${p.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
    list.appendChild(li);
  });

  focusHeading("resultHeading");
}

function backToLobby(){
  playSound("start"); // üéµ ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
  if(currentRoomListener){ currentRoomListener.off(); currentRoomListener=null; }
  db.ref(`guessGameRooms/${roomId}/players/${playerId}`).remove();
  roomId="";
  questionIndex=0;
  document.getElementById("result").style.display="none";
  document.getElementById("room").style.display="none";
  document.getElementById("quiz").style.display="none";
  document.getElementById("mainTitle").style.display="block";
  document.getElementById("lobby").style.display="block";
  focusHeading("lobbyTitle");
  loadRooms();
}

// üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
setInterval(()=>{
  db.ref("guessGameRooms").once("value").then(snap=>{
    snap.forEach(r=>{
      const data=r.val();
      if(!data.players || Object.keys(data.players).length===0){
        db.ref(`guessGameRooms/${r.key}`).remove();
      }
    });
  });
},300000);
</script>
</body>
</html>
