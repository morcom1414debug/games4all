<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏ó‡∏≤‡∏¢‡∏™‡∏¥‡πä ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ (‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</title>
<style>
  body { font-family: "Tahoma", sans-serif; background: #fff8ec; text-align: center; margin: 0; padding: 20px; }
  h1 { color: #ff6600; }
  #game-container { max-width: 550px; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 0 10px #ccc; }
  input, button { margin: 10px; padding: 10px; border-radius: 10px; border: 1px solid #ccc; }
  button { background: #ff6600; color: white; font-size: 16px; border: none; cursor: pointer; }
  button:hover { background: #ff884d; }
  .choice { display: block; margin: 8px auto; padding: 10px; width: 80%; border: 2px solid #ff6600; border-radius: 10px; background: #fffaf0; cursor: pointer; }
  .choice:hover { background: #ffe6cc; }
  #timer { color: #ff3300; font-weight: bold; }
</style>
</head>
<body>
<div id="game-container">
  <h1>üéØ ‡∏ó‡∏≤‡∏¢‡∏™‡∏¥‡πä ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ üéØ</h1>
  <div id="login">
    <p>‡∏°‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ô‡∏ô‡∏∞ ‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÜ‡∏à‡∏∞‡∏£‡∏π‡πâ‡πÉ‡∏à‡∏â‡∏±‡∏ô‡πÑ‡∏´‡∏°</p>
    <input type="text" id="playerName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
    <br>
    <button onclick="enterLobby()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
  </div>

  <div id="lobby" style="display:none;">
    <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á</h2>
    <button onclick="createRoom()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
    <h3>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</h3>
    <div id="roomsList"></div>
  </div>

  <div id="room" style="display:none;">
    <h2>‡∏´‡πâ‡∏≠‡∏á: <span id="roomNameDisplay"></span></h2>
    <p>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á:</p>
    <ul id="players"></ul>
    <button id="startBtn" onclick="startGame()" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
  </div>

  <div id="quiz" style="display:none;">
    <h2 id="question"></h2>
    <div id="choices"></div>
    <p>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="timer">30</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
  </div>

  <div id="result" style="display:none;">
    <h2>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>
    <p id="score"></p>
    <button onclick="location.reload()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>
<script>
// ---------- Firebase ----------
const firebaseConfig = {
  apiKey: "AIzaSyBIPeN4YUIrwM4MmFtDvT2DJ-v4toxc7tY",
  authDomain: "xo-game-134ec.firebaseapp.com",
  projectId: "xo-game-134ec",
  storageBucket: "xo-game-134ec.firebasestorage.app",
  messagingSenderId: "318375224157",
  appId: "1:318375224157:web:3ae89d6c20452f1bb77eb4",
  databaseURL: "https://xo-game-134ec-default-rtdb.asia-southeast1.firebasedatabase.app/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const GAME_PATH = "guess_game_rooms"; // ‡πÉ‡∏ä‡πâ path ‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°‡∏≠‡∏∑‡πà‡∏ô

// ---------- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å ----------
let playerName = "";
let playerId = "";
let roomName = "";
let isHost = false;
let currentQ = 0;
let score = 0;
let timer = null;
let timeLeft = 30;
let questions = [];

// ---------- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ----------
const allQuestions = [
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û", c: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà","‡∏™‡∏á‡∏Ç‡∏•‡∏≤"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡πÇ‡∏ï‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß", c: ["‡πÇ‡∏≠‡∏ã‡∏≤‡∏Å‡πâ‡∏≤","‡πÇ‡∏ï‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß","‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡πÇ‡∏ï"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡∏õ‡∏≤‡∏£‡∏µ‡∏™", c: ["‡∏õ‡∏≤‡∏£‡∏µ‡∏™","‡∏•‡∏µ‡∏¢‡∏á","‡∏°‡∏≤‡∏£‡πå‡∏Å‡πÄ‡∏ã‡∏¢‡πå"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏™‡πÄ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡πÅ‡∏Ñ‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏≤", c: ["‡∏ã‡∏¥‡∏î‡∏ô‡∏µ‡∏¢‡πå","‡πÅ‡∏Ñ‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏≤","‡πÄ‡∏°‡∏•‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏ô"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏à‡∏µ‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡∏õ‡∏±‡∏Å‡∏Å‡∏¥‡πà‡∏á", c: ["‡∏õ‡∏±‡∏Å‡∏Å‡∏¥‡πà‡∏á","‡πÄ‡∏ã‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏Æ‡πâ","‡∏Å‡∏ß‡∏≤‡∏á‡πÇ‡∏à‡∏ß"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡∏ô‡∏¥‡∏ß‡πÄ‡∏î‡∏•‡∏µ", c: ["‡∏ô‡∏¥‡∏ß‡πÄ‡∏î‡∏•‡∏µ","‡∏°‡∏∏‡∏°‡πÑ‡∏ö","‡πÇ‡∏Å‡∏•‡∏Å‡∏≤‡∏ï‡∏≤"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ‡πÉ‡∏ï‡πâ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡πÇ‡∏ã‡∏•", c: ["‡∏õ‡∏π‡∏ã‡∏≤‡∏ô","‡πÅ‡∏ó‡∏Å‡∏π","‡πÇ‡∏ã‡∏•"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡∏°‡∏≠‡∏™‡πÇ‡∏Å", c: ["‡∏°‡∏≠‡∏™‡πÇ‡∏Å","‡πÄ‡∏ã‡∏ô‡∏ï‡πå‡∏õ‡∏µ‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏Å","‡∏Ñ‡∏≤‡∏ã‡∏≤‡∏ô"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏µ‡∏¢‡∏¥‡∏õ‡∏ï‡πå‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡πÑ‡∏Ñ‡πÇ‡∏£", c: ["‡πÑ‡∏Ñ‡πÇ‡∏£","‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏ã‡∏≤‡∏ô‡πÄ‡∏î‡∏£‡∏µ‡∏¢","‡∏Å‡∏¥‡∏ã‡∏≤"] },
  { q: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡∏ß‡∏≠‡∏ä‡∏¥‡∏á‡∏ï‡∏±‡∏ô ‡∏î‡∏µ.‡∏ã‡∏µ.", c: ["‡∏ô‡∏¥‡∏ß‡∏¢‡∏≠‡∏£‡πå‡∏Å","‡∏ß‡∏≠‡∏ä‡∏¥‡∏á‡∏ï‡∏±‡∏ô ‡∏î‡∏µ.‡∏ã‡∏µ.","‡∏•‡∏≠‡∏™‡πÅ‡∏≠‡∏ô‡πÄ‡∏à‡∏•‡∏¥‡∏™"] }
];

// ---------- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å ----------
function enterLobby() {
  playerName = document.getElementById("playerName").value.trim();
  if (!playerName) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô!"); return; }
  playerId = "P" + Math.random().toString(36).substr(2,9);
  document.getElementById("login").style.display = "none";
  document.getElementById("lobby").style.display = "block";
  loadRooms();
}

// ---------- ‡∏™‡∏£‡πâ‡∏≤‡∏á / ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á ----------
function createRoom() {
  const newName = prompt("‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á:");
  if (!newName) return;
  const ref = db.ref(`${GAME_PATH}/${newName}`);
  ref.once("value").then(snapshot => {
    if (snapshot.exists()) {
      alert("‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!");
    } else {
      roomName = newName;
      isHost = true;
      ref.set({
        createdAt: Date.now(),
        started: false,
        players: { [playerId]: playerName }
      });
      joinRoom(roomName);
    }
  });
}

function loadRooms() {
  const ref = db.ref(GAME_PATH);
  ref.on("value", snap => {
    const data = snap.val() || {};
    const list = document.getElementById("roomsList");
    list.innerHTML = "";
    Object.keys(data).forEach(room => {
      const info = data[room];
      if (info.started) return; // ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤
      const div = document.createElement("div");
      div.textContent = `${room} (${Object.keys(info.players || {}).length} ‡∏Ñ‡∏ô)`;
      div.style.margin = "8px";
      const btn = document.createElement("button");
      btn.textContent = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°";
      btn.onclick = () => joinRoom(room);
      div.appendChild(btn);
      list.appendChild(div);
    });
  });
}

// ---------- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á ----------
function joinRoom(name) {
  roomName = name;
  const ref = db.ref(`${GAME_PATH}/${roomName}/players/${playerId}`);
  ref.set(playerName);
  ref.onDisconnect().remove();
  document.getElementById("lobby").style.display = "none";
  document.getElementById("room").style.display = "block";
  document.getElementById("roomNameDisplay").textContent = roomName;

  const roomRef = db.ref(`${GAME_PATH}/${roomName}/players`);
  roomRef.on("value", s => {
    const data = s.val() || {};
    const list = document.getElementById("players");
    list.innerHTML = "";
    Object.values(data).forEach(n => {
      const li = document.createElement("li");
      li.textContent = n;
      list.appendChild(li);
    });
    const keys = Object.keys(data);
    if (keys[0] === playerId) {
      isHost = true;
      document.getElementById("startBtn").disabled = false;
    } else if (!keys.includes(playerId)) {
      location.reload(); // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏î‡∏ô‡πÄ‡∏ï‡∏∞/‡∏´‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
    }
  });

  const startRef = db.ref(`${GAME_PATH}/${roomName}/started`);
  startRef.on("value", snap => {
    if (snap.val() === true) {
      startGameClient();
    }
  });
}

// ---------- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ----------
function startGame() {
  if (!isHost) return;
  const ref = db.ref(`${GAME_PATH}/${roomName}`);
  ref.update({
    started: true,
    questions: shuffle(allQuestions).slice(0,7)
  });
}

function startGameClient() {
  document.getElementById("room").style.display = "none";
  document.getElementById("quiz").style.display = "block";
  db.ref(`${GAME_PATH}/${roomName}/questions`).once("value").then(s => {
    questions = s.val() || [];
    currentQ = 0;
    score = 0;
    showQuestion();
  });
}

// ---------- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ----------
function showQuestion() {
  if (currentQ >= questions.length) return endGame();
  const q = questions[currentQ];
  document.getElementById("question").textContent = `${currentQ+1}. ${q.q}`;
  const div = document.getElementById("choices");
  div.innerHTML = "";
  shuffle(q.c).forEach(choice => {
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.textContent = choice;
    btn.onclick = () => selectAnswer(choice, q.a);
    div.appendChild(btn);
  });
  timeLeft = 30;
  document.getElementById("timer").textContent = timeLeft;
  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      nextQuestion();
    }
  }, 1000);
}

function selectAnswer(ch, correct) {
  clearInterval(timer);
  if (ch === correct) score++;
  nextQuestion();
}

function nextQuestion() {
  currentQ++;
  showQuestion();
}

function endGame() {
  clearInterval(timer);
  document.getElementById("quiz").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("score").textContent = `${playerName} ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${score} ‡∏à‡∏≤‡∏Å ${questions.length} ‡∏Ç‡πâ‡∏≠`;
  db.ref(`${GAME_PATH}/${roomName}/players/${playerId}`).update({ score });
}

// ---------- Utility ----------
function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

// ---------- ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤ ----------
setInterval(() => {
  db.ref(GAME_PATH).once("value").then(s => {
    const data = s.val() || {};
    Object.keys(data).forEach(r => {
      const info = data[r];
      if (!info.players || Object.keys(info.players).length === 0) {
        db.ref(`${GAME_PATH}/${r}`).remove();
      }
    });
  });
}, 300000); // ‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
</script>
</body>
</html>
