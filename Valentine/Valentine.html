<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine Love Bingo 3D - 10 Cards Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Kanit', sans-serif; background-color: #fff0f5; }
        canvas { display: block; }
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
        }
        .pointer-auto { pointer-events: auto; }
        .minecraft-panel {
            background: rgba(255, 255, 255, 0.9);
            border: 4px solid #ff69b4;
            box-shadow: 4px 4px 0px #db7093;
        }
        .minecraft-btn {
            background: #ff69b4;
            border: 4px solid #fff;
            box-shadow: 4px 4px 0px #c71585;
            transition: all 0.1s;
            cursor: pointer;
        }
        .minecraft-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #c71585;
        }
        .bingo-chip {
            padding: 4px 10px;
            margin: 2px;
            border-radius: 4px;
            font-size: 0.9rem;
            display: inline-block;
            border: 2px solid transparent;
        }
        .chip-match {
            background: #ffedf5;
            color: #d01070;
            border-color: #ff69b4;
            font-weight: bold;
        }
        .chip-miss {
            background: #f3f4f6;
            color: #6b7280;
            border-color: #d1d5db;
        }
        .rainbow-animate {
            background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
            background-size: 200% 200%;
            animation: rainbow 3s linear infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
    </style>
</head>
<body>

<div id="ui-layer">
    <!-- Top HUD -->
    <div class="flex flex-col md:flex-row justify-between items-start gap-4">
        <!-- Target Info -->
        <div class="minecraft-panel p-4 w-full md:max-w-md pointer-auto shadow-xl">
            <h1 class="text-xl font-bold text-pink-600 mb-2 flex items-center">
                <span class="mr-2">
??
</span> Valentine Bingo 3D
            </h1>
            
            <div class="mb-4">
                <p class="text-xs text-gray-500 font-bold uppercase">?????????????????????:</p>
                <div id="target-category" class="text-3xl font-bold text-purple-600 rainbow-animate">??????????</div>
            </div>

            <!-- List of the 10 current cards -->
            <div class="bg-white/50 p-3 rounded border-2 border-pink-200">
                <p class="text-xs text-pink-500 font-bold mb-2 uppercase">???????????? 10 ??????????:</p>
                <div id="card-status-list" class="flex flex-wrap min-h-[60px] content-start">
                    <span class="text-gray-400 text-sm italic">???????????...</span>
                </div>
            </div>
        </div>

        <!-- Score Box -->
        <div class="minecraft-panel p-4 text-center min-w-[140px] shadow-xl pointer-auto self-end md:self-start">
            <p class="text-xs text-gray-700 font-bold uppercase mb-1">?????????</p>
            <div id="score" class="text-6xl font-bold text-pink-600">0</div>
        </div>
    </div>

    <!-- Center Message -->
    <div class="text-center">
        <div id="status-msg" class="bg-white/90 px-8 py-3 rounded-full inline-block border-4 border-pink-300 text-pink-500 font-bold text-lg shadow-2xl">
            ???????????? 10 ???????????????
        </div>
    </div>

    <!-- Controls -->
    <div class="flex justify-center pb-10">
        <button id="shuffle-btn" class="pointer-auto minecraft-btn text-white text-3xl px-16 py-5 rounded-none font-bold">
            ?????? 10 ??! 
??

        </button>
    </div>
</div>

<script>
    // --- ??????????? 3 ???? ---
    const categories = [
        {
            name: "??????",
            words: ["???", "?????", "?????", "?????????", "?????", "?????", "????????", "?????", "?????", "??????"]
        },
        {
            name: "??????",
            words: ["?????", "??????", "?????", "????", "????", "?????????", "???", "????", "???", "???????"]
        },
        {
            name: "English Valentine",
            words: ["Honey", "Chocolate", "Flower", "Rose", "Heart", "Candy", "Sugar", "Love", "Pink", "Sweet"]
        }
    ];

    const allWords = [];
    categories.forEach(cat => {
        cat.words.forEach(word => {
            allWords.push({ text: word, category: cat.name });
        });
    });

    // --- ????????? (Web Audio API) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playMagicBell(freq = 880, type = 'triangle') {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(freq * 1.5, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.5);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 1.5);
    }

    function playShuffleSound() {
        [440, 554, 659].forEach((f, i) => {
            setTimeout(() => playMagicBell(f, 'sine'), i * 120);
        });
    }

    function playBingoPointSound() {
        playMagicBell(1174.66, 'triangle'); // D6
        setTimeout(() => playMagicBell(1396.91, 'triangle'), 100); // F6
        setTimeout(() => playMagicBell(1760.00, 'triangle'), 200); // A6
    }

    // --- 3D Minecraft Scene ---
    let scene, camera, renderer, cards = [];
    let isShuffling = false;

    function init3D() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xfff0f5);
        scene.fog = new THREE.Fog(0xfff0f5, 10, 60);

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 14);
        camera.lookAt(0, 0, 0);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.DirectionalLight(0xffffff, 0.8);
        sun.position.set(5, 12, 8);
        sun.castShadow = true;
        scene.add(sun);

        // Ground Minecraft style
        const ground = new THREE.Mesh(
            new THREE.BoxGeometry(100, 1, 100),
            new THREE.MeshPhongMaterial({ color: 0xffe4e1 })
        );
        ground.position.y = -4;
        ground.receiveShadow = true;
        scene.add(ground);

        // Decorative floating hearts
        for(let i=0; i<25; i++) {
            const h = new THREE.Mesh(
                new THREE.BoxGeometry(0.8, 0.8, 0.
??
,
                new THREE.MeshPhongMaterial({ color: 0xff69b4 })
            );
            h.position.set(Math.random()*40-20, Math.random()*10-2, Math.random()*-20-5);
            scene.add(h);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        animate();
    }

    function createCardMesh(wordObj, index) {
        // Minecraft Block Card
        const geometry = new THREE.BoxGeometry(2.2, 3.2, 0.4);
        const canvas = document.createElement('canvas');
        canvas.width = 256; canvas.height = 384;
        const ctx = canvas.getContext('2d');
        
        // Card Front Design
        ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,256,384);
        ctx.strokeStyle = '#ff69b4'; ctx.lineWidth = 20; ctx.strokeRect(10,10,236,364);
        
        // Rainbow Heart
        ctx.font = '60px serif'; ctx.textAlign = 'center';
        ctx.fillText('
??
', 128, 90);
        
        // Text
        ctx.fillStyle = '#c71585';
        ctx.font = 'bold 42px Kanit';
        ctx.fillText(wordObj.text, 128, 210);
        
        ctx.font = '16px Kanit'; ctx.fillStyle = '#ffb6c1';
        ctx.fillText("VALENTINE BINGO", 128, 330);

        const texture = new THREE.CanvasTexture(canvas);
        const mats = [
            new THREE.MeshPhongMaterial({ color: 0xffffff }), // side
            new THREE.MeshPhongMaterial({ color: 0xffffff }), // side
            new THREE.MeshPhongMaterial({ color: 0xffffff }), // side
            new THREE.MeshPhongMaterial({ color: 0xffffff }), // side
            new THREE.MeshPhongMaterial({ map: texture }),    // front
            new THREE.MeshPhongMaterial({ color: 0xff69b4 })  // back
        ];

        const card = new THREE.Mesh(geometry, mats);
        card.castShadow = true;

        // Position 5x2
        const col = index % 5;
        const row = Math.floor(index / 5);
        card.userData = { 
            targetPos: new THREE.Vector3((col - 2) * 2.8, (0.6 - row) * 3.8, 0),
            category: wordObj.category,
            text: wordObj.text
        };
        
        card.position.set(card.userData.targetPos.x, -15, 0);
        card.rotation.y = Math.PI; // Show back
        scene.add(card);
        return card;
    }

    function shuffleGame() {
        if(isShuffling) return;
        isShuffling = true;
        
        document.getElementById('score').innerText = "0";
        document.getElementById('status-msg').innerText = "??????????? 10 ???????...";
        
        // ????????????????
        const targetCat = categories[Math.floor(Math.random() * categories.length)];
        document.getElementById('target-category').innerText = targetCat.name;
        
        // ??????? UI ?????????
        const listUI = document.getElementById('card-status-list');
        listUI.innerHTML = '';

        // ?????????? 3D
        cards.forEach(c => scene.remove(c));
        cards = [];

        // --- ??????????: ????????? 10 ????? 30 ?? ---
        const selected = [...allWords].sort(() => 0.5 - Math.random()).slice(0, 10);

        playShuffleSound();

        let totalBingo = 0;
        selected.forEach((wordObj, i) => {
            const card = createCardMesh(wordObj, i);
            cards.push(card);

            // ????? UI Chip ?????????????
            const chip = document.createElement('span');
            chip.className = 'bingo-chip chip-miss opacity-50';
            chip.innerText = wordObj.text;
            chip.id = ui-card-${i};
            listUI.appendChild(chip);

            // Animation ???????
            setTimeout(() => {
                const startTime = Date.now();
                const duration = 800;
                const targetPos = card.userData.targetPos;

                function anim() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const ease = 1 - Math.pow(1 - progress, 3);
                    
                    card.position.y = -15 + (targetPos.y + 15) * ease;
                    card.rotation.y = Math.PI + (Math.PI * ease);
                    
                    if(progress < 1) {
                        requestAnimationFrame(anim);
                    } else {
                        // ????????????????? ?????????????????
                        const isMatch = card.userData.category === targetCat.name;
                        const uiChip = document.getElementById(ui-card-${i});
                        
                        if(isMatch) {
                            totalBingo++;
                            document.getElementById('score').innerText = totalBingo;
                            uiChip.className = 'bingo-chip chip-match scale-110';
                            card.scale.set(1.15, 1.15, 1.15);
                            card.material[4].emissive = new THREE.Color(0x440022);
                            playBingoPointSound();
                        } else {
                            uiChip.className = 'bingo-chip chip-miss opacity-100';
                        }

                        if(i === 9) {
                            isShuffling = false;
                            document.getElementById('status-msg').innerText = ???????????! ??????????????? ${totalBingo} ??;
                        }
                    }
                }
                anim();
            }, i * 150);
        });
    }

    function animate() {
        requestAnimationFrame(animate);
        const time = Date.now() * 0.002;
        cards.forEach((card, i) => {
            if(!isShuffling) {
                card.position.y = card.userData.targetPos.y + Math.sin(time + i) * 0.15;
                card.rotation.z = Math.sin(time * 0.5 + i) * 0.05;
            }
        });
        renderer.render(scene, camera);
    }

    init3D();
    document.getElementById('shuffle-btn').onclick = () => {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        shuffleGame();
    };
</script>

</body>
</html>