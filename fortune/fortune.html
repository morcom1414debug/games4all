<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เซียมซีเสี่ยงทาย (สำหรับมือถือ)</title>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #fff3e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            text-align: center;
            box-sizing: border-box;
        }

        h1 { color: #e65100; margin-bottom: 10px; font-size: 1.8rem; }
        
        .instructions {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #ffe0b2;
            font-size: 1rem;
            width: 100%;
            max-width: 400px;
        }

        /* ปุ่มหลัก */
        #actionBtn {
            background-color: #ff6f00;
            color: white;
            border: none;
            padding: 50px 20px;
            font-size: 2rem;
            border-radius: 20px;
            width: 100%;
            max-width: 350px;
            margin-bottom: 20px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            font-weight: bold;
        }
        #actionBtn:active { transform: scale(0.96); background-color: #e65100; }

        /* ปุ่มวิธีใช้ */
        #helpBtn, #bgSoundBtn {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            margin-bottom: 20px;
            cursor: pointer;
        }

        #resultArea {
            padding: 20px;
            background: white;
            border-radius: 10px;
            width: 100%;
            max-width: 350px;
            min-height: 80px;
            font-size: 1.4rem;
            border: 2px solid #ffcc80;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>

    <h1>เซียมซีเสี่ยงทาย</h1>

    <button id="helpBtn" aria-label="กดเพื่อฟังวิธีเล่น">ฟังวิธีเล่น</button>

    <!-- ปุ่มใหม่ที่เพิ่มมา (อยู่ใต้ปุ่มฟังวิธีเล่น) -->
    <button id="bgSoundBtn" aria-label="เล่น/หยุดเสียงบรรยากาศ">เล่นเสียงบรรยากาศ</button>

    <div id="resultArea" role="status" aria-live="polite">
        พร้อมแล้วกดปุ่มสีส้มด้านล่าง
    </div>

    <div style="flex-grow: 1;"></div> 
    <button id="actionBtn" aria-label="ปุ่มเสี่ยงทาย กดหนึ่งครั้งเพื่อเขย่า กดอีกครั้งเพื่อฟังผล">เริ่มเขย่า</button>
    <div style="flex-grow: 1;"></div>
    <p>* หากต้องการเสี่ยงทายใหม่ ให้กดปุ่มเดิมซ้ำเพื่อเริ่มเขย่าอีกครั้งได้เลยครับ</p>

    <script>
        // --- 1. ฐานข้อมูลคำทำนาย ---
        const predictions = [
            "เบอร์ 1 เขาว่าดี มีโชคลาภ ถามหาคู่จะได้พบ ถามหาของหายจะได้คืน",
            "เบอร์ 2 ช่วงนี้ให้ระวังการใช้จ่าย สุขภาพอาจเจ็บป่วยเล็กน้อย ให้พักผ่อนเยอะๆ",
            "เบอร์ 3 การงานกำลังรุ่งเรือง ผู้ใหญ่ให้การสนับสนุน แต่อย่าประมาท",
            "เบอร์ 4 ความรักยังไม่สมหวัง ให้รอไปก่อน เนื้อคู่ยังไม่มา",
            "เบอร์ 5 จะได้รับข่าวดีจากทางไกล ศัตรูจะกลับมาเป็นมิตร",
            "เบอร์ 6 เคราะห์ร้ายกลายเป็นดี ให้หมั่นทำบุญปล่อยนกปล่อยปลา",
            "เบอร์ 7 ท่านว่าช้าๆ ได้พร้าเล่มงาม อย่าใจร้อน การลงทุนมีความเสี่ยง",
            "เบอร์ 8 ครอบครัวมีความสุข สมบูรณ์พูนผล ปราศจากโรคภัย",
            "เบอร์ 9 เพื่อนฝูงจะนำโชคมาให้ การเดินทางปลอดภัยไร้กังวล",
            "เบอร์ 10 สิ่งที่หวังไว้อาจจะยังไม่สำเร็จในตอนนี้ ต้องใช้ความพยายามเพิ่มขึ้น"
        ];

        let isShaking = false;
        let shakeInterval;
        let audioCtx;

        // เพิ่มตัวแปรสำหรับเสียงบรรยากาศ
        const bgAudio = new Audio('01.mp3');
        bgAudio.loop = true; // ให้วนซ้ำตลอด
        let isBgPlaying = false;

        const btn = document.getElementById('actionBtn');
        const helpBtn = document.getElementById('helpBtn');
        const bgSoundBtn = document.getElementById('bgSoundBtn');
        const resultArea = document.getElementById('resultArea');

        // --- 2. ระบบ TTS (เสียงอ่านของ Google) ---
        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            const thaiVoice = voices.find(v => v.lang.includes('th'));
            if (thaiVoice) {
                utterance.voice = thaiVoice;
            }
            utterance.lang = 'th-TH';
            utterance.rate = 1.0;
            utterance.volume = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        // --- 3. ระบบเสียง Effect (สังเคราะห์เสียงเขย่า) ---
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playShakeSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(200 + Math.random() * 400, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.08);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- 4. ปุ่มฟังวิธีเล่น ---
        helpBtn.addEventListener('click', () => {
            const instructions = "วิธีเล่นเกมเซียมซี.. หนึ่ง.. กดปุ่มใหญ่ด้านล่างหนึ่งครั้ง เพื่อเริ่มเขย่าเซียมซี จะมีเสียงและโทรศัพท์จะสั่น.. สอง.. ตั้งจิตอธิษฐาน.. สาม.. กดปุ่มเดิมซ้ำอีกครั้ง เพื่อหยุดและฟังคำทำนาย";
            speak(instructions);
        });

        // --- 5. ปุ่มเล่น/หยุด เสียงบรรยากาศ ---
        bgSoundBtn.addEventListener('click', () => {
            if (isBgPlaying) {
                bgAudio.pause();
                bgAudio.currentTime = 0;
                isBgPlaying = false;
                bgSoundBtn.innerText = "เล่นเสียงบรรยากาศ";
            } else {
                bgAudio.play().catch(e => console.error("เล่นเสียงไม่ได้:", e));
                isBgPlaying = true;
                bgSoundBtn.innerText = "หยุดเสียงบรรยากาศ";
            }
        });

        // --- 6. กลไกเกมเซียมซี (เดิมทุกประการ) ---
        btn.addEventListener('click', () => {
            initAudio();

            if (!isShaking) {
                isShaking = true;
                btn.innerText = "หยุดเขย่า (ฟังผล)";
                btn.style.backgroundColor = "#d32f2f";
                
                shakeInterval = setInterval(() => {
                    playShakeSound();
                    if (navigator.vibrate) navigator.vibrate(50); 
                }, 150);

            } else {
                isShaking = false;
                clearInterval(shakeInterval);
                if (navigator.vibrate) navigator.vibrate(0);

                btn.innerText = "เริ่มเสี่ยงทายใหม่";
                btn.style.backgroundColor = "#ff6f00";

                const randomIndex = Math.floor(Math.random() * predictions.length);
                const fortuneText = predictions[randomIndex];

                resultArea.innerText = "ผลใบที่ " + (randomIndex + 1);
                
                setTimeout(() => {
                    const fullText = "ท่านได้ใบที่ " + (randomIndex + 1) + ".. " + fortuneText;
                    speak(fullText);
                }, 600);
            }
        });

        // โหลดเสียง TTS
        window.speechSynthesis.onvoiceschanged = () => {
            window.speechSynthesis.getVoices();
        };
    </script>
</body>
</html>