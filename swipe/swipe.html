<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Swipe Game</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      user-select: none;
      overflow: hidden;
    }
    #gameArea {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    button {
      padding: 1em 2em;
      font-size: 1.2em;
      border-radius: 12px;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <button id="startBtn">เริ่มเกม</button>
  </div>

  <audio id="bgm" src="background.mp3" loop></audio>
  <audio id="startSound" src="start.mp3"></audio>
  <audio id="win" src="win.mp3"></audio>
  <audio id="lost" src="lost.mp3"></audio>
  <audio id="endHappy" src="endhappy.mp3"></audio>
  <audio id="endLost" src="endlost.mp3"></audio>

  <audio id="left" src="left.mp3"></audio>
  <audio id="right" src="right.mp3"></audio>
  <audio id="up" src="up.mp3"></audio>
  <audio id="down" src="down.mp3"></audio>
  <audio id="tap" src="touch.mp3"></audio>
  <audio id="doubletap" src="touch2.mp3"></audio>

  <script>
    const startBtn = document.getElementById("startBtn");
    const gameArea = document.getElementById("gameArea");
    const bgm = document.getElementById("bgm");

    const sounds = {
      start: document.getElementById("startSound"),
      win: document.getElementById("win"),
      lost: document.getElementById("lost"),
      endHappy: document.getElementById("endHappy"),
      endLost: document.getElementById("endLost"),
      left: document.getElementById("left"),
      right: document.getElementById("right"),
      up: document.getElementById("up"),
      down: document.getElementById("down"),
      tap: document.getElementById("tap"),
      doubletap: document.getElementById("doubletap")
    };

    const gestures = ["left", "right", "up", "down", "tap", "doubletap"];

    let round = 1;
    let seq = [];
    let playerIndex = 0;
    let mistakes = 0;
    let listening = false;
    let lastTapTime = 0;

    function playSound(name) {
      if (sounds[name]) {
        sounds[name].currentTime = 0;
        sounds[name].play();
      }
    }

    function newSequence(round) {
      let length = Math.min(10, Math.floor((round+1)/2));
      seq = [];
      for (let i=0; i<length; i++) {
        let g = gestures[Math.floor(Math.random() * gestures.length)];
        seq.push(g);
      }
    }

    function playSequence() {
      let i = 0;
      listening = false;
      function next() {
        if (i < seq.length) {
          playSound(seq[i]);
          setTimeout(next, 1500);
          i++;
        } else {
          playerIndex = 0;
          listening = true;
        }
      }
      setTimeout(next, 1000);
    }

    function checkGesture(input) {
      if (!listening) return;
      if (seq[playerIndex] === input) {
        playerIndex++;
        if (playerIndex >= seq.length) {
          playSound("win");
          round++;
          if (round > 20) {
            bgm.pause();
            playSound("endHappy");
            resetGame();
          } else {
            setTimeout(startRound, 1500);
          }
        }
      } else {
        mistakes++;
        playSound("lost");
        if (mistakes >= 3) {
          bgm.pause();
          playSound("endLost");
          resetGame();
        } else {
          setTimeout(startRound, 1500);
        }
      }
    }

    function startRound() {
      newSequence(round);
      playSequence();
    }

    function resetGame() {
      round = 1;
      mistakes = 0;
      seq = [];
      playerIndex = 0;
      listening = false;
      startBtn.style.display = "block";
    }

    function startGame() {
      startBtn.style.display = "none";
      playSound("start");
      bgm.currentTime = 0;
      bgm.play();
      setTimeout(startRound, 2000);
    }

    // Gesture detection
    let touchStartX=0, touchStartY=0;
    gameArea.addEventListener("touchstart", e => {
      if (e.touches.length===1) {
        let now = Date.now();
        if (now - lastTapTime < 300) {
          checkGesture("doubletap");
        } else {
          setTimeout(()=>checkGesture("tap"), 300);
        }
        lastTapTime = now;
      } else if (e.touches.length===2) {
        // two finger swipe up to start game
        touchStartY = e.touches[0].clientY;
      }
    });

    gameArea.addEventListener("touchend", e => {
      if (e.changedTouches.length===1) {
        let dx = e.changedTouches[0].clientX - touchStartX;
        let dy = e.changedTouches[0].clientY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) {
          if (dx > 50) checkGesture("right");
          else if (dx < -50) checkGesture("left");
        } else {
          if (dy > 50) checkGesture("down");
          else if (dy < -50) checkGesture("up");
        }
      } else if (e.changedTouches.length===2) {
        let dy = e.changedTouches[0].clientY - touchStartY;
        if (dy < -50) startGame();
      }
    });

    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
