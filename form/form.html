<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>แบบตอบรับความสนใจ</title>
<style>
  body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Helvetica Neue", Arial; padding:20px; max-width:700px; margin:auto;}
  label{display:block; margin-top:12px; font-weight:600;}
  input[type="text"], select {width:100%; padding:10px; font-size:16px; margin-top:6px; box-sizing:border-box;}
  .checkbox-group {display:flex; flex-direction:column; gap:6px; margin-top:6px;}
  button{margin-top:18px; padding:12px 18px; font-size:16px; border-radius:8px; cursor:pointer;}
  .sr-only{position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;}
  .message{margin-top:12px;}
</style>
</head>
<body>
<h1>แบบตอบรับความสนใจ</h1>
<form id="interestForm" autocomplete="off" novalidate>
  <label for="fullname">1. ชื่อ-สกุล <span aria-hidden="true">*</span></label>
  <input id="fullname" name="fullname" type="text" required aria-required="true" placeholder="ป้อน ชื่อ-สกุล">

  <label for="gender">2. เพศ <span aria-hidden="true">*</span></label>
  <select id="gender" name="gender" required aria-required="true">
    <option value="">-- เลือกเพศ --</option>
    <option value="ชาย">ชาย</option>
    <option value="หญิง">หญิง</option>
    <option value="อื่นๆ">อื่นๆ</option>
  </select>

  <label>3. ความสนใจ (เลือกได้มากกว่า 1 ข้อ) <span aria-hidden="true">*</span></label>
  <div class="checkbox-group" role="group" aria-labelledby="interestLabel">
    <span id="interestLabel" class="sr-only">รายการความสนใจ</span>
    <label><input type="checkbox" name="interest" value="เทคโนโลยี"> เทคโนโลยี</label>
    <label><input type="checkbox" name="interest" value="งานอาสา"> งานอาสา</label>
    <label><input type="checkbox" name="interest" value="การศึกษา"> การศึกษา</label>
    <label><input type="checkbox" name="interest" value="สุขภาพ"> สุขภาพ</label>
    <label><input type="checkbox" name="interest" value="ศิลปะ/วัฒนธรรม"> ศิลปะ/วัฒนธรรม</label>
  </div>

  <div role="status" aria-live="polite" id="status" class="message"></div>

  <button id="submitBtn" type="submit">ส่ง</button>
</form>

<script>
const form = document.getElementById('interestForm');
const status = document.getElementById('status');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  status.textContent = '';
  const fullname = document.getElementById('fullname').value.trim();
  const gender = document.getElementById('gender').value;
  const interests = Array.from(document.querySelectorAll('input[name="interest"]:checked')).map(i=>i.value);

  // client-side validation: all fields required
  if(!fullname){ status.textContent = 'กรุณากรอก ชื่อ-สกุล'; document.getElementById('fullname').focus(); return; }
  if(!gender){ status.textContent = 'กรุณาเลือก เพศ'; document.getElementById('gender').focus(); return; }
  if(interests.length === 0){ status.textContent = 'กรุณาเลือก ความสนใจ อย่างน้อย 1 ข้อ'; document.querySelector('input[name="interest"]').focus(); return; }

  // disable button while submitting
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.textContent = 'กำลังส่ง...';

  try {
    const resp = await fetch('/submit', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({fullname, gender, interests})
    });
    const data = await resp.json();
    if(resp.ok){
      status.textContent = 'ส่งเรียบร้อยแล้ว (ลำดับที่ ' + data.sequence + ')';
      form.reset();
      document.getElementById('fullname').focus();
    } else {
      status.textContent = 'เกิดข้อผิดพลาด: ' + (data.error || resp.statusText);
    }
  } catch (err) {
    status.textContent = 'ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์: ' + err.message;
  } finally {
    btn.disabled = false;
    btn.textContent = 'ส่ง';
  }
});
</script>
</body>
</html>
