<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>โปรแกรมสุ่มตัวเลข</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
    .container { max-width: 95%; margin: auto; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem 0; position: relative; }
    .card { background-color: white; padding: 1.5rem; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); width: 100%; max-width: 600px; }
    .btn { padding: 1rem 1.5rem; border-radius: 9999px; font-weight: 700; transition: all 0.3s ease; }
    .btn:hover:enabled { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); }
    .btn:disabled { background-color: #d1d5db; color: #9ca3af; cursor: not-allowed; }
    .result-display { font-size: 8rem; font-weight: 700; color: #3b82f6; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
    @media (min-width: 768px) { .result-display { font-size: 12rem; } }
    .list-group { max-height: 200px; overflow-y: auto; padding: 0.5rem; border-radius: 0.75rem; background-color: #f9fafb; }
    .list-group > span:not(:last-child)::after { content: ', '; }
    .error-message { color: #ef4444; background-color: #fee2e2; padding: 0.75rem; border-radius: 0.5rem; margin-top: 1rem; text-align: center; }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center">

<div class="container">
  <!-- ปุ่มกลับเมนูหลัก -->
  <button onclick="window.location.href='../index.html'" 
    class="absolute top-4 left-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow hover:bg-red-600">
    กลับเมนูหลัก
  </button>

  <div id="main-menu" class="card text-center">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">โปรแกรมสุ่มตัวเลข</h1>
    <p class="text-gray-500 mb-8">เลือกโหมดการสุ่มที่ต้องการ</p>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <button id="mode-1" class="btn bg-blue-500 text-white">สุ่มตัวเลข 1 ถึง 99</button>
      <button id="mode-2" class="btn bg-green-500 text-white">สุ่มตัวเลขจากเลขไหนถึงเลขไหน</button>
      <button id="mode-3" class="btn bg-purple-500 text-white">สุ่มตัวเลขตามประสงค์</button>
    </div>
  </div>

  <!-- Mode 1 -->
  <div id="mode-1-page" class="card hidden text-center">
    <h2 class="text-2xl font-bold mb-4">สุ่มตัวเลข 1 ถึง 99</h2>
    <div class="h-48 flex items-center justify-center bg-blue-50 border-4 border-dashed border-blue-200 rounded-2xl">
      <span id="result-1" class="result-display">?</span>
    </div>
    <button id="start-1" class="btn bg-blue-500 text-white w-full mt-4">เริ่มสุ่มทันที</button>
    <button id="reset-1" class="btn bg-gray-400 text-white w-full mt-2 hidden">สุ่มใหม่</button>
    <div class="mt-4 text-left">
      <h3 class="font-bold text-gray-600 mb-2">ประวัติการสุ่ม:</h3>
      <div id="history-1" class="list-group text-gray-600 flex flex-wrap"></div>
    </div>
    <button id="back-1" class="btn bg-gray-300 text-gray-800 w-full mt-4">เลือกโหมดสุ่มใหม่</button>
  </div>

  <!-- Mode 2 -->
  <div id="mode-2-page" class="card hidden text-center">
    <h2 class="text-2xl font-bold mb-4">สุ่มตัวเลขจากเลขไหนถึงเลขไหน</h2>
    <p>ใส่ตัวเลขตั้งต้นและตัวเลขสุดท้ายที่ต้องการสุ่ม โดยอนุญาตตัวเลขตั้งแต่ 1 ถึง 999<p/>
    <input type="number" id="start-num" placeholder="เลขเริ่มต้น ตั้งแต่ 1 ถึง 999" class="spin w-full mb-2 text-center border rounded" min="1" max="999" maxlength="3">
    <input type="number" id="end-num" placeholder="เลขสุดท้ายตั้งแต่ 1 ถึง 999" class="spin w-full mb-2 text-center border rounded" min="1" max="999" maxlength="3">
    <div id="error-2" class="error-message hidden" tabindex="-1"></div>
    <div class="h-48 flex items-center justify-center bg-green-50 border-4 border-dashed border-green-200 rounded-2xl">
      <span id="result-2" class="result-display text-green-500">?</span>
    </div>
    <button id="start-2" class="btn bg-green-500 text-white w-full mt-4">เริ่มสุ่มทันที</button>
    <button id="reset-2" class="btn bg-gray-400 text-white w-full mt-2 hidden">สุ่มใหม่</button>
    <div class="mt-4 text-left">
      <h3 class="font-bold text-gray-600 mb-2">ประวัติการสุ่ม:</h3>
      <div id="history-2" class="list-group text-gray-600 flex flex-wrap"></div>
    </div>
    <button id="back-2" class="btn bg-gray-300 text-gray-800 w-full mt-4">เลือกโหมดสุ่มใหม่</button>
  </div>

  <!-- Mode 3 -->
  <div id="mode-3-page" class="card hidden text-center">
    <h2 class="text-2xl font-bold mb-4">สุ่มตัวเลขตามประสงค์</h2>
    <p>ใส่ตัวเลขตามต้องการ ตัวเลขที่ใส่ค่าได้ตั้งแต่ 1 ถึง 999 ตัวเลขต้องไม่ซ้ำกัน และสามารถเพิ่มช่องได้ถึง 99 ช่อง<p/>
    <input type="number" class="custom-num spin w-full mb-2 text-center border rounded" placeholder="ตัวเลขที่ 1ตั้งแต่ 1 ถึง 999" min="1" max="999" maxlength="3">
    <input type="number" class="custom-num spin w-full mb-2 text-center border rounded" placeholder="ตัวเลขที่ 2ตั้งแต่ 1 ถึง 999" min="1" max="999" maxlength="3">
    <div id="error-3" class="error-message hidden" tabindex="-1"></div>
    <button id="add-input-3" class="btn bg-gray-200 text-gray-800 w-full mb-2">เพิ่มช่องใส่ตัวเลข</button>
    <div class="h-48 flex items-center justify-center bg-purple-50 border-4 border-dashed border-purple-200 rounded-2xl">
      <span id="result-3" class="result-display text-purple-500">?</span>
    </div>
    <button id="start-3" class="btn bg-purple-500 text-white w-full mt-4">เริ่มสุ่มทันที</button>
    <button id="reset-3" class="btn bg-gray-400 text-white w-full mt-2 hidden">สุ่มใหม่</button>
    <div class="mt-4 text-left">
      <h3 class="font-bold text-gray-600 mb-2">ประวัติการสุ่ม:</h3>
      <div id="history-3" class="list-group text-gray-600 flex flex-wrap"></div>
    </div>
    <button id="back-3" class="btn bg-gray-300 text-gray-800 w-full mt-4">เลือกโหมดสุ่มใหม่</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const sounds = {
    a1: new Audio('audio/01.mp3'),
    a2: new Audio('audio/02.mp3'),
    a3: new Audio('audio/03.mp3')
  };
  Object.values(sounds).forEach(a => { a.preload="auto"; a.load(); });

  const playAudio = (audio) => {
    if (!audio) return;
    audio.currentTime = 0;
    let p = audio.play();
    if (p) p.catch(e => console.warn("Safari blocked audio:", e));
  };

  let used = [], custom = [];
  let busy = false;
  const rand = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;

  const updateHistory=(el,num)=>{
    let span=document.createElement('span');
    span.className='px-2 py-1 bg-gray-200 rounded-full m-1';
    span.textContent=num;
    el.appendChild(span);
  };
  const clearHistory=(his,res,start,reset)=>{
    his.innerHTML=''; res.textContent='?'; used=[];
    start.classList.remove('hidden'); reset.classList.add('hidden');
  };

  const showError = (id,msg)=>{
    const el=document.getElementById(id);
    el.textContent=msg;
    el.classList.remove('hidden');
    el.focus();
  };
  const hideError = (id)=>{ document.getElementById(id).classList.add('hidden'); };

  const randomize=(res,his,get,start,reset)=>{
    if(busy) return; busy=true;
    res.textContent='...'; start.disabled=true; start.textContent='กำลังสุ่ม...';

    sounds.a1.currentTime=0;
    sounds.a1.play().catch(e=>console.warn("Audio 01 error:",e));

    sounds.a1.onended=()=>{
      const avail=get().filter(n=>!used.includes(n));
      if(avail.length===0){
        alert("หมดตัวเลขแล้ว");
        start.textContent='เริ่มสุ่มทันที';
        reset.classList.remove('hidden');
        busy=false; start.disabled=false;
        return;
      }
      const result=avail[rand(0,avail.length-1)];
      used.push(result);
      res.textContent=result;
      updateHistory(his,result);

      res.setAttribute("tabindex","-1");
      res.focus();

      setTimeout(()=>playAudio(sounds.a3),500);

      start.textContent='สุ่มอีกครั้ง';
      reset.classList.remove('hidden');
      start.disabled=false;
      busy=false;
    };
  };

  const showPage=(id)=>{
    ['main-menu','mode-1-page','mode-2-page','mode-3-page'].forEach(pid=>document.getElementById(pid).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');

    if(id==='mode-1-page'){
      document.getElementById('start-1').focus();
    }
    if(id==='mode-2-page'){
      document.getElementById('start-num').focus();
    }
    if(id==='mode-3-page'){
      document.querySelector('.custom-num').focus();
    }
  };

  // menu
  document.getElementById('mode-1').onclick=()=>{ playAudio(sounds.a2); clearHistory(document.getElementById('history-1'),document.getElementById('result-1'),document.getElementById('start-1'),document.getElementById('reset-1')); showPage('mode-1-page');};
  document.getElementById('mode-2').onclick=()=>{ playAudio(sounds.a2); clearHistory(document.getElementById('history-2'),document.getElementById('result-2'),document.getElementById('start-2'),document.getElementById('reset-2')); showPage('mode-2-page');};
  document.getElementById('mode-3').onclick=()=>{ playAudio(sounds.a2); clearHistory(document.getElementById('history-3'),document.getElementById('result-3'),document.getElementById('start-3'),document.getElementById('reset-3')); showPage('mode-3-page');};

  document.getElementById('back-1').onclick=()=>showPage('main-menu');
  document.getElementById('back-2').onclick=()=>showPage('main-menu');
  document.getElementById('back-3').onclick=()=>showPage('main-menu');

  // mode1
  document.getElementById('start-1').onclick=()=>{ randomize(document.getElementById('result-1'),document.getElementById('history-1'),()=>Array.from({length:99},(_,i)=>i+1),document.getElementById('start-1'),document.getElementById('reset-1'));};
  document.getElementById('reset-1').onclick=()=>{ playAudio(sounds.a2); clearHistory(document.getElementById('history-1'),document.getElementById('result-1'),document.getElementById('start-1'),document.getElementById('reset-1')); document.getElementById('start-1').textContent='เริ่มสุ่มทันที';};

  // mode2
  document.getElementById('start-2').onclick=()=>{
    let s=parseInt(document.getElementById('start-num').value);
    let e=parseInt(document.getElementById('end-num').value);
    if(isNaN(s)||isNaN(e)||s>e){ showError('error-2',"กรุณาใส่ตัวเลขที่ถูกต้อง"); return;}
    hideError('error-2');
    randomize(document.getElementById('result-2'),document.getElementById('history-2'),()=>Array.from({length:e-s+1},(_,i)=>s+i),document.getElementById('start-2'),document.getElementById('reset-2'));
  };
  document.getElementById('reset-2').onclick=()=>{ 
    playAudio(sounds.a2); 
    clearHistory(document.getElementById('history-2'),document.getElementById('result-2'),document.getElementById('start-2'),document.getElementById('reset-2')); 
    document.getElementById('start-2').textContent='เริ่มสุ่มทันที'; 
    document.getElementById('start-num').value=''; 
    document.getElementById('end-num').value=''; 
    document.getElementById('start-num').focus(); 
  };

  // mode3
  document.getElementById('add-input-3').onclick=()=>{
    let c=document.querySelectorAll('.custom-num').length;
    if(c>=99){ alert("ใส่ได้สูงสุด 99 ช่อง"); return;}
    let inp=document.createElement('input');
    inp.type='number';
    inp.className='custom-num spin w-full mb-2 text-center border rounded';
    inp.placeholder=`ตัวเลขที่ ${c+1} ตั้งแต่ 1 ถึง 999`;
    inp.min=1; inp.max=999; inp.maxLength=3;
    document.getElementById('add-input-3').before(inp);
    inp.focus();
  };
  document.getElementById('start-3').onclick=()=>{
    custom=[]; let ok=true; let seen=new Set();
    document.querySelectorAll('.custom-num').forEach(inp=>{
      if(inp.value){
        let n=parseInt(inp.value);
        if(isNaN(n)||n<1||n>999||seen.has(n)){ok=false;}
        else {custom.push(n); seen.add(n);}
      }
    });
    if(!ok||custom.length===0){ showError('error-3',"กรุณาใส่ตัวเลขที่ถูกต้องและไม่ซ้ำ"); return;}
    hideError('error-3');
    randomize(document.getElementById('result-3'),document.getElementById('history-3'),()=>custom,document.getElementById('start-3'),document.getElementById('reset-3'));
  };
  document.getElementById('reset-3').onclick=()=>{ 
    playAudio(sounds.a2); 
    clearHistory(document.getElementById('history-3'),document.getElementById('result-3'),document.getElementById('start-3'),document.getElementById('reset-3')); 
    document.getElementById('start-3').textContent='เริ่มสุ่มทันที'; 
    document.querySelectorAll('.custom-num').forEach((inp,i)=>{if(i<2){inp.value='';}else{inp.remove();}}); 
    document.querySelector('.custom-num').focus(); 
  };
  
  // ✅ spin box: ลบ 0 นำหน้า + จำกัด 1–999
  document.addEventListener('input', e=>{
    if(e.target.classList.contains('spin')){
      let v=e.target.value.replace(/^0+/, '');
      if(v==='') v='';
      let n=parseInt(v);
      if(!isNaN(n)){
        if(n<1) n=1;
        if(n>999) n=999;
        e.target.value=n;
      } else {
        e.target.value='';
      }
    }
  });
});
</script>
</body>
</html>
