<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î - Accessible Pipe Race</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            line-height: 1.6;
            position: relative; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ */
        }

        .main-menu-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            padding: 10px 15px;
            border: none; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏£‡∏¥‡∏á ‡πÜ */
            border-radius: 25px;
            text-decoration: none;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            cursor: pointer; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° cursor pointer */
            z-index: 1000;
        }

        .main-menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            max-width: 700px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .progress-container {
            margin: 2rem 0;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            height: 50px;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #81C784);
            height: 100%;
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .bot-progress {
            background: linear-gradient(90deg, #f44336, #e57373);
        }

        .obstacle-warning {
            background: linear-gradient(90deg, #FF9800, #FFB74D);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            font-size: 1.3rem;
            font-weight: bold;
            animation: warning-flash 1s infinite;
            display: none;
        }

        .obstacle-warning.active {
            display: block;
        }

        @keyframes warning-flash {
            0%, 50% { opacity: 1; }
            25%, 75% { opacity: 0.7; }
        }

        button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            color: white;
            padding: 1rem 2rem;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
            min-width: 200px;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .pipe-button {
            background: linear-gradient(45deg, #FFD93D, #FF6B35);
            font-size: 1.8rem;
            padding: 1.5rem 3rem;
            animation: pulse 2s infinite;
        }

        .clear-button {
            background: linear-gradient(45deg, #F44336, #FF5722);
            font-size: 1.8rem;
            padding: 1.5rem 3rem;
            animation: urgent-pulse 1s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 53, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0); }
        }

        @keyframes urgent-pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.8); }
            50% { box-shadow: 0 0 0 15px rgba(244, 67, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }

        .scoreboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
            font-size: 1.3rem;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
        }

        .round-result {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
        }

        .win { color: #4CAF50; }
        .lose { color: #f44336; }
        .tie { color: #FF9800; }

        .screen-reader-only {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 1rem;
            }
            h1 { font-size: 2rem; }
            button { font-size: 1.1rem; }
            .controls {
                flex-direction: column;
                align-items: center;
            }
            .main-menu-button {
                top: 10px;
                left: 10px;
                padding: 8px 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <button class="main-menu-button" onclick="location.href='index.html'">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
    <div class="game-container" role="main">
        <h1>üîß ‡πÄ‡∏Å‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î</h1>
        
        <div class="game-info" role="region" aria-labelledby="game-rules">
            <div id="game-rules">
                <p><strong>‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤:</strong> ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ 5% ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á! ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á 50% ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå</p>
                <p><strong>‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á:</strong> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡∏¢‡∏∞‡πÉ‡∏ô‡∏´‡∏•‡∏≠‡∏î ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞‡∏Å‡πà‡∏≠‡∏ô! (‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° C ‡∏´‡∏£‡∏∑‡∏≠ Delete)</p>
                <p>‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î: Enter/Spacebar | ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞: C/Delete</p>
            </div>
        </div>

        <div class="scoreboard" aria-live="polite">
            <div class="score-item">
                <strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏∏‡∏ì: <span id="player-wins">0</span></strong>
            </div>
            <div class="score-item">
                <strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå: <span id="bot-wins">0</span></strong>
            </div>
        </div>

        <div class="game-info" style="background: rgba(255, 255, 255, 0.15); margin-bottom: 1rem;">
            <div id="ai-status" aria-live="polite">AI Level: 1 | ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå: 0 | ‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô: 0</div>
            <div style="font-size: 0.9rem; margin-top: 0.5rem;">  ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ!</div>
        </div>

        <button id="start-game" onclick="startGame()" aria-describedby="game-rules">
            üéÆ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
        </button>

        <div id="progress-container" class="progress-container" role="region" aria-label="‡πÅ‡∏ñ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤">
            <div>
                <h3>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span id="player-percent" aria-live="polite">0%</span></h3>
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
                    <div id="player-progress" class="progress-fill" style="width: 0%">0%</div>
                </div>
            </div>
            
            <div>
                <h3>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå: <span id="bot-percent" aria-live="polite">0%</span></h3>
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå">
                    <div id="bot-progress" class="progress-fill bot-progress" style="width: 0%">0%</div>
                </div>
            </div>

            <div id="player-obstacle" class="obstacle-warning" aria-live="assertive">
                üóëÔ∏è ‡∏Ç‡∏¢‡∏∞‡πÉ‡∏ô‡∏´‡∏•‡∏≠‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞ (C ‡∏´‡∏£‡∏∑‡∏≠ Delete)
            </div>

            <div id="bot-obstacle" class="obstacle-warning" aria-live="assertive">
                ü§ñ ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞...
            </div>

            <div class="controls">
                <button id="pipe-button" class="pipe-button" onclick="addProgress()" aria-label="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î ‡∏Å‡∏î Enter ‡∏´‡∏£‡∏∑‡∏≠ Spacebar">
                    üîß ‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î
                </button>
                
                <button id="clear-button" class="clear-button" onclick="clearObstacle()" aria-label="‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞ ‡∏Å‡∏î C ‡∏´‡∏£‡∏∑‡∏≠ Delete" style="display: none;">
                    üóëÔ∏è ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞
                </button>
            </div>
        </div>

        <div id="round-result" class="round-result" aria-live="assertive" style="display: none;"></div>
        <div id="game-result" class="round-result" aria-live="assertive" style="display: none;"></div>

        <div class="screen-reader-only" id="live-updates" aria-live="polite"></div>
    </div>

    <script>
        // Global game variables
        let playerProgress = 0;
        let botProgress = 0;
        let playerWins = 0;
        let botWins = 0;
        let currentRound = 0;
        let gameActive = false;
        let roundActive = false;
        let botInterval;
        let roundStartTime;
        let lastClickTime = 0;

        // Obstacle system
        let playerHasObstacle = false;
        let botHasObstacle = false;
        let obstacleCheckInterval;

        // AI Learning System - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö
        let aiLearning = {
            playerClickTimes: [],
            playerAverageSpeed: 500,
            playerWinRate: 0.5,
            gamesPlayed: 0,
            adaptiveSpeed: 500,
            learningRate: 0.1,
            experience: 0,
            obstacleHandling: 0.5, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞
            maxLevel: Infinity // ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö!
        };

        // Audio context for sound effects
        let audioContext;
        let sounds = {};

        // Update AI learning display - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö
        function updateAIStatus() {
            const aiLevel = Math.floor(aiLearning.experience / 10) + 1; // ‡πÄ‡∏≠‡∏≤‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏≠‡∏≠‡∏Å
            const aiStatusElement = document.getElementById('ai-status');
            if (aiStatusElement) {
                aiStatusElement.textContent = `AI Level: ${aiLevel} | ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå: ${aiLearning.experience} | ‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô: ${aiLearning.gamesPlayed}`;
            }
        }

        // Initialize audio
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                createSounds();
            }
        }

        // Create sound effects using Web Audio API
        function createSounds() {
            // Progress sound
            sounds.progress = () => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 400 + (playerProgress * 10);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            };

            // Obstacle sound
            sounds.obstacle = () => {
                playTone([200, 150, 100], 0.3);
            };

            // Clear obstacle sound
            sounds.clearObstacle = () => {
                playTone([600, 800, 1000], 0.2);
            };

            // Win sound
            sounds.win = () => {
                playTone([523, 659, 784, 1047], 0.3);
            };

            // Lose sound
            sounds.lose = () => {
                playTone([392, 329, 261], 0.4);
            };

            // Tie sound
            sounds.tie = () => {
                playTone([440, 440, 440], 0.2);
            };

            // Game over sound
            sounds.gameOver = () => {
                playTone([523, 523, 523, 659, 659, 659, 784, 784, 784, 1047], 0.2);
            };
        }

        function playTone(frequencies, duration) {
            frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'square';
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }, index * 150);
            });
        }

        function announceText(text) {
            document.getElementById('live-updates').textContent = text;
            
            // Use speech synthesis if available
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'th-TH';
                utterance.rate = 1.2;
                speechSynthesis.speak(utterance);
            }
        }

        // Obstacle management
        function createObstacle() {
            if (!roundActive) return;
            
            // Random chance for player obstacle (10% per check)
            if (!playerHasObstacle && Math.random() < 0.1) {
                playerHasObstacle = true;
                document.getElementById('player-obstacle').classList.add('active');
                document.getElementById('clear-button').style.display = 'block';
                document.getElementById('pipe-button').disabled = true;
                sounds.obstacle();
                announceText('‡∏Ç‡∏¢‡∏∞‡πÉ‡∏ô‡∏´‡∏•‡∏≠‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î');
            }

            // Random chance for bot obstacle - AI learns to handle this better
            if (!botHasObstacle && Math.random() < (0.15 - aiLearning.obstacleHandling * 0.1)) {
                botHasObstacle = true;
                document.getElementById('bot-obstacle').classList.add('active');
                announceText('‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏à‡∏≠‡∏Ç‡∏¢‡∏∞‡πÉ‡∏ô‡∏´‡∏•‡∏≠‡∏î!');
                
                // AI clears obstacle with learned efficiency
                const clearTime = Math.max(1000 - (aiLearning.obstacleHandling * 500), 300);
                setTimeout(() => {
                    if (botHasObstacle) {
                        clearBotObstacle();
                    }
                }, clearTime);
            }
        }

        function clearObstacle() {
            if (!playerHasObstacle) return;
            
            playerHasObstacle = false;
            document.getElementById('player-obstacle').classList.remove('active');
            document.getElementById('clear-button').style.display = 'none';
            document.getElementById('pipe-button').disabled = false;
            document.getElementById('pipe-button').focus();
            
            sounds.clearObstacle();
            announceText('‡∏Ç‡∏¢‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß! ‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢');
        }

        function clearBotObstacle() {
            botHasObstacle = false;
            document.getElementById('bot-obstacle').classList.remove('active');
            
            // AI learns from clearing obstacles
            aiLearning.obstacleHandling = Math.min(aiLearning.obstacleHandling + 0.05, 1.0);
            aiLearning.experience += 0.5;
            
            announceText('‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏¢‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!');
        }

        function startGame() {
            initAudio();
            gameActive = true;
            currentRound = 0;
            playerWins = 0;
            botWins = 0;
            
            // Reset obstacles
            playerHasObstacle = false;
            botHasObstacle = false;
            
            // Start new learning session
            aiLearning.playerClickTimes = [];
            aiLearning.gamesPlayed++;
            
            document.getElementById('start-game').style.display = 'none';
            document.getElementById('progress-container').classList.add('active');
            
            updateScoreboard();
            updateAIStatus();
            startNewRound();
            
            const aiLevel = Math.floor(aiLearning.experience / 10) + 1;
            announceText(`‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 1 ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô! ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö ${aiLevel} ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î`);
        }

        function startNewRound() {
            currentRound++;
            roundActive = true;
            playerProgress = 0;
            botProgress = 0;
            roundStartTime = Date.now();
            lastClickTime = Date.now();
            
            // Reset obstacles
            playerHasObstacle = false;
            botHasObstacle = false;
            document.getElementById('player-obstacle').classList.remove('active');
            document.getElementById('bot-obstacle').classList.remove('active');
            document.getElementById('clear-button').style.display = 'none';
            
            updateProgressBars();
            document.getElementById('pipe-button').disabled = false;
            document.getElementById('pipe-button').focus();
            
            document.getElementById('round-result').style.display = 'none';
            document.getElementById('game-result').style.display = 'none';

            // Start obstacle generation
            obstacleCheckInterval = setInterval(createObstacle, 1000);

            // AI adapts based on learning - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
            let aiSpeed = aiLearning.adaptiveSpeed;
            
            // AI becomes more intelligent over time (no limits!)
            const aiIntelligence = Math.min(aiLearning.experience * 0.01, 0.8);
            
            // Adjust AI speed based on player's performance
            if (aiLearning.playerWinRate > 0.6) {
                aiSpeed = Math.max(aiSpeed * (0.9 - aiIntelligence * 0.2), 100);
            } else if (aiLearning.playerWinRate < 0.4) {
                aiSpeed = Math.min(aiSpeed * (1.1 + aiIntelligence * 0.1), 1000);
            }
            
            // Start bot AI - now uses unlimited learning
            botInterval = setInterval(() => {
                if (roundActive && botProgress < 50 && !botHasObstacle) {
                    // AI decision making based on unlimited experience
                    const clickChance = 0.3 + (aiLearning.experience * 0.005); // ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î!
                    const shouldClick = Math.random() < Math.min(clickChance, 0.95);
                    
                    if (shouldClick) {
                        const increment = 5;
                        botProgress += increment;
                        if (botProgress > 50) botProgress = 50;
                        updateProgressBars();
                        
                        announceText(`‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°! ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${Math.round(botProgress)}%`);
                        
                        if (botProgress >= 50) {
                            endRound();
                        }
                    }
                }
            }, Math.max(aiSpeed * (1 - aiIntelligence * 0.3), 50)); // AI ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å‡πÑ‡∏î‡πâ!

            announceText(`‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound} ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô! ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏≤‡∏Ç‡∏ß‡∏≤‡∏á!`);
        }

        function addProgress() {
            if (!roundActive || playerHasObstacle) return;
            
            initAudio();
            
            // Record player behavior for AI learning
            const currentTime = Date.now();
            const timeSinceLastClick = currentTime - lastClickTime;
            aiLearning.playerClickTimes.push(timeSinceLastClick);
            lastClickTime = currentTime;
            
            // Update average speed
            if (aiLearning.playerClickTimes.length > 0) {
                const sum = aiLearning.playerClickTimes.reduce((a, b) => a + b, 0);
                aiLearning.playerAverageSpeed = sum / aiLearning.playerClickTimes.length;
                
                // Adapt AI speed gradually towards player's speed
                aiLearning.adaptiveSpeed += (aiLearning.playerAverageSpeed - aiLearning.adaptiveSpeed) * aiLearning.learningRate;
            }
            
            const increment = 5; // Fixed 5% per click
            playerProgress += increment;
            
            if (playerProgress > 50) playerProgress = 50;
            
            updateProgressBars();
            sounds.progress();
            
            announceText(`‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°! ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${Math.round(playerProgress)}%`);
            
            if (playerProgress >= 50) {
                endRound();
            }
        }

        function updateProgressBars() {
            const playerPercentElement = document.getElementById('player-percent');
            const botPercentElement = document.getElementById('bot-percent');
            const playerProgressBar = document.getElementById('player-progress');
            const botProgressBar = document.getElementById('bot-progress');
            
            const playerPercentRounded = Math.round(playerProgress);
            const botPercentRounded = Math.round(botProgress);
            
            playerPercentElement.textContent = `${playerPercentRounded}%`;
            botPercentElement.textContent = `${botPercentRounded}%`;
            
            playerProgressBar.style.width = `${Math.min(playerProgress * 2, 100)}%`;
            playerProgressBar.textContent = `${playerPercentRounded}%`;
            
            botProgressBar.style.width = `${Math.min(botProgress * 2, 100)}%`;
            botProgressBar.textContent = `${botPercentRounded}%`;

            // Update aria attributes
            document.querySelector('[aria-label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô"]').setAttribute('aria-valuenow', playerPercentRounded);
            document.querySelector('[aria-label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå"]').setAttribute('aria-valuenow', botPercentRounded);
        }

        function endRound() {
            roundActive = false;
            clearInterval(botInterval);
            clearInterval(obstacleCheckInterval);
            document.getElementById('pipe-button').disabled = true;
            
            // Hide obstacles
            document.getElementById('player-obstacle').classList.remove('active');
            document.getElementById('bot-obstacle').classList.remove('active');
            document.getElementById('clear-button').style.display = 'none';
            
            const resultElement = document.getElementById('round-result');
            let result, resultClass, announcement;
            
            // AI Learning: Record round result
            const playerWon = playerProgress >= 50 && playerProgress >= botProgress;
            const botWon = botProgress >= 50 && botProgress >= playerProgress;
            
            if (Math.abs(playerProgress - botProgress) < 1) {
                // Tie
                result = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound}: ‡πÄ‡∏™‡∏°‡∏≠! (‡∏Ñ‡∏∏‡∏ì: ${Math.round(playerProgress)}%, ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå: ${Math.round(botProgress)}%)`;
                resultClass = 'tie';
                announcement = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound} ‡πÄ‡∏™‡∏°‡∏≠! AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏°‡∏≠‡∏ô‡∏µ‡πâ`;
                sounds.tie();
                aiLearning.experience += 1;
            } else if (playerWon) {
                // Player wins
                playerWins++;
                result = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound}: ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞! (‡∏Ñ‡∏∏‡∏ì: ${Math.round(playerProgress)}%, ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå: ${Math.round(botProgress)}%)`;
                resultClass = 'win';
                announcement = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound} ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞! AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô`;
                sounds.win();
                
                // AI learns from losing
                aiLearning.experience += 2;
                aiLearning.learningRate = Math.min(0.5, aiLearning.learningRate + 0.02);
            } else {
                // Bot wins
                botWins++;
                result = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound}: ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏ä‡∏ô‡∏∞! (‡∏Ñ‡∏∏‡∏ì: ${Math.round(playerProgress)}%, ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå: ${Math.round(botProgress)}%)`;
                resultClass = 'lose';
                announcement = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound} ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏ä‡∏ô‡∏∞! AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠`;
                sounds.lose();
                
                // AI learns from winning
                aiLearning.experience += 3;
                aiLearning.obstacleHandling = Math.min(aiLearning.obstacleHandling + 0.03, 1.0);
            }
            
            resultElement.textContent = result;
            resultElement.className = `round-result ${resultClass}`;
            resultElement.style.display = 'block';
            
            updateScoreboard();
            announceText(announcement);
            
            // Check if game is over
            if (currentRound >= 5) {
                setTimeout(endGame, 2000);
            } else {
                setTimeout(startNewRound, 3000);
            }
        }

        function endGame() {
            gameActive = false;
            
            // AI Learning: Update statistics - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
            const oldWinRate = aiLearning.playerWinRate;
            aiLearning.playerWinRate = (aiLearning.playerWinRate * (aiLearning.gamesPlayed - 1) + (playerWins > botWins ? 1 : 0)) / aiLearning.gamesPlayed;
            
            // Massive experience gain based on game result
            const gameExperience = Math.max(5, Math.abs(playerWins - botWins) * 3);
            aiLearning.experience += gameExperience;
            
            // AI becomes more adaptable over time (no limits!)
            aiLearning.learningRate = Math.min(1.0, aiLearning.learningRate + 0.05);
            
            const gameResultElement = document.getElementById('game-result');
            let finalResult, resultClass, announcement;
            
            const aiLevel = Math.floor(aiLearning.experience / 10) + 1;
            
            if (playerWins > botWins) {
                finalResult = `üéâ ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÄ‡∏Å‡∏°! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${playerWins}-${botWins}`;
                resultClass = 'win';
                announcement = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÄ‡∏Å‡∏° ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö ${aiLevel} ‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ`;
                sounds.gameOver();
            } else if (botWins > playerWins) {
                finalResult = `ü§ñ ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏ä‡∏ô‡∏∞‡πÄ‡∏Å‡∏°! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${playerWins}-${botWins}`;
                resultClass = 'lose';
                announcement = `‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö ${aiLevel} ‡∏ä‡∏ô‡∏∞‡πÄ‡∏Å‡∏°! AI ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡πà‡∏≠‡πÑ‡∏õ`;
                sounds.lose();
            } else {
                finalResult = `ü§ù ‡πÄ‡∏™‡∏°‡∏≠! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${playerWins}-${botWins}`;
                resultClass = 'tie';
                announcement = `‡πÄ‡∏Å‡∏°‡πÄ‡∏™‡∏°‡∏≠! ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö ${aiLevel} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏î‡∏∏‡∏•`;
                sounds.tie();
            }
            
            gameResultElement.textContent = finalResult;
            gameResultElement.className = `round-result ${resultClass}`;
            gameResultElement.style.display = 'block';
            
            updateAIStatus();
            announceText(announcement);
            
            // Show start button again
            setTimeout(() => {
                document.getElementById('start-game').style.display = 'block';
                document.getElementById('start-game').textContent = `üîÑ ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà (AI Level ${aiLevel})`;
                document.getElementById('progress-container').classList.remove('active');
                document.getElementById('start-game').focus();
            }, 3000);
        }

        function updateScoreboard() {
            document.getElementById('player-wins').textContent = playerWins;
            document.getElementById('bot-wins').textContent = botWins;
            updateAIStatus();
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if ((e.code === 'Enter' || e.code === 'Space') && roundActive && !playerHasObstacle) {
                e.preventDefault();
                addProgress();
            }
            if ((e.code === 'KeyC' || e.code === 'Delete') && playerHasObstacle) {
                e.preventDefault();
                clearObstacle();
            }
        });

        // Focus management
        document.getElementById('start-game').addEventListener('click', () => {
            setTimeout(() => {
                document.getElementById('pipe-button').focus();
            }, 100);
        });

        // Initialize AI status on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateAIStatus();
        });
    </script>
</body>
</html>
 