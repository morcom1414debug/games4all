<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>พิชิตเส้นทางสู่แชมป์เพลงลูกทุ่ง</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4a90e2;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-500 to-purple-600 min-h-screen flex items-center justify-center p-4">
    <div id="game-container" class="bg-white rounded-3xl shadow-xl p-8 max-w-lg w-full text-center space-y-6 relative">
        <!-- ปุ่มกลับเมนูหลัก -->
        <button id="back-to-menu-button" 
                class="absolute top-4 left-4 bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-full shadow-md hover:bg-gray-300 transform transition-transform duration-200 hover:scale-105 flex items-center space-x-2"
                onclick="window.location.href='index.html'">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H16a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            <span>กลับเมนูหลัก</span>
        </button>

        <h1 class="text-4xl font-bold text-gray-800 mb-4">พิชิตเส้นทางสู่แชมป์เพลงลูกทุ่ง</h1>

        <!-- Start Screen -->
        <div id="start-screen" class="space-y-4">
            <p class="text-lg text-gray-600">มาทดสอบกันว่าคุณรู้จักเพลงลูกทุ่งดีแค่ไหน</p>
            <div id="how-to-play-text" class="p-4 bg-gray-100 rounded-lg shadow-inner text-left">
                <h3 class="text-xl font-bold mb-2">วิธีการเล่น:</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-1">
                    <li>เกมมีทั้งหมด 5 ระดับ แต่ละระดับมี 10 ข้อ (ข้อละ 1 คะแนน)</li>
                    <li>**เป้าหมายของคุณ**: ตอบคำถามให้ถูกต้องเพื่อผ่านไปด่านต่อไป</li>
                    <li>**ข้อควรระวัง**: คุณสามารถตอบผิดได้ไม่เกิน 2 ครั้ง หากตอบผิดครบ 3 ครั้ง เกมจะโอเวอร์ทันที!</li>
                </ul>
                <h3 class="text-xl font-bold mt-4 mb-2">คะแนนโบนัสพิเศษ (เมื่อทำคะแนนเต็ม 10/10):</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-1">
                    <li>ระดับ 1: โบนัส 100 คะแนน</li>
                    <li>ระดับ 2: โบนัส 200 คะแนน</li>
                    <li>ระดับ 3: โบนัส 500 คะแนน</li>
                    <li>ระดับ 4: โบนัส 800 คะแนน</li>
                    <li>ระดับ 5: โบนัส 1,000 คะแนน</li>
                </ul>
                <p class="mt-4 text-gray-700">**เมื่อเกมจบ (ไม่ว่าจะเล่นครบ 5 ระดับ หรือเกมโอเวอร์) คุณจะต้องเริ่มเล่นใหม่ โดยระบบจะกลับมาที่หน้าจอเริ่มเกมเสมอ**</p>
            </div>
            <div class="space-y-4">
                <button id="start-button-hardcoded" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-600 transform transition-transform duration-200 hover:scale-105">
                    เริ่มเกม
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden space-y-6">
            <div class="flex items-center justify-center">
                <h2 id="level-display" class="text-xl font-bold text-gray-700"></h2>
            </div>
            <!-- Question -->
            <div class="bg-gray-100 rounded-xl p-6 shadow-inner" role="region" aria-live="polite" aria-atomic="true">
                <p id="question-text" class="text-2xl font-semibold text-gray-800 leading-relaxed"></p>
                <div id="loading-spinner" class="hidden mt-4 flex justify-center items-center space-x-2">
                    <div class="spinner"></div>
                    <span class="text-gray-500">กำลังสร้างคำถาม...</span>
                </div>
            </div>

            <!-- Answer Options -->
            <div id="answers-container" class="grid gap-4">
                <!-- Buttons will be added here by JavaScript -->
            </div>

            <!-- Feedback & Next Button -->
            <div class="space-y-4">
                <p id="feedback" class="text-xl font-bold" aria-live="polite" aria-atomic="true"></p>
                <button id="next-button" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-green-600 transform transition-transform duration-200 hover:scale-105 hidden">
                    คำถามต่อไป
                </button>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="hidden space-y-4">
            <h2 id="final-message" class="text-3xl font-bold text-gray-800" aria-live="polite" aria-atomic="true"></h2>
            <p id="score-text" class="text-2xl font-semibold text-gray-700"></p>
            <div id="answers-review" class="p-4 bg-gray-100 rounded-lg shadow-inner text-left hidden">
                <h3 class="text-xl font-bold mb-2">เฉลยคำตอบ:</h3>
                <ul id="answers-list" class="text-gray-700 space-y-2"></ul>
            </div>
            <button id="play-again-button" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-600 transform transition-transform duration-200 hover:scale-105">
                เล่นอีกครั้ง
            </button>
        </div>
    </div>

    <script>
        // Array of hardcoded quiz questions with levels provided by the user
        const hardcodedQuestions = [
            // Level 1/5 (10 Questions)
            { question: "เพลงที่ร้องว่า นึกว่าจะมาชอบเรา แท้ก็เอาเราเป็นสะพาน", answers: ["รักจางที่บางปะกง", "รักคุด", "รักสำรอง"], correct: "รักคุด", level: 1 },
            { question: "เพลงที่ร้องว่า คนที่ไม่ใช่แฟน ทำแทนทุกเรื่องไม่ได้ เหนื่อยก็รู้เหงาก็เข้าใจ แต่ไม่อาจให้ยืมอ้อมแขน", answers: ["ไม่ใช่ที่ชาร์จแบต", "ไม่ใช่ฉัน", "ไม่ใช่แฟนทำแทนไม่ได้"], correct: "ไม่ใช่แฟนทำแทนไม่ได้", level: 1 },
            { question: "เพลงที่ร้องว่า มีแฟนกับเขาหนึ่งคน หน้ามนเรียนรามคำแหงปีสี่", answers: ["ไอ้หนุ่มตังเก", "ไอ้หนุ่มรถไถ", "ไอ้หนุ่มผมยาว"], correct: "ไอ้หนุ่มตังเก", level: 1 },
            { question: "เพลงที่ร้องว่า ถ้าหากคุณจอง รับรองเมื่อไหร่เมื่อนั้น ผมบริการรับใช้มิได้แหนงหน่าย", answers: ["หัวใจผมว่าง", "หัวใจมักง่าย", "หัวใจฝากถาม"], correct: "หัวใจผมว่าง", level: 1 },
            { question: "เพลงที่ร้องว่า ขาดเธอไม่ได้ หัวใจขอสารภาพ กดโทรศัพท์รับช้าก็ยังน้อยใจ", answers: ["ใจนักเลง", "ใจมันอ้อน", "ใจสารภาพ"], correct: "ใจสารภาพ", level: 1 },
            { question: "เพลงที่ร้องว่า เบอร์เก่าเวลาเดิม ช่วยเติมเสียงให้ได้ยิน เป็นวิตามินสร้างภูมิคุ้มกันความเหงา", answers: ["โทรหาแหน่เด้อ", "โทรหาครั้งสุดท้าย", "โทรหากันหน่อย"], correct: "โทรหาแหน่เด้อ", level: 1 },
            { question: "เพลงที่ร้องว่า ขอยืมไหล่ซ้ายซบหน้าเมื่อน้ำตาหยด ระบายให้หมดความหมองแล้วน้องจะไป", answers: ["พี่ชายชั่วคราว", "พี่ชายที่แสนดี", "พี่ชายคะ"], correct: "พี่ชายชั่วคราว", level: 1 },
            { question: "เพลงที่ร้องว่า ก่อนอยู่บ้านนา เขาเรียกกันว่าอีกลอย มาอยู่กรุงเทพมีผัวนายร้อย เปลี่ยนจากกลอยมาเป็นแรมจันทร์", answers: ["คุณนายมือถือ", "คุณนายโรงแรม", "คุณนายขาแมลงสาบ"], correct: "คุณนายโรงแรม", level: 1 },
            { question: "เพลงที่ร้องว่า เจอะแต่คนรวยรวยหน้าตาสวยมากมี แต่คนใจดีดีไม่เห็นมีเลยสักคน", answers: ["สุดท้ายที่กรุงเทพ", "สุดท้ายก็กรวดน้ำ", "สุดท้ายก็ต้องรักกัน"], correct: "สุดท้ายที่กรุงเทพ", level: 1 },
            { question: "เพลงที่ร้องว่า ท่านกำลังเข้าสู่บริการรับฝากหัวใจ ลงทะเบียนฝากไว้ ตัวเอากลับไปใจให้เก็บรักษา", answers: ["ขอใจฉันคืน", "ขอใจกันหนาว", "ขอใจเธอแลกเบอร์โทร"], correct: "ขอใจเธอแลกเบอร์โทร", level: 1 },

            // Level 2/5 (10 Questions)
            { question: "เพลงที่ร้องว่า ข่มความเศร้าก้าวขึ้นเวที สวมบทวันนี้ เป็นกินนารีโดนเผา", answers: ["น้ำตาร่วงหลังพวงมาลัย", "น้ำตาโนรา", "น้ำตาน้องเพ็ญ"], correct: "น้ำตาโนรา", level: 2 },
            { question: "เพลงที่ร้องว่า ฟังเพลงมอญร้องไห้ โอ้ใจเหมือนมันจะขาดร่วงหล่น", answers: ["วอนฟ้าห่มดาว วอนสาวห่มใจ", "วอนดีเจ", "วอนรัก"], correct: "วอนรัก", level: 2 },
            { question: "เพลงที่ร้องว่า หงอยเหงา ค่ำเช้าแสนเศร้าอุรา แม่จะรู้ไหมว่า ลูกแม่บากหน้ามาเป็นนักร้อง", answers: ["จดหมายจากบ้านนอก", "จดหมายจากแนวหน้า", "จดหมายจากแม่"], correct: "จดหมายจากแม่", level: 2 },
            { question: "เพลงที่ร้องว่า อยากมองเรื่องของชาวบ้าน รำคาญจริงๆพี่จ๋า", answers: ["มอเตอร์ไซค์รับจ้าง", "มอเตอร์ไซค์นุ่งสั้น", "มอเตอร์ไซค์ทำหล่น"], correct: "มอเตอร์ไซค์นุ่งสั้น", level: 2 },
            { question: "เพลงที่ร้องว่า เติมความสุขลงในช่องว่าง ห้องนอนอ้างว้างหากมีผู้มาช่วยเติม", answers: ["คนที่เธอเผลอรัก", "คนที่ใจฝันว่าใช่ เมื่อไหร่จะมา", "คนที่รอคอย"], correct: "คนที่รอคอย", level: 2 },
            { question: "เพลงที่ร้องว่า ซอกคอที่ขาวของเจ้าก็มีสร้อยใส่ แหวนเพชรวงใหญ่ที่นิ้วนางเธอนั้น", answers: ["ช่างไม่รู้เลย", "ช่างทองร้องไห้", "ช่างร้ายเหลือ"], correct: "ช่างทองร้องไห้", level: 2 },
            { question: "เพลงที่ร้องว่า บอกมาอย่าพูดจาอ้อมค้อม จะเรียกเท่าไหร่ก็ยอม เงินทองฉันพร้อมเสมอ", answers: ["รักภาษาอะไร", "รักมาห้าปี", "รักจงรอ"], correct: "รักมาห้าปี", level: 2 },
            { question: "เพลงที่ร้องว่า น้องคงเป็นคนดีของแม่ พี่คงจะแย่เพราะเธอและแม่ไม่ห่างกันเลย", answers: ["คนดีที่อ้ายบ่ฮัก", "คนดีคนเดิม", "คนดีของแม่"], correct: "คนดีของแม่", level: 2 },
            { question: "เพลงที่ร้องว่า ทั้งที่รู้สึกได้ตลอดว่านอนกอดคนที่นอกใจ ถึงจะช้ำแทบเป็นแทบตายยังอยากให้รักยังอยู่", answers: ["กอดฉัน", "กอดแก้จน", "กอดคนนอกใจ"], correct: "กอดคนนอกใจ", level: 2 },
            { question: "เพลงที่ร้องว่า อยากเป็นคนเดียวคนนั้น ที่ไม่มีวันได้เป็น มองไปก็ได้แต่เห็น รักที่ไม่ใช่ของเรา", answers: ["อยากเป็นคนเดิม", "อยากเป็นแฟนเธอแทนเขา", "อยากเป็นใครคนนั้นที่เธอฝันถึง"], correct: "อยากเป็นแฟนเธอแทนเขา", level: 2 },

            // Level 3/5 (10 Questions)
            { question: "เพลงที่ร้องว่า ไม่รักไม่ห่วงอย่ามาทวงคืน ถ้าฉันจะลองเป็นของคนอื่น จะเป็นไรไป", answers: ["ถ้าไม่ฟังจะถามทำไม", "ถ้าคิดถึงเธอมากกว่านี้", "ถ้าฉันจะลองเป็นของคนอื่น"], correct: "ถ้าฉันจะลองเป็นของคนอื่น", level: 3 },
            { question: "เพลงที่ร้องว่า มองดูคู่อื่นทีไร มันน่าน้อยใจทำไมหนูไร้คู่", answers: ["รอเธอหันมา", "รอนานนานทรมานใจ", "รองูเข้าฝัน"], correct: "รองูเข้าฝัน", level: 3 },
            { question: "เพลงที่ร้องว่า เป็นเธอได้ไหม เป็นเธอได้ไหม ที่จะเต็มใจรับรักจากชายอย่างฉัน", answers: ["คนแบกรัก", "คนหัวใจโทรม", "คนใจง่าย"], correct: "คนแบกรัก", level: 3 },
            { question: "เพลงที่ร้องว่า อยากให้โลกนี้ต้องพลันหยุดหมุน อยากให้หัวใจของคุณหยุดปองหญิงใดมาข้องเกี่ยว", answers: ["คอยทั้งคืน", "คอยนวลที่สวนลำไย", "คอยวันเธอใจเดียว"], correct: "คอยวันเธอใจเดียว", level: 3 },
            { question: "เพลงที่ร้องว่า น้ำในบึงนั้นมันกระฉ่อนกระฉอก กลายเป็นระลอกเสียงซ่าตึงซ่าตึง", answers: ["แม่ดอกบัวแดง", "แม่ศรีเรือน", "แม่ค้าตาคม"], correct: "แม่ดอกบัวแดง", level: 3 },
            { question: "เพลงที่ร้องว่า จะยิงจะฟัน ตัวฉันจะไม่ขอร้อง อย่าให้อยู่อย่างอกกลัดหนองทนหม่นหมองร้องไห้อย่างนี้", answers: ["แผลที่หัวใจ", "แผลเป็นวันวาเลนไทน์", "แผลรักแผลแรก"], correct: "แผลที่หัวใจ", level: 3 },
            { question: "เพลงที่ร้องว่า ช้ำช้ำ แต่ต้องจำใจฝืน อยากไปหลงชื่นของรักคนอื่นทำไม", answers: ["เขามาน้องลาก่อน", "เขานอนบ้านใน", "เขาชื่ออะไร"], correct: "เขานอนบ้านใน", level: 3 },
            { question: "เพลงที่ร้องว่า ชื่นอุรา เมื่อมาชุมนุมพร้อมพรั่ง เปรียบเช่นดัง ได้ขึ้นสวรรค์เลยเชียว", answers: ["คำนี้กับคนนั้น คำนั้นกับคนนี้", "คำวอนก่อนลา", "คำตอบสุดท้าย"], correct: "คำวอนก่อนลา", level: 3 },
            { question: "เพลงที่ร้องว่า เขายังมีแฟนใหม่ ฉันล่ะทำไมถึงจะมีใหม่ไม่ได้เชียวหรือ", answers: ["แคร์กันกว่านี้ได้ไหม", "แคร์ด้วยหรือน้อง", "แคร์ทำไมผู้ชาย"], correct: "แคร์ทำไมผู้ชาย", level: 3 },
            { question: "เพลงที่ร้องว่า วังเวงเหว่ว้า รักเธอเท่าฟ้า แต่เธอกลับมาทำลาย", answers: ["ความรักเหมือนยาขม", "ความรักสีดำ", "ความรักเจ้าขา"], correct: "ความรักเหมือนยาขม", level: 3 },

            // Level 4/5 (10 Questions)
            { question: "เพลงที่ร้องว่า ที่จริง เมียของพี่ก็มี คิดดูให้ดี ลูกตั้งสามสี่แล้วหนา", answers: ["น้องมากับคำว่าใช่", "น้องเป็นคนรักที่เท่าไหร่", "น้องนอนไม่หลับ"], correct: "น้องเป็นคนรักที่เท่าไหร่", level: 4 },
            { question: "เพลงที่ร้องว่า แม่ปูจึงเดินให้ดู ลูกปูดูไม่เข้าใจ เดินเท่าไรเท่าไร ก็ไม่ตรงสักทีอยู่ดี", answers: ["ปูไข่ไก่หลง", "ปูนาขาเก", "ปูหนีบอีปิ"], correct: "ปูนาขาเก", level: 4 },
            { question: "เพลงที่ร้องว่า หอมดิน เคล้ากลิ่นไอฝน อวนระคลหอมแก้มนงคราน", answers: ["มนต์รักแม่น้ำมูล", "มนต์รักแม่กลอง", "มนต์รักลูกทุ่ง"], correct: "มนต์รักลูกทุ่ง", level: 4 },
            { question: "เพลงที่ร้องว่า ขอโทษทีโทษทีโทษที ที่ไปซี้คนมีคู่ควง", answers: ["หนูไม่รู้", "หนูกลัวตุ๊กแก", "หนูชอบชอบ"], correct: "หนูไม่รู้", level: 4 },
            { question: "เพลงที่ร้องว่า ไปหาข้างหน้าดีกว่าคนสวย หาคนร่ำรวยก็อาจจะมี", answers: ["กลับมาทำไม", "กลับมาแสดงตัวด่วน", "กลับมาถามหากำลังใจ"], correct: "กลับมาทำไม", level: 4 },
            { question: "เพลงที่ร้องว่า พอเดือนแรม รักก็แรมร้างเลื่อน โถดาวขาดเดือน ฉันก็เพื่อนไม่มี", answers: ["ร้องไห้สองหน", "ร้องไห้กับเดือน", "ร้องไห้กับฉัน"], correct: "ร้องไห้กับเดือน", level: 4 },
            { question: "เพลงที่ร้องว่า เปลี่ยนใจคนไม่รักกัน เป็นแค่ฝันที่เลือนลาง ฉันทุ่มเททุกอย่าง เธอก็ทิ้งขว้างไป", answers: ["ก้อนหินก้อนนั้น", "ก้อนหินสิ้นใจ", "ก้อนหินละเมอ"], correct: "ก้อนหินสิ้นใจ", level: 4 },
            { question: "เพลงที่ร้องว่า ลืมเมื่อวันเที่ยวงานวัดป่า เราสองสัญญา สาบาลในโบสถ์ด้วยกัน", answers: ["ส่งแค่นี้พอเดี๋ยวพ่อว่า", "ส่งข่าวทิดมั่น", "ส่งแฟนขึ้นรถไฟ"], correct: "ส่งข่าวทิดมั่น", level: 4 },
            { question: "เพลงที่ร้องว่า หลังคาเรือนรูรั่ว ข้างหัวเตียงแม่ จักรยานอีแก่ ที่พ่อปั่นยี่ห้อลบเลือน", answers: ["เขียนฝันไว้ข้างฝา", "เขียนด้วยใจ ลบด้วยน้ำตา", "เขียนรักด้วยลอลิง"], correct: "เขียนฝันไว้ข้างฝา", level: 4 },
            { question: "เพลงที่ร้องว่า วันอาทิตย์ ออฟฟิศพี่ปิดตีสอง วันจันทร์พี่ต้อง ตามท่านรองไปที่บางแสน", answers: ["ไม่มีเธอจะบอกรักใคร", "ไม่มีเวลาไปหาเมียน้อย", "ไม่มีฉันในใจเธอ"], correct: "ไม่มีเวลาไปหาเมียน้อย", level: 4 },

            // Level 5 (10 Questions)
            { question: "เพลงที่ร้องว่า อภัยเถิดดิน ได้แนบซบไอกลิ่น ดินนั้นอุ่นไม่น้อย", answers: ["ฝากไบลา", "ฝากดิน", "ฝากฝาบอกรัก"], correct: "ฝากดิน", level: 5 },
            { question: "เพลงที่ร้องว่า ไหล่นี้อย่าให้ใครมากอด มือนี้อย่าให้ใครมาจับ", answers: ["สั่งน้ำตาไม่ได้", "สั่งนาง", "สั่งรักฝากดาว"], correct: "สั่งนาง", level: 5 },
            { question: "เพลงที่ร้องว่า เป็นความเจ็บที่จำใจต้องจ่าย ซื้อเยื่อใยจากสายตาเขา", answers: ["เจ็บที่จริงใจ", "เจ็บที่ต้องจ่าย", "เจ็บที่ไม่ได้เชิญ"], correct: "เจ็บที่ต้องจ่าย", level: 5 },
            { question: "เพลงที่ร้องว่า รักหนักอก จนเก็บเอาไว้ไม่ไหว ต้องบอกให้รู้ความใน ข่มใจตัดความเก้อเขิน", answers: ["บอกใจยังไงดี", "บอกรักฝากใจ", "บอกแม่ย่าถ้ารักจริง"], correct: "บอกรักฝากใจ", level: 5 },
            { question: "เพลงที่ร้องว่า ยืนบนถนนคนสู้เพื่อฝัน ลำพัง คว้างดังเศษฟางที่ถูกลมพัด มาไกล", answers: ["ถนนสายความดี", "ถนนนี้กลับบ้าน", "ถนนค้นฝัน"], correct: "ถนนค้นฝัน", level: 5 },
            { question: "เพลงที่ร้องว่า ซองนั้นเป็นของพี่ ซองนั้นเป็นของพี่ แต่จดหมายนี้ซิเป็นของใคร", answers: ["จดหมายลาจิ๋ม", "จดหมายผิดซอง", "จดหมายใส่น้ำหอม"], correct: "จดหมายผิดซอง", level: 5 },
            { question: "เพลงที่ร้องว่า ฉันต้องอกหัก ก็เพราะรักเมีย ยอมเสียเธอไป ทั้งที่ใจไม่ปรารถนา", answers: ["อกหักจากปักต้าย", "อกหักพักปลายซอย", "อกหักเพราะรักเมีย"], correct: "อกหักเพราะรักเมีย", level: 5 },
            { question: "เพลงที่ร้องว่า ตำแหน่งคนดีของใจ ยกให้เพียงเธอคนนี้ ก่อนเลิกงานสิบห้านาที จะรีบโทรไปหาเธอ", answers: ["คิดถึงเธอแทบขาดใจ", "คิดถึงเธออยากเจอเหลือเกิน", "คิดถึงเธอทุกทีที่อยู่คนเดียว"], correct: "คิดถึงเธออยากเจอเหลือเกิน", level: 5 },
            { question: "เพลงที่ร้องว่า เป็นโสดมาหลายหน้าหนาว เนื้อสาวทั้งตึงทั้งเต้น", answers: ["แฟนฉันไม่ต้องหล่อ", "แฟนเก็บ", "แฟนใครโทรมา"], correct: "แฟนฉันไม่ต้องหล่อ", level: 5 },
            { question: "เพลงที่ร้องว่า ยามเรารวย แฟนก็ให้ดอกไม้ เมื่อจนเข็ญใจ แฟนก็ให้ก้อนอิฐ", answers: ["ดอกไม้กับก้อนอิฐ", "ดอกไม้วันแม่", "ดอกไม้ในป่าช้า"], correct: "ดอกไม้กับก้อนอิฐ", level: 5 },
        ];

        // Get DOM elements
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const endScreen = document.getElementById('end-screen');
        const startButtonHardcoded = document.getElementById('start-button-hardcoded');
        const questionText = document.getElementById('question-text');
        const answersContainer = document.getElementById('answers-container');
        const feedback = document.getElementById('feedback');
        const nextButton = document.getElementById('next-button');
        const finalMessage = document.getElementById('final-message');
        const scoreText = document.getElementById('score-text');
        const answersReview = document.getElementById('answers-review');
        const answersList = document.getElementById('answers-list');
        const playAgainButton = document.getElementById('play-again-button');
        const levelDisplay = document.getElementById('level-display');
        const loadingSpinner = document.getElementById('loading-spinner');

        // Bonus points for each level
        const levelBonuses = {
            1: 100,
            2: 200,
            3: 500,
            4: 800,
            5: 1000
        };

        let currentQuestionIndex = 0;
        let score = 0;
        let totalScore = 0; 
        let incorrectAnswersCount = 0;
        let currentRoundQuestions = [];
        let currentLevel = 1;

        // Function to create and play a success sound
        function playSuccessSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.01);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        // Function to create and play a fail sound
        function playFailSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(220, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.01);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        // Function to create and play a bonus sound
        function playBonusSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator1 = audioCtx.createOscillator();
            const oscillator2 = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator1.type = 'sine';
            oscillator1.frequency.setValueAtTime(1000, audioCtx.currentTime);
            
            oscillator2.type = 'sine';
            oscillator2.frequency.setValueAtTime(1200, audioCtx.currentTime);

            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.01);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);

            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator1.start(audioCtx.currentTime);
            oscillator2.start(audioCtx.currentTime + 0.1);
            oscillator1.stop(audioCtx.currentTime + 0.3);
            oscillator2.stop(audioCtx.currentTime + 0.4);
        }

        // Function to create and play a game over (smashing) sound
        function playGameOverSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(120, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(60, audioCtx.currentTime + 1.0);

            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime + 1.0);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 1.1);
        }

        // Function to play a celebratory fanfare for winning the entire game
        function playGameWonSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const now = audioCtx.currentTime;
            
            // Frequencies for a grand, triumphant fanfare
            const notes = [
                { freq: 261.63, time: 0.0, duration: 0.15, gain: 0.7 }, // C4
                { freq: 329.63, time: 0.15, duration: 0.15, gain: 0.7 }, // E4
                { freq: 392.00, time: 0.3, duration: 0.15, gain: 0.7 }, // G4
                { freq: 523.25, time: 0.45, duration: 0.15, gain: 0.8 }, // C5
                { freq: 783.99, time: 0.7, duration: 0.5, gain: 0.9 }, // G5 (sustained high note)
                { freq: 1046.50, time: 0.7, duration: 0.5, gain: 0.9 } // C6 (sustained high note, combined with G5 for a powerful sound)
            ];

            // Create a function to play a note
            function playNote(freq, startTime, duration, volume) {
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                // Use triangle wave for a brighter, more brass-like sound
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(freq, now);
                gainNode.gain.setValueAtTime(0, now + startTime);
                gainNode.gain.linearRampToValueAtTime(volume, now + startTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, now + startTime + duration - 0.05);

                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start(now + startTime);
                oscillator.stop(now + startTime + duration);
            }

            // Play the fanfare
            notes.forEach(note => {
                playNote(note.freq, note.time, note.duration, note.gain);
            });
        }

        // Function to shuffle an array
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Function to start a new game round based on level
        function startNewRound() {
            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            endScreen.classList.add('hidden');
            currentQuestionIndex = 0;
            score = 0; // Reset score for the current level
            incorrectAnswersCount = 0;
            
            // Filter questions for the current level and then shuffle them.
            // This ensures questions are always fresh and within the correct level.
            currentRoundQuestions = shuffle(hardcodedQuestions.filter(q => q.level === currentLevel));
            
            if (currentRoundQuestions.length === 0) {
                    // Using a custom message box instead of alert()
                    const messageBox = document.createElement('div');
                    messageBox.className = 'absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded-xl shadow-lg border border-gray-200 z-50';
                    messageBox.setAttribute("role", "alertdialog");
                    messageBox.setAttribute("aria-labelledby", "dialog-title");
                    messageBox.innerHTML = '<p id="dialog-title" class="text-gray-800">ขออภัย! ในระดับนี้ยังไม่มีคำถาม กรุณาติดต่อผู้พัฒนา</p><button class="mt-4 bg-blue-500 text-white font-bold py-2 px-4 rounded-full" onclick="this.parentElement.remove()">ตกลง</button>';
                    document.body.appendChild(messageBox);
                    return;
            }

            levelDisplay.textContent = `ระดับ ${currentLevel}/5`;
            showQuestion();
        }

        // Function to display a question
        function showQuestion() {
            if (currentQuestionIndex >= currentRoundQuestions.length) {
                endRound();
                return;
            }

            const currentQuestion = currentRoundQuestions[currentQuestionIndex];
            questionText.textContent = `ข้อที่ ${currentQuestionIndex + 1}: ${currentQuestion.question}`;
            answersContainer.innerHTML = '';
            feedback.textContent = '';
            nextButton.classList.add('hidden');

            // Shuffle the answer options for each question
            const shuffledAnswers = shuffle([...currentQuestion.answers]);

            shuffledAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.textContent = answer;
                button.classList.add(
                    'bg-gray-200', 'text-gray-800', 'font-semibold', 'py-3', 'px-6',
                    'rounded-full', 'shadow-md', 'hover:bg-gray-300', 'transform',
                    'transition-transform', 'duration-200', 'hover:scale-105'
                );
                button.addEventListener('click', () => checkAnswer(answer, button));
                answersContainer.appendChild(button);
            });
        }

        // Function to check the selected answer
        function checkAnswer(selectedAnswer, button) {
            const currentQuestion = currentRoundQuestions[currentQuestionIndex];
            const allButtons = answersContainer.querySelectorAll('button');
            
            if (selectedAnswer === currentQuestion.correct) {
                score++;
                totalScore++; // Update total score immediately
                feedback.textContent = 'ถูกต้อง! 🎉';
                feedback.classList.remove('text-red-500');
                feedback.classList.add('text-green-500');
                button.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                button.classList.add('bg-green-500', 'text-white');
                playSuccessSound();
            } else {
                incorrectAnswersCount++;
                feedback.textContent = `ผิด! 😢 (ตอบผิดไปแล้ว ${incorrectAnswersCount} ครั้ง)`;
                feedback.classList.remove('text-green-500');
                feedback.classList.add('text-red-500');
                button.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                button.classList.add('bg-red-500', 'text-white');
                playFailSound();
                if (incorrectAnswersCount >= 3) {
                    // This is the key change: delay the game over screen to prevent sound overlap
                    setTimeout(() => {
                        gameOver();
                    }, 500);
                    return;
                }
            }

            allButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === currentQuestion.correct && selectedAnswer !== currentQuestion.correct) {
                    btn.classList.remove('bg-gray-200');
                    btn.classList.add('bg-green-500', 'text-white');
                }
            });

            if (currentQuestionIndex < currentRoundQuestions.length - 1) {
                nextButton.classList.remove('hidden');
            } else {
                // Delay before ending the round to allow the final button press animation to finish
                setTimeout(() => {
                    endRound();
                }, 1000);
            }
        }

        // Function for a winning round
        function endRound() {
            // Check for game over first
            if (incorrectAnswersCount >= 3) {
                // This condition is now handled inside checkAnswer
                return;
            }

            quizScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');

            // Handle score and bonus
            let bonus = 0;
            let finalSoundDelay = 0;

            if (score === 10) {
                bonus = levelBonuses[currentLevel] || 0;
                totalScore += bonus;
                finalMessage.textContent = 'ยอดเยี่ยม! คุณผ่านระดับนี้และได้รับโบนัสแล้ว!';
                playBonusSound();
                finalSoundDelay = 500; // Add a short delay to allow bonus sound to finish
            } else {
                finalMessage.textContent = 'คุณผ่านระดับนี้แล้ว!';
            }

            setTimeout(() => {
                // Show answers review on level completion
                answersReview.classList.remove('hidden');
                answersList.innerHTML = '';
                currentRoundQuestions.forEach((q, index) => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<span class="font-semibold">ข้อที่ ${index + 1}:</span> ${q.question}<br>
                                            <span class="text-green-600 font-bold">คำตอบที่ถูกต้อง:</span> ${q.correct}`;
                    answersList.appendChild(listItem);
                });

                if (currentLevel < 5) {
                    scoreText.innerHTML = `คะแนนระดับนี้: ${score} จาก ${currentRoundQuestions.length} คะแนน<br>โบนัส: ${bonus} คะแนน<br>คะแนนสะสม: ${totalScore} คะแนน`;
                    playAgainButton.textContent = 'ไปต่อระดับต่อไป';
                } else {
                    scoreText.innerHTML = `คะแนนสุดท้ายของคุณ: ${score} จาก ${currentRoundQuestions.length} คะแนน<br>โบนัส: ${bonus} คะแนน<br>คะแนนสะสม: ${totalScore} คะแนน<br><br>ยินดีด้วย! คุณพิชิตเกมแล้ว!`;
                    playAgainButton.textContent = 'เล่นใหม่อีกครั้ง';
                    playGameWonSound(); // Play the special sound for winning the entire game
                }
            }, finalSoundDelay);
        }
        
        // Function for a game over
        function gameOver() {
            quizScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            finalMessage.textContent = 'เกมโอเวอร์! 😢';
            scoreText.innerHTML = `คุณทำคะแนนสะสมได้ทั้งหมด: ${totalScore} คะแนน<br><br>ลองใหม่อีกครั้งเพื่อพิชิต<br>เส้นทางสู่แชมป์!`;
            playAgainButton.textContent = 'เล่นใหม่อีกครั้ง';
            playGameOverSound();

            // Hide answers review on game over
            answersReview.classList.add('hidden');
        }

        // Function to move to the next question
        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        // Add event listeners to buttons
        startButtonHardcoded.addEventListener('click', () => {
            currentLevel = 1;
            totalScore = 0; // Reset total score for a new game
            startNewRound();
        });

        nextButton.addEventListener('click', nextQuestion);

        playAgainButton.addEventListener('click', () => {
            if (currentLevel < 5 && incorrectAnswersCount < 3) {
                currentLevel++; // Move to the next level if not game over and not last level
                startNewRound();
            } else {
                // Reset for a completely new game if all levels completed or game over
                currentLevel = 1;
                totalScore = 0;
                startNewRound();
            }
        });
    </script>
</body>
</html>
