<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>เกมยิงจุดโทษ 2005/2006</title>
<style>
body { 
  font-family: Tahoma; 
  background:#111; 
  color:white; 
  text-align:center; 
  margin:0;
  padding:20px;
  height:100vh;
  overflow:hidden;
  position:relative;
}

.shot-btn { 
  position:fixed;
  background:rgba(255,255,255,0.9); 
  border-radius:15px;
  padding:25px 30px;
  font-weight:bold;
  cursor:pointer;
  border:3px solid #fff;
  font-size:22px;
  z-index:1000;
  box-shadow:0 8px 20px rgba(0,0,0,0.5);
  transition:all 0.2s;
}

.shot-btn:active {
  transform:scale(0.95);
  box-shadow:0 4px 10px rgba(0,0,0,0.5);
}

#tl { 
  top:10%; 
  left:10%; 
}

#tr { 
  top:10%; 
  right:10%; 
}

#center { 
  top:50%; 
  left:50%; 
  transform:translate(-50%, -50%); 
}

#bl { 
  bottom:10%; 
  left:10%; 
}

#br { 
  bottom:10%; 
  right:10%; 
}

#scoreBoard { 
  margin-top:20px; 
  font-size:28px;
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  z-index:1001;
  background:rgba(0,0,0,0.7);
  padding:15px 30px;
  border-radius:15px;
  border:2px solid #fff;
}

#teamSelect {
  display:flex;
  flex-direction:column;
  gap:20px;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

#teamSelect button {
  background:rgba(255,255,255,0.9);
  border-radius:15px;
  padding:25px 40px;
  font-weight:bold;
  cursor:pointer;
  border:3px solid #fff;
  font-size:24px;
  transition:all 0.2s;
}

#teamSelect button:active {
  transform:scale(0.95);
}

#gameScreen {
  width:100vw;
  height:100vh;
}

/* ===== หน้าแรก ===== */
#homeScreen {
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100vh;
  gap:40px;
}

#homeScreen h1 {
  font-size:48px;
  margin:0;
  text-shadow:2px 2px 4px rgba(0,0,0,0.8);
}

#modeSelect {
  display:flex;
  flex-direction:column;
  gap:30px;
}

.mode-btn {
  background:rgba(255,255,255,0.95);
  border-radius:20px;
  padding:30px 50px;
  font-weight:bold;
  cursor:pointer;
  border:4px solid #fff;
  font-size:28px;
  transition:all 0.3s;
  box-shadow:0 10px 25px rgba(0,0,0,0.5);
  color:#333;
}

.mode-btn:hover {
  background:#fff;
  transform:translateY(-5px);
  box-shadow:0 15px 35px rgba(0,0,0,0.7);
}

.mode-btn:active {
  transform:scale(0.98) translateY(-2px);
}

#onlineScreen {
  display:none;
  flex-direction:column;
  gap:30px;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

#onlineScreen p {
  font-size:24px;
}

/* เพิ่ม: แสดงข้อความ TTS บนหน้าจอ */
#ttsDisplay {
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.7);
  color:white;
  padding:12px 24px;
  border-radius:12px;
  font-size:20px;
  max-width:90%;
  z-index:1002;
  opacity:0;
  transition:opacity 0.3s;
  pointer-events:none;
}
#ttsDisplay.show { opacity:1; }

/* เพิ่ม: ซ่อน h1 เมื่อเข้าหน้าเกม */
#gameScreen h1 { display:none; }
</style>
</head>
<body>

<h1 style="margin-bottom:40px;">เกมยิงจุดโทษ 2005/2006</h1>

<!-- ===== หน้าแรก ===== -->
<div id="homeScreen">
  <div id="modeSelect">
    <button class="mode-btn" onclick="selectMode('bot')" aria-label="เล่นกับบอท" tabindex="0">เล่นกับบอท</button>
    <button class="mode-btn" onclick="selectMode('online')" aria-label="เล่นออนไลน์" tabindex="0">เล่นออนไลน์</button>
  </div>
</div>

<!-- ===== หน้าจอออนไลน์ (ว่างไว้) ===== -->
<div id="onlineScreen">
  <p style="font-size:28px;">โหมดเล่นออนไลน์</p>
  <p>กำลังพัฒนา...</p>
  <button class="mode-btn" onclick="backToHome()" style="font-size:20px; padding:20px 40px;">กลับเมนูหลัก</button>
</div>

<!-- ===== หน้าจอเลือกทีม (เดิม) ===== -->
<div id="teamSelect" style="display:none;">
<p style="font-size:28px;">เลือกทีมของคุณ</p>
<button onclick="selectTeam('Manchester United')" aria-label="แมนเชสเตอร์ ยูไนเต็ด" tabindex="0">แมนเชสเตอร์ ยูไนเต็ด</button>
<button onclick="selectTeam('Liverpool')" aria-label="ลิเวอร์พูล" tabindex="0">ลิเวอร์พูล</button>
<button onclick="selectTeam('Arsenal')" aria-label="อาร์เซนอล" tabindex="0">อาร์เซนอล</button>
<button onclick="selectTeam('Chelsea')" aria-label="เชลซี" tabindex="0">เชลซี</button>
</div>

<!-- ===== หน้าจอเกม (เดิม) ===== -->
<div id="gameScreen" style="display:none;">
<div id="scoreBoard">Score ตอนนี้คือ 0 - 0</div>

<button id="tl" class="shot-btn" onclick="debounceClick('TL')" aria-label="มุมซ้ายบน" tabindex="0">มุมซ้ายบน</button>
<button id="tr" class="shot-btn" onclick="debounceClick('TR')" aria-label="มุมขวาบน" tabindex="0">มุมขวาบน</button>
<button id="center" class="shot-btn" onclick="debounceClick('C')" aria-label="ตรงกลาง" tabindex="0">ตรงกลาง</button>
<button id="bl" class="shot-btn" onclick="debounceClick('BL')" aria-label="มุมซ้ายล่าง" tabindex="0">มุมซ้ายล่าง</button>
<button id="br" class="shot-btn" onclick="debounceClick('BR')" aria-label="มุมขวาล่าง" tabindex="0">มุมขวาล่าง</button>
</div>

<!-- แสดงข้อความ TTS บนหน้าจอ -->
<div id="ttsDisplay"></div>

<!-- aria-live สำหรับ iOS -->
<div id="tts" aria-live="assertive" style="position:absolute;left:-9999px;"></div>

<!-- เสียง -->
<audio id="bgm" loop src="audio/b.mp3"></audio>
<audio id="goal" src="audio/t.mp3"></audio>
<audio id="miss" src="audio/f.mp3"></audio>
<audio id="end" src="audio/end.mp3"></audio>

<script>
/* =============================== 
   ระบบหน้าแรก
   =============================== */
function selectMode(mode) {
  if(mode === 'bot') {
    document.getElementById("homeScreen").style.display = "none";
    document.getElementById("teamSelect").style.display = "flex";
    // Focus ไปที่ปุ่มแรกของหน้าเลือกทีม
    setTimeout(() => {
      const firstBtn = document.querySelector('#teamSelect button');
      if(firstBtn) firstBtn.focus();
    }, 100);
  } else if(mode === 'online') {
    // เปลี่ยนแปลงตรงนี้: เปิดไฟล์ o.html แทนการแสดง onlineScreen
    window.location.href = "o.html";
  }
}

function backToHome() {
  document.getElementById("onlineScreen").style.display = "none";
  document.getElementById("homeScreen").style.display = "flex";
}

/* =============================== 
   ระบบ TTS Queue + แสดงบนหน้าจอ
   =============================== */
let ttsQueue = [];
let isSpeaking = false;
const ttsDisplay = document.getElementById("ttsDisplay");

function speak(text){
  ttsQueue.push(text);
  processTTS();
}

function processTTS(){
  if(isSpeaking || ttsQueue.length === 0) return;

  isSpeaking = true;
  const msg = ttsQueue.shift();

  // แสดงข้อความบนหน้าจอ
  ttsDisplay.textContent = msg;
  ttsDisplay.classList.add('show');

  setTimeout(()=>{
    document.getElementById("tts").innerText = msg;
    setTimeout(()=>{
      isSpeaking = false;
      document.getElementById("tts").innerText = "";
      ttsDisplay.classList.remove('show');
      processTTS();
    }, Math.max(600, msg.length * 40));
  }, 50);
}

/* =============================== 
   ฟังก์ชันรอให้เสียงเล่นจนจบ
   =============================== */
function waitForSound(audioEl){
  return new Promise(resolve => {
    audioEl.onended = ()=>resolve();
    audioEl.play().catch(()=> resolve());
  });
}

/* =============================== 
   ข้อมูลทีม
   =============================== */
const squads = {
  "Manchester United": {
    "players": ["แกรี่ เนวิลล์","ริโอ เฟอร์ดินานด์","เวส บราวน์","ปาทริซ เอฟร่า",
                "คริสเตียโน่ โรนัลโด้","พอล สโคลส์","จอห์น โอเช","ไรอัน กิ๊กส์",
                "เวย์น รูนี่ย์","รุด ฟาน นิสเทลรอย"],
    "keeper": "เอ็ดวิน ฟาน เดอร์ ซาร์"
  },
  "Liverpool": {
    "players": ["สตีฟ ฟินแนน","เจมี่ คาร์ราเกอร์","ซามี่ ฮูเปีย","จอห์น อาร์เน่ รีเซ่",
                "ซาบี อลอนโซ่","โมฮาเหม็ด ซิสโซโก้","สตีเว่น เจอร์ราร์ด","หลุยส์ การ์เซีย",
                "ปีเตอร์ เคร้าช์","ฌิบริล ซิสเซ่"],
    "keeper": "เปเป้ เรน่า"
  },
  "Arsenal": {
    "players": ["เอ็มมานูเอล เอบูเอ้","โคโล ตูเร่","โซล แคมเบล","แอชลีย์ โคล",
                "อเล็กซานเดอร์ เคล็บ","ฌิลแบร์โต้ ซิลวา","เชส ฟาเบรกัส","โรแบร์ ปิแรส",
                "เฟรดริก ลุงเบิร์ก","เธียร์รี่ อองรี"],
    "keeper": "เยนส์ เลห์มันน์"
  },
  "Chelsea": {
    "players": ["เปาโล เฟร์เรร่า","ริคาร์โด้ คาร์วัลโญ่","จอห์น เทอร์รี่","วิลเลียม กัลลาส",
                "โคล้ด มาเกเลเล่","มิคาเอล เอสเซียง","แฟรงก์ แลมพาร์ด","โจ โคล",
                "อาร์เยน ร็อบเบน","เฮอร์นัน เครสโป"],
    "keeper": "ปีเตอร์ เช็ก"
  }
};

/* =============================== 
   ตัวแปรเกม
   =============================== */
let userTeam, cpuTeam;
let score = 0, oppScore = 0;
let turn = 0;
let isSudden = false;
let shotIndexUser = 0, shotIndexCPU = 0;

let userShotsOrder = [];
let cpuShotsOrder = [];

let shooterTeam = "";
let shooterName = "";

/* =28 
   Debounce สำหรับ VoiceOver
   =============================== */
let isButtonLocked = false;

function debounceClick(dir){
  if(isButtonLocked) return;
  isButtonLocked = true;
  chooseDirection(dir);
  setTimeout(()=>{ isButtonLocked = false; }, 100);
}

/* =============================== 
   เสียง
   =============================== */
const bgm = document.getElementById("bgm");
const goalSnd = document.getElementById("goal");
const missSnd = document.getElementById("miss");
const endSnd = document.getElementById("end");

function playSound(el){
  el.currentTime = 0;
  el.play().catch(()=>{});  
}

function stopBGM(){
  bgm.pause();
  bgm.currentTime = 0;
}

/* =============================== 
   Utility
   =============================== */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function createShotsOrder(team){
  let players = squads[team].players.slice();
  shuffle(players);
  players.push(squads[team].keeper);
  return players;
}

/* =============================== 
   เลือกทีม
   =============================== */
function selectTeam(team){
  userTeam = team;
  let remain = Object.keys(squads).filter(t=>t!==team);
  cpuTeam = remain[Math.floor(Math.random()*remain.length)];

  document.getElementById("teamSelect").style.display="none";
  document.getElementById("gameScreen").style.display="block";

  // ซ่อน h1 ชื่อเกมเมื่อเข้าหน้าเกม
  document.querySelector('h1').style.display = 'none';

  userShotsOrder = createShotsOrder(userTeam);
  cpuShotsOrder = createShotsOrder(cpuTeam);

  score=0; oppScore=0; turn=0;
  shotIndexUser=0; shotIndexCPU=0;
  isSudden=false;

  updateScoreboard();
  startTurn();

  playSound(bgm);
}

/* =============================== 
   เริ่มตา
   =============================== */
function startTurn(){
  if(turn===0){
    shooterTeam = userTeam;
    shooterName = userShotsOrder[shotIndexUser];
    speak(`ลูกที่ ${shotIndexUser+1} ${shooterTeam}: ${shooterName} เตรียมยิง`);
  } else {
    shooterTeam = cpuTeam;
    shooterName = cpuShotsOrder[shotIndexCPU];
    let keeper = squads[userTeam].keeper;
    speak(`ลูกที่ ${shotIndexCPU+1} ${shooterTeam}: ${shooterName} เตรียมยิง ${keeper} ของคุณพร้อมเซฟ`);
  }
}

/* =============================== 
   ยิง
   =============================== */
async function chooseDirection(dir){
  let keeperDir = ["TL","TR","C","BL","BR"][Math.floor(Math.random()*5)];
  let isGoal = dir !== keeperDir;

  if(turn===0) score += isGoal?1:0;
  else oppScore += isGoal?1:0;

  updateScoreboard();

  const finalMsg = `${shooterName} ${shooterTeam} ยิง${isGoal?"เข้า":"ไม่เข้า"}! Score ${score} - ${oppScore}`;

  if(isGoal) await waitForSound(goalSnd);
  else await waitForSound(missSnd);

  speak(finalMsg);

  if(turn===0) shotIndexUser++;
  else shotIndexCPU++;

  setTimeout(checkGameEndOrNext, 1000);
}

/* =============================== 
   ตรวจจบเกม
   =============================== */
function checkGameEndOrNext(){
  let rU = 5 - shotIndexUser;
  let rC = 5 - shotIndexCPU;
  let end = false;

  if(!isSudden){
    if(shotIndexUser > shotIndexCPU){
      if(score - oppScore > rC){
        end = true;
      }
    } else if(shotIndexCPU >= shotIndexUser){
      if(oppScore - score > rU){
        end = true;
      }
    }

    if(shotIndexUser >= 5 && shotIndexCPU >= 5){
      if(score !== oppScore){
        end = true;
      } else {
        isSudden = true;
        speak("เข้าสู่ซัดเดนเดธ!");
      }
    }
  } else {
    if(shotIndexUser > shotIndexCPU){
      turn = 1;
      setTimeout(startTurn, 800);
      return;
    } else if(shotIndexCPU >= shotIndexUser){
      if(score !== oppScore){
        end = true;
      }
    }
  }

  if(end){
    stopBGM();
    waitForSound(endSnd).then(()=>{
      let msg = score > oppScore ? `${userTeam} ชนะ!` : score < oppScore ? `${cpuTeam} ชนะ!` : "เสมอ!";
      speak(msg);
      setTimeout(()=> alert(msg), 800);
      setTimeout(resetGame, 1200);
    });
  } else {
    turn = 1 - turn;
    setTimeout(startTurn, 800);
  }
}

/* =============================== 
   อัปเดตคะแนน
   =============================== */
function updateScoreboard(){
  document.getElementById("scoreBoard").innerText = 
      `Score ตอนนี้คือ ${score} - ${oppScore}`;
}

/* =============================== 
   รีเซ็ตเกม
   =============================== */
function resetGame(){
  stopBGM();
  score=0; oppScore=0;
  turn=0; shotIndexUser=0; shotIndexCPU=0;
  isSudden=false;

  userShotsOrder=[]; 
  cpuShotsOrder=[];

  document.getElementById("gameScreen").style.display="none";
  document.getElementById("teamSelect").style.display="flex";

  // แสดง h1 กลับเมื่อกลับไปเลือกทีม
  document.querySelector('h1').style.display = 'block';
}
</script>
</body>
</html>