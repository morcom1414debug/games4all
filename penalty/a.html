<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>เกมยิงจุดโทษ 2005-2006</title>
<style>
body { font-family: Tahoma; background: #111; color:white; text-align:center;}
.goal-container {position:relative;width:400px;height:220px;margin:auto;}
.goal-img {width:100%;height:100%;border:2px solid #fff;border-radius:10px;}
.shot-btn {position:absolute;background:rgba(255,255,255,0.85);border-radius:7px;padding:7px;font-weight:bold;cursor:pointer;border:none;}
#tl {top:10px; left:20px;} #tr {top:10px; right:20px;} #center {top:90px; left:50%; transform:translateX(-50%);}
#bl {bottom:10px; left:20px;} #br {bottom:10px; right:20px;}
#scoreBoard {margin-top:20px; font-size:20px;}

/* เพิ่มเฉพาะ: หน้าเลือกโหมด + โหลด */
#modeSelect, #loadingScreen, #onlineScreen { position:fixed; top:0; left:0; width:100%; height:100%; background:#111; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; }
#modeSelect button, #onlineScreen button { margin:10px; padding:15px 30px; font-size:18px; background:#c00; color:white; border:none; border-radius:8px; cursor:pointer; }
#loadingScreen { font-size:24px; }
#teamSelect, #gameScreen { display:none; }
</style>
</head>
<body>

<!-- หน้าเลือกโหมด (ใหม่) -->
<div id="modeSelect">
  <h1>เกมยิงจุดโทษ 2005–2006</h1>
  <button onclick="startMode('bot')">เล่นกับบอท</button>
  <button onclick="startMode('online')">เล่นออนไลน์</button>
</div>

<!-- หน้าจอโหลด (ใหม่) -->
<div id="loadingScreen" style="display:none;">
  <p>กำลังโหลดเกม กรุณารอสักครู่...</p>
</div>

<!-- หน้าออนไลน์ (ใหม่ - placeholder) -->
<div id="onlineScreen" style="display:none;">
  <h1>เกมยิงจุดโทษ 2005–2006</h1>
  <p>โหมดออนไลน์ (กำลังพัฒนา)</p>
  <button onclick="document.getElementById('onlineScreen').style.display='none'; document.getElementById('modeSelect').style.display='flex';">กลับ</button>
</div>

<!-- หน้าเลือกทีม (เดิม) -->
<div id="teamSelect">
<p>เลือกทีมของคุณ</p>
<button onclick="selectTeam('Manchester United')">แมนเชสเตอร์ ยูไนเต็ด</button>
<button onclick="selectTeam('Liverpool')">ลิเวอร์พูล</button>
<button onclick="selectTeam('Arsenal')">อาร์เซนอล</button>
<button onclick="selectTeam('Chelsea')">เชลซี</button>
</div>

<!-- หน้าจอเกม (เดิม) -->
<div id="gameScreen">
<div id="scoreBoard">Score ตอนนี้คือ 0 - 0</div>

<div class="goal-container">
<img src="https://i.imgur.com/v8hF1P8.png" class="goal-img">
<button id="tl" class="shot-btn" onclick="chooseDirection('TL')">มุมซ้ายบน</button>
<button id="tr" class="shot-btn" onclick="chooseDirection('TR')">มุมขวาบน</button>
<button id="center" class="shot-btn" onclick="chooseDirection('C')">ตรงกลาง</button>
<button id="bl" class="shot-btn" onclick="chooseDirection('BL')">มุมซ้ายล่าง</button>
<button id="br" class="shot-btn" onclick="chooseDirection('BR')">มุมขวาล่าง</button>
</div>
</div>

<!-- เสียง -->
<audio id="bgm" loop src="audio/b.mp3"></audio>
<audio id="goal" src="audio/t.mp3"></audio>
<audio id="miss" src="audio/f.mp3"></audio>
<audio id="end" src="audio/end.mp3"></audio>

<div id="tts" aria-live="assertive" style="position:absolute;left:-9999px;"></div>

<script>
// ===== เพิ่มเฉพาะ: ระบบโหมด + preload =====
const audioFiles = 'audio/t.mp3', 'audio/f.mp3', 'audio/end.mp3'];

function startMode(mode) {
  document.getElementById('modeSelect').style.display = 'none';
  document.getElementById('loadingScreen').style.display = 'flex';

  // Preload ทุกไฟล์
  let loaded = 0;
  audioFiles.forEach(src => {
    const audio = new Audio();
    audio.src = src;
    audio.oncanplaythrough = () => {
      loaded++;
      if (loaded === audioFiles.length) {
        setTimeout(() => {
          document.getElementById('loadingScreen').style.display = 'none';
          if (mode === 'bot') {
            document.getElementById('teamSelect').style.display = 'block';
          } else {
            document.getElementById('onlineScreen').style.display = 'flex';
          }
        }, 300);
      }
    };
    audio.onerror = () => {
      loaded++;
      if (loaded === audioFiles.length) {
        setTimeout(() => {
          document.getElementById('loadingScreen').style.display = 'none';
          if (mode === 'bot') {
            document.getElementById('teamSelect').style.display = 'block';
          } else {
            document.getElementById('onlineScreen').style.display = 'flex';
          }
        }, 300);
      }
    };
    audio.load();
  });
}

// ----- โค้ดเดิมทั้งหมด (ไม่เปลี่ยนเลย) -----
const squads = {
  "Manchester United": {
    "players": ["แกรี่ เนวิลล์","ริโอ เฟอร์ดินานด์","เวส บราวน์","ปาทริซ เอฟร่า",
                "คริสเตียโน่ โรนัลโด้","พอล สโคลส์","จอห์น โอเช","ไรอัน กิ๊กส์",
                "เวย์น รูนี่ย์","รุด ฟาน นิสเทลรอย"],
    "keeper": "เอ็ดวิน ฟาน เดอร์ ซาร์"
  },
  "Liverpool": {
    "players": ["สตีฟ ฟินแนน","เจมี่ คาร์ราเกอร์","ซามี่ ฮูเปีย","จอห์น อาร์เน่ รีเซ่",
                "ซาบี อลอนโซ่","โมฮาเหม็ด ซิสโซโก้","สตีเว่น เจอร์ราร์ด","หลุยส์ การ์เซีย",
                "ปีเตอร์ เคร้าช์","ฌิบริล ซิสเซ่"],
    "keeper": "เปเป้ เรน่า"
  },
  "Arsenal": {
    "players": ["เอ็มมานูเอล เอบูเอ้","โคโล ตูเร่","โซล แคมเบล","แอชลีย์ โคล",
                "อเล็กซานเดอร์ เคล็บ","ฌิลแบร์โต้ ซิลวา","เชส ฟาเบรกัส","โรแบร์ ปิแรส",
                "เฟรดริก ลุงเบิร์ก","เธียร์รี่ อองรี"],
    "keeper": "เยนส์ เลห์มันน์"
  },
  "Chelsea": {
    "players": ["เปาโล เฟร์เรร่า","ริคาร์โด้ คาร์วัลโญ่","จอห์น เทอร์รี่","วิลเลียม กัลลาส",
                "โคล้ด มาเกเลเล่","มิคาเอล เอสเซียง","แฟรงก์ แลมพาร์ด","โจ โคล",
                "อาร์เยน ร็อบเบน","เฮอร์นัน เครสโป"],
    "keeper": "ปีเตอร์ เช็ก"
  }
};

let userTeam, cpuTeam;
let score = 0, oppScore = 0;
let turn = 0;
let isSudden = false;
let shotIndexUser = 0, shotIndexCPU = 0;

let userShotsOrder = [];
let cpuShotsOrder = [];
let shooterTeam = "", shooterName = "";

const bgm = document.getElementById("bgm");
const goalSnd = document.getElementById("goal");
const missSnd = document.getElementById("miss");
const endSnd = document.getElementById("end");

function playSound(el){
  el.currentTime = 0;
  el.play().catch(()=>{});
}

function stopBGM(){
  bgm.pause();
  bgm.currentTime = 0;
}

function speak(t){ document.getElementById("tts").innerText = t; }

function createShotsOrder(team){
  let players = squads[team].players.slice();
  shuffle(players);
  players.push(squads[team].keeper);
  return players;
}

function selectTeam(team){
  userTeam = team;
  let remain = Object.keys(squads).filter(t=>t!==team);
  cpuTeam = remain[Math.floor(Math.random()*remain.length)];

  document.getElementById("teamSelect").style.display="none";
  document.getElementById("gameScreen").style.display="block";

  userShotsOrder = createShotsOrder(userTeam);
  cpuShotsOrder = createShotsOrder(cpuTeam);

  score=0; oppScore=0; turn=0; shotIndexUser=0; shotIndexCPU=0; isSudden=false;

  updateScoreboard();
  startTurn();

  playSound(bgm);
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function getShooter(team, orderList, indexObj){
  if(indexObj.value >= orderList.length){
    orderList = createShotsOrder(team);
    indexObj.value = 0;
    indexObj.list = orderList;
  }
  return {name: orderList[indexObj.value], list: orderList};
}

function startTurn(){
  if(turn===0){
    let ref = {value:shotIndexUser, list:userShotsOrder};
    let d = getShooter(userTeam, userShotsOrder, ref);
    shooterTeam = userTeam; 
    shooterName = d.name;
    userShotsOrder = d.list;

    speak(`ลูกที่ ${shotIndexUser+1} ${shooterTeam}: ${shooterName} เตรียมยิง`);

  } else {
    let ref = {value:shotIndexCPU, list:cpuShotsOrder};
    let d = getShooter(cpuTeam, cpuShotsOrder, ref);
    shooterTeam = cpuTeam; 
    shooterName = d.name;
    cpuShotsOrder = d.list;

    let keeper = squads[userTeam].keeper;
    speak(`ลูกที่ ${shotIndexCPU+1} ${shooterTeam}: ${shooterName} กำลังยิง ${keeper} ของคุณ พร้อมเซฟ`);
  }
}

function chooseDirection(dir){
  let keeperDir = ["TL","TR","C","BL","BR"][Math.floor(Math.random()*5)];
  let isGoal = dir !== keeperDir;

  let res = `${shooterName}  ${shooterTeam} ยิง${isGoal?"เข้า":"ไม่เข้า"}!`;

  if(turn===0) score += isGoal?1:0;
  else oppScore += isGoal?1:0;

  speak(res + `  Score ${score} - ${oppScore}`);
  updateScoreboard();

  if(isGoal) playSound(goalSnd);
  else playSound(missSnd);

  setTimeout(()=>{
    if(turn===0) shotIndexUser++;
    else shotIndexCPU++;

    checkGameEndOrNext();
  }, 900);
}

function checkGameEndOrNext(){
  let rU = 5 - shotIndexUser;
  let rC = 5 - shotIndexCPU;
  let end = false;

  if(!isSudden){
    if(score - oppScore > rC) end = true;
    else if(oppScore - score > rU) end = true;
    else if(shotIndexUser>=5 && shotIndexCPU>=5 && score===oppScore){
      isSudden = true;
      speak("เข้าสู่ซัดเดนเดธ!");
    }
  } else {
    if(turn===1 && score !== oppScore) end = true;
  }

  if(end){
    stopBGM();
    playSound(endSnd);

    let msg = score>oppScore ? `${userTeam} ชนะ!` : `${cpuTeam} ชนะ!`;
    setTimeout(()=>{ 
      speak(msg); 
      setTimeout(()=>{ 
        alert(msg); 
        resetGame(); 
      },700); 
    },600);

  } else {
    turn = 1 - turn;
    setTimeout(startTurn, 1000);
  }
}

function updateScoreboard(){
  document.getElementById("scoreBoard").innerText = `Score ตอนนี้คือ ${score} - ${oppScore}`;
}

function resetGame(){
  stopBGM();

  document.getElementById("gameScreen").style.display="none";
  document.getElementById("teamSelect").style.display="none";
  document.getElementById("modeSelect").style.display="flex";

  score=0; oppScore=0; turn=0;
  shotIndexUser=0; shotIndexCPU=0; isSudden=false;
  userShotsOrder=[]; cpuShotsOrder=[];

  document.getElementById("scoreBoard").innerText = "Score ตอนนี้คือ 0 - 0";
}
</script>
</body>
</html>