<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>เกมยิงจุดโทษ 2005/2006</title>
<style>
body { 
  font-family: Tahoma; 
  background:#111; 
  color:white; 
  text-align:center; 
  margin:0;
  padding:20px;
  height:100vh;
  overflow:hidden;
  position:relative;
}

.shot-btn { 
  position:fixed;
  background:rgba(255,255,255,0.9); 
  border-radius:15px;
  padding:25px 30px;
  font-weight:bold;
  cursor:pointer;
  border:3px solid #fff;
  font-size:22px;
  z-index:1000;
  box-shadow:0 8px 20px rgba(0,0,0,0.5);
  transition:all 0.2s;
}

.shot-btn:active { transform:scale(0.95); }

#tl { top:10%; left:10%; }
#tr { top:10%; right:10%; }
#center { top:50%; left:50%; transform:translate(-50%, -50%); }
#bl { bottom:10%; left:10%; }
#br { bottom:10%; right:10%; }

#scoreBoard { 
  position:fixed; top:10px; left:50%; transform:translateX(-50%);
  background:rgba(0,0,0,0.7); padding:15px 30px; border-radius:15px; border:2px solid #fff;
  font-size:28px; z-index:1001;
}

#teamSelect {
  display:flex; flex-direction:column; gap:20px;
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
}

#teamSelect button {
  background:rgba(255,255,255,0.9); border-radius:15px; padding:25px 40px;
  font-weight:bold; cursor:pointer; border:3px solid #fff; font-size:24px;
}

/* หน้าแรก */
#homeScreen { display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; gap:40px; }
#homeScreen h1 { font-size:48px; margin:0; text-shadow:2px 2px 4px rgba(0,0,0,0.8); }
.mode-btn {
  background:rgba(255,255,255,0.95); border-radius:20px; padding:30px 50px;
  font-weight:bold; cursor:pointer; border:4px solid #fff; font-size:28px; color:#333;
}

/* ปุ่มกลับเมนูหลัก */
#backToMainMenu {
  position:fixed; top:20px; left:20px; background:rgba(255,255,255,0.95); color:#333;
  border:3px solid #fff; border-radius:12px; padding:12px 20px; font-size:18px;
  font-weight:bold; cursor:pointer; z-index:1002;
}

/* TTS แสดงบนหน้าจอ */
#ttsDisplay {
  position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
  background:rgba(0,0,0,0.7); padding:12px 24px; border-radius:12px;
  font-size:20px; opacity:0; transition:opacity 0.3s; z-index:1002;
}
#ttsDisplay.show { opacity:1; }
</style>
</head>
<body>

<button id="backToMainMenu" onclick="window.location.href='../index.html'">กลับเมนูหลัก</button>

<h1>เกมยิงจุดโทษ 2005/2006</h1>

<!-- หน้าแรก -->
<div id="homeScreen">
  <div id="modeSelect">
    <button class="mode-btn" onclick="selectMode('bot')">เล่นกับบอท</button>
    <button class="mode-btn" onclick="selectMode('online')">เล่นออนไลน์</button>
    <p style="max-width:800px;margin:20px auto;line-height:1.6;">
      คำอธิบายเบื้องต้น เกมจำลองการยิงจุดโทษแบบเสียง เพื่อความสนุกสนานสำหรับคนชอบฟุตบอล<br>
      มีตำแหน่งให้คุณเลือกยิงและเลือกเซฟทั้งหมด 5 จุด<br>
      มุมซ้ายบน มุมขวาบน ตรงกลาง มุมซ้ายล่าง และมุมขวาล่าง<br>
      ผลัดกันยิงและผลัดกันเป็นผู้รักษาประตู พร้อมแล้วก็ไปเลือกทีมกันเลย
    </p>
  </div>
</div>

<!-- หน้าจอออนไลน์ -->
<div id="onlineScreen" style="display:none;">
  <p style="font-size:28px;">โหมดเล่นออนไลน์</p>
  <p>กำลังพัฒนา...</p>
  <button class="mode-btn" onclick="backToHome()">กลับเมนูหลัก</button>
</div>

<!-- หน้าเลือกทีม -->
<div id="teamSelect" style="display:none;">
  <p style="font-size:28px;">เลือกทีมของคุณ</p>
  <button onclick="selectTeam('Manchester United')">แมนเชสเตอร์ ยูไนเต็ด</button>
  <button onclick="selectTeam('Liverpool')">ลิเวอร์พูล</button>
  <button onclick="selectTeam('Arsenal')">อาร์เซนอล</button>
  <button onclick="selectTeam('Chelsea')">เชลซี</button>
</div>

<!-- หน้าจอเกม -->
<div id="gameScreen" style="display:none;">
  <div id="scoreBoard">Score ตอนนี้คือ 0 - 0</div>
  <button id="tl" class="shot-btn" onclick="debounceClick('TL')">มุมซ้ายบน</button>
  <button id="tr" class="shot-btn" onclick="debounceClick('TR')">มุมขวาบน</button>
  <button id="center" class="shot-btn" onclick="debounceClick('C')">ตรงกลาง</button>
  <button id="bl" class="shot-btn" onclick="debounceClick('BL')">มุมซ้ายล่าง</button>
  <button id="br" class="shot-btn" onclick="debounceClick('BR')">มุมขวาล่าง</button>
</div>

<div id="ttsDisplay"></div>
<div id="tts" aria-live="assertive" style="position:absolute;left:-9999px;"></div>

<!-- เสียง -->
<audio id="bgm" loop src="audio/b.mp3"></audio>
<audio id="end" src="audio/end.mp3"></audio>
<audio id="goal0" src="audio/t.mp3"></audio>
<audio id="goal1" src="audio/t1.mp3"></audio>
<audio id="goal2" src="audio/t2.mp3"></audio>
<audio id="goal3" src="audio/t3.mp3"></audio>
<audio id="goal4" src="audio/t4.mp3"></audio>
<audio id="miss0" src="audio/f.mp3"></audio>
<audio id="miss1" src="audio/f1.mp3"></audio>
<audio id="miss2" src="audio/f2.mp3"></audio>
<audio id="miss3" src="audio/f3.mp3"></audio>
<audio id="miss4" src="audio/f4.mp3"></audio>

<script>
/* ========== ระบบหน้าแรก (แก้ไขให้ทำงาน 100%) ========== */
function selectMode(mode) {
  if (mode === 'bot') {
    document.getElementById("homeScreen").style.display = "none";
    document.getElementById("teamSelect").style.display = "flex";
    document.getElementById("backToMainMenu").style.display = "block";
  } else if (mode === 'online') {
    window.location.href = "o.html";
  }
}

function backToHome() {
  document.getElementById("onlineScreen").style.display = "none";
  document.getElementById("homeScreen").style.display = "flex";
}

/* ========== TTS ========== */
let ttsQueue = [], isSpeaking = false;
const ttsDisplay = document.getElementById("ttsDisplay");

function speak(text) {
  ttsQueue.push(text);
  processTTS();
}

function processTTS() {
  if (isSpeaking || ttsQueue.length === 0) return;
  isSpeaking = true;
  const msg = ttsQueue.shift();
  ttsDisplay.textContent = msg;
  ttsDisplay.classList.add('show');
  setTimeout(() => {
    document.getElementById("tts").innerText = msg;
    setTimeout(() => {
      isSpeaking = false;
      document.getElementById("tts").innerText = "";
      ttsDisplay.classList.remove('show');
      processTTS();
    }, Math.max(600, msg.length * 40));
  }, 50);
}

/* ========== เสียง (เหมือน d.html แต่สุ่มหลายไฟล์) ========== */
function playSound(el) { el.currentTime = 0; el.play().catch(()=>{}); }
function waitForSound(el) {
  return new Promise(resolve => {
    el.onended = () => resolve();
    el.play().catch(() => resolve());
  });
}
function stopBGM() {
  const bgm = document.getElementById("bgm");
  bgm.pause(); bgm.currentTime = 0;
}

const goalSounds = [0,1,2,3,4].map(i => document.getElementById("goal"+i));
const missSounds = [0,1,2,3,4].map(i => document.getElementById("miss"+i));

async function playRandomGoal() {
  const snd = goalSounds[Math.floor(Math.random()*5)];
  playSound(snd);
  await waitForSound(snd);
}
async function playRandomMiss() {
  const snd = missSounds[Math.floor(Math.random()*5)];
  playSound(snd);
  await waitForSound(snd);
}

/* ========== ข้อมูลทีม ========== */
const squads = {
  "Manchester United": { players: ["แกรี่ เนวิลล์","ริโอ เฟอร์ดินานด์","เวส บราวน์","ปาทริซ เอฟร่า","คริสเตียโน่ โรนัลโด้","พอล สโคลส์","จอห์น โอเช","ไรอัน กิ๊กส์","เวย์น รูนี่ย์","รุด ฟาน นิสเทลรอย"], keeper: "เอ็ดวิน ฟาน เดอร์ ซาร์" },
  "Liverpool": { players: ["สตีฟ ฟินแนน","เจมี่ คาร์ราเกอร์","ซามี่ ฮูเปีย","จอห์น อาร์เน่ รีเซ่","ซาบี อลอนโซ่","โมฮาเหม็ด ซิสโซโก้","สตีเว่น เจอร์ราร์ด","หลุยส์ การ์เซีย","ปีเตอร์ เคร้าช์","ฌิบริล ซิสเซ่"], keeper: "เปเป้ เรน่า" },
  "Arsenal": { players: ["เอ็มมานูเอล เอบูเอ้","โคโล ตูเร่","โซล แคมเบล","แอชลีย์ โคล","อเล็กซานเดอร์ เคล็บ","ฌิลแบร์โต้ ซีลวา","เชส ฟาเบรกัส","โรแบร์ ปิแรส","เฟรดริก ลุงเบิร์ก","เธียร์รี่ อองรี"], keeper: "เยนส์ เลห์มันน์" },
  "Chelsea": { players: ["เปาโล เฟร์เรร่า","ริคาร์โด้ คาร์วัลโญ่","จอห์น เทอร์รี่","วิลเลียม กัลลาส","โคล้ด มาเกเลเล่","มิคาเอล เอสเซียง","แฟรงก์ แลมพาร์ด","โจ โคล","อาร์เยน ร็อบเบน","เฮอร์นัน เครสโป"], keeper: "ปีเตอร์ เช็ก" }
};

let userTeam, cpuTeam, score = 0, oppScore = 0, turn = 0, isSuddenDeath = false;
let shotIndexUser = 0, shotIndexCPU = 0, userShotsOrder = [], cpuShotsOrder = [];
let isButtonLocked = false;

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

function createShotsOrder(team){
  let arr = squads[team].players.slice();
  shuffle(arr);
  arr.push(squads[team].keeper);
  return arr;
}

function getShooterName(team, idx){
  const order = team === userTeam ? userShotsOrder : cpuShotsOrder;
  return order[idx % order.length];
}

function selectTeam(team){
  userTeam = team;
  const remain = Object.keys(squads).filter(t => t !== team);
  cpuTeam = remain[Math.floor(Math.random()*remain.length)];

  document.getElementById("teamSelect").style.display = "none";
  document.getElementById("gameScreen").style.display = "block";
  document.getElementById("backToMainMenu").style.display = "none";
  document.querySelector('h1').style.display = 'none';

  userShotsOrder = createShotsOrder(userTeam);
  cpuShotsOrder = createShotsOrder(cpuTeam);

  score = oppScore = turn = shotIndexUser = shotIndexCPU = 0;
  isSuddenDeath = false;
  updateScoreboard();
  startTurn();
  playSound(document.getElementById("bgm"));
}

function startTurn(){
  if(turn===0){
    const name = getShooterName(userTeam, shotIndexUser);
    speak(`ลูกที่ ${shotIndexUser+1} ${userTeam}: ${name} เตรียมยิง`);
  } else {
    const name = getShooterName(cpuTeam, shotIndexCPU);
    const keeper = squads[userTeam].keeper;
    speak(`ลูกที่ ${shotIndexCPU+1} ${cpuTeam}: ${name} เตรียมยิง ${keeper} ของคุณพร้อมเซฟ`);
  }
}

function debounceClick(dir){
  if(isButtonLocked) return;
  isButtonLocked = true;
  chooseDirection(dir);
  setTimeout(() => isButtonLocked = false, 100);
}

async function chooseDirection(dir){
  const keeperDir = ["TL","TR","C","BL","BR"][Math.floor(Math.random()*5)];
  const isGoal = dir !== keeperDir;

  if(turn===0) score += isGoal?1:0;
  else oppScore += isGoal?1:0;

  updateScoreboard();

  const shooter = turn===0 ? getShooterName(userTeam, shotIndexUser) : getShooterName(cpuTeam, shotIndexCPU);
  const msg = `${shooter} ${turn===0?userTeam:cpuTeam} ยิง${isGoal?"เข้า":"ไม่เข้า"}! Score ${score} - ${oppScore}`;

  if(isGoal) await playRandomGoal();
  else await playRandomMiss();

  speak(msg);

  if(turn===0) shotIndexUser++;
  else shotIndexCPU++;

  setTimeout(checkGameEndOrNext, 1000);
}

function updateScoreboard(){
  document.getElementById("scoreBoard").innerText = `Score ตอนนี้คือ ${score} - ${oppScore}`;
}

function checkGameEndOrNext(){
  const after5 = shotIndexUser >= 5 && shotIndexCPU >= 5;
  if(!after5){
    turn = 1-turn;
    setTimeout(startTurn, 800);
    return;
  }

  if(!isSuddenDeath){
    const remU = 5 - shotIndexUser, remC = 5 - shotIndexCPU;
    if(score - oppScore > remC){ endGame(true); return; }
    if(oppScore - score > remU){ endGame(false); return; }
    if(score === oppScore){
      isSuddenDeath = true;
      speak("เข้าสู่ซัดเดนเดธ!");
      turn = 1-turn;
      setTimeout(startTurn, 800);
      return;
    }
    endGame(score > oppScore);
    return;
  }

  if(shotIndexUser > shotIndexCPU){ turn=1; setTimeout(startTurn,800); return; }
  if(shotIndexCPU > shotIndexUser){ turn=0; setTimeout(startTurn,800); return; }
  if(score !== oppScore) endGame(score > oppScore);
  else { turn=1-turn; setTimeout(startTurn,800); }
}

function endGame(win){
  stopBGM();
  const endSnd = document.getElementById("end");
  playSound(endSnd);
  waitForSound(endSnd).then(()=>{
    const msg = win ? `${userTeam} ชนะ!` : `${cpuTeam} ชนะ!`;
    speak(msg);
    setTimeout(()=>alert(msg),800);
    setTimeout(resetGame,1500);
  });
}

function resetGame(){
  stopBGM();
  score=oppScore=turn=shotIndexUser=shotIndexCPU=0; isSuddenDeath=false;
  userShotsOrder=cpuShotsOrder=[];
  document.getElementById("gameScreen").style.display="none";
  document.getElementById("teamSelect").style.display="flex";
  document.getElementById("backToMainMenu").style.display="block";
  document.querySelector('h1').style.display="block";
}
</script>
</body>
</html>