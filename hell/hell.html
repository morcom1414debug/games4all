<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ß‡∏≤‡∏•‡∏π‡∏Å‡πâ‡∏≤‡πÅ‡∏´‡πà‡∏á‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤ - Valuga of Destiny</title>
    <style>
        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --danger: #ff4b2b;
            --success: #00b09b;
            --gold: #f1c40f;
            --dark-bg: #1a1a2e;
        }

        body {
            font-family: 'Kanit', 'Segoe UI', sans-serif;
            background: var(--dark-bg);
            color: white;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #game-container {
            width: 90%;
            max-width: 500px;
            background: #16213e;
            border-radius: 24px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            border: 2px solid rgba(37, 117, 252, 0.3);
        }

        .scene { display: none; }
        .scene.active { display: flex; flex-direction: column; gap: 1.2rem; animation: slideUp 0.5s ease-out; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        h1, h2 { margin: 0; color: var(--gold); }

        .wheel-area { position: relative; width: 200px; height: 200px; margin: 1rem auto; }
        .wheel-graphic {
            width: 100%; height: 100%; border-radius: 50%; border: 8px solid var(--gold);
            background: conic-gradient(from 0deg, #6a11cb 0deg 90deg, #2575fc 90deg 180deg, #6a11cb 180deg 270deg, #2575fc 270deg 360deg);
            transition: transform 3s cubic-bezier(0.1, 0, 0.2, 1);
        }
        .spinning { animation: spin 0.5s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid var(--danger); z-index: 10; }

        .lever {
            padding: 15px 35px; font-size: 1.2rem; font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none; border-radius: 50px; color: white; cursor: pointer; transition: 0.3s;
        }
        .lever:disabled { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }

        .stats { display: flex; gap: 10px; justify-content: center; }
        .stat-box { background: rgba(255, 255, 255, 0.1); padding: 8px 15px; border-radius: 10px; font-size: 0.9rem; }
        .hp-text { color: #ff6b6b; font-weight: bold; }

        .options-grid { display: grid; gap: 10px; margin-top: 10px; }
        .opt-btn { padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--secondary); color: white; border-radius: 8px; cursor: pointer; text-align: left; }
        .opt-btn:hover { background: rgba(37, 117, 252, 0.3); }

        #quiz-progress { font-size: 0.9rem; color: var(--gold); }
    </style>
</head>
<body>

<div id="game-container">
    <section id="start-screen" class="scene active">
        <h1 id="main-title" tabindex="-1">‡∏ß‡∏≤‡∏•‡∏π‡∏Å‡πâ‡∏≤‡πÅ‡∏´‡πà‡∏á‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤</h1>
        <p>‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏´‡∏≠‡∏Ñ‡∏≠‡∏¢ 10 ‡∏ä‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏ö‡∏ó‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤</p>
        <button id="btn-start" class="lever">‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏´‡∏≠‡∏Ñ‡∏≠‡∏¢</button>
    </section>

    <section id="tower-screen" class="scene">
        <h2 id="floor-header" tabindex="-1">‡∏´‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 1</h2>
        <div class="stats">
            <div class="stat-box hp-text" id="hp-display" aria-live="polite">‚ù§Ô∏è HP: 1,000</div>
            <div class="stat-box" id="shield-display" aria-live="polite">üõ°Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞</div>
        </div>
        <div class="wheel-area">
            <div class="pointer"></div>
            <div id="visual-wheel" class="wheel-graphic"></div>
        </div>
        <button id="lever-btn" class="lever">‡∏™‡∏±‡∏ö‡∏Ñ‡∏±‡∏ô‡πÇ‡∏¢‡∏Å</button>
        <p id="game-log" aria-live="assertive" style="min-height: 2.5em;"></p>
    </section>

    <section id="quiz-screen" class="scene">
        <h2 id="quiz-header" tabindex="-1">‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 10: ‡∏ö‡∏ó‡∏ó‡∏î‡∏™‡∏≠‡∏ö 3 ‡∏Ç‡πâ‡∏≠</h2>
        <div id="quiz-progress">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1/3</div>
        <p id="question-text"></p>
        <div id="quiz-options" class="options-grid"></div>
    </section>

    <section id="result-screen" class="scene">
        <h2 id="result-header" tabindex="-1">‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ</h2>
        <p id="result-message" style="font-size: 1.2rem;"></p>
        <div id="final-stats"></div>
    </section>
</div>

<script>
/** ENGINE **/
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const buffers = {};
const sounds = {
    start: 'audio/start.mp3', back: 'audio/back.mp3', wheel: 'audio/wheel.mp3',
    up: 'audio/up.mp3', up1: 'audio/up1.mp3', shield: 'audio/shield.mp3',
    wind: 'audio/wind.mp3', water: 'audio/water.mp3', earth: 'audio/earth.mp3',
    winner: 'audio/winner.mp3', lost: 'audio/lost.mp3'
};

async function initAudio() {
    const loader = Object.entries(sounds).map(async ([n, u]) => {
        try {
            const r = await fetch(u);
            const a = await r.arrayBuffer();
            buffers[n] = await audioCtx.decodeAudioData(a);
        } catch(e) {}
    });
    await Promise.all(loader);
}

function play(n, loop = false) {
    if (!buffers[n]) return null;
    const s = audioCtx.createBufferSource();
    s.buffer = buffers[n]; s.loop = loop; s.connect(audioCtx.destination);
    s.start(0); return s;
}

function playWait(n) {
    return new Promise(res => {
        const s = play(n);
        if(!s) res(); else s.onended = res;
    });
}

/** DATA **/
const quizDB = [
    { q: "‡∏ò‡∏≤‡∏ï‡∏∏‡∏ô‡πâ‡∏≥ ‡πÅ‡∏û‡πâ‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡πÑ‡∏î‡πâ?", opts: ["‡πÑ‡∏ü", "‡∏î‡∏¥‡∏ô", "‡∏ó‡∏≠‡∏á", "‡∏•‡∏°"], ans: 1 },
    { q: "‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏ä‡∏ô‡∏∞ '‡∏ò‡∏≤‡∏ï‡∏∏‡∏î‡∏¥‡∏ô' ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≠‡∏ô‡πÑ‡∏ä?", opts: ["‡πÑ‡∏°‡πâ", "‡∏ó‡∏≠‡∏á", "‡πÑ‡∏ü", "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á"], ans: 0 },
    { q: "‡πÉ‡∏ô‡∏ß‡∏±‡∏è‡∏à‡∏±‡∏Å‡∏£ '‡∏ò‡∏≤‡∏ï‡∏∏‡πÑ‡∏ü' ‡∏à‡∏∞‡∏û‡πà‡∏≤‡∏¢‡πÅ‡∏û‡πâ‡∏ï‡πà‡∏≠‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î?", opts: ["‡∏•‡∏°", "‡∏ó‡∏≠‡∏á", "‡∏ô‡πâ‡∏≥", "‡πÑ‡∏°‡πâ"], ans: 2 },
    { q: "‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏Ñ‡∏°‡∏Å‡∏£‡∏¥‡∏ö‡∏û‡∏≠‡∏à‡∏∞‡∏ó‡∏≥‡∏•‡∏≤‡∏¢ '‡∏ò‡∏≤‡∏ï‡∏∏‡πÑ‡∏°‡πâ' ‡πÑ‡∏î‡πâ?", opts: ["‡∏ô‡πâ‡∏≥", "‡∏î‡∏¥‡∏ô", "‡∏ó‡∏≠‡∏á", "‡∏•‡∏°"], ans: 2 },
    { q: "'‡∏ò‡∏≤‡∏ï‡∏∏‡∏•‡∏°' ‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏°‡∏ß‡∏•‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏•‡∏Å‡∏±‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏•‡∏°?", opts: ["‡∏ô‡πâ‡∏≥", "‡∏î‡∏¥‡∏ô", "‡πÑ‡∏°‡πâ", "‡πÑ‡∏ü"], ans: 1 },
    { q: "'‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏≠‡∏á' ‡∏à‡∏∞‡∏û‡πà‡∏≤‡∏¢‡πÅ‡∏û‡πâ‡∏ï‡πà‡∏≠‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏•‡∏∞‡∏•‡∏≤‡∏¢?", opts: ["‡πÑ‡∏ü", "‡∏ô‡πâ‡∏≥", "‡∏•‡∏°", "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á"], ans: 0 },
    { q: "'‡∏ò‡∏≤‡∏ï‡∏∏‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á' ‡πÅ‡∏û‡πâ‡∏ï‡πà‡∏≠‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏£‡∏∞‡πÄ‡∏´‡∏¢?", opts: ["‡∏ô‡πâ‡∏≥", "‡∏•‡∏°", "‡πÑ‡∏ü", "‡∏î‡∏¥‡∏ô"], ans: 2 },
    { q: "'‡∏ò‡∏≤‡∏ï‡∏∏‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤' ‡πÅ‡∏û‡πâ‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏â‡∏ô‡∏ß‡∏ô?", opts: ["‡∏ô‡πâ‡∏≥", "‡∏î‡∏¥‡∏ô", "‡∏ó‡∏≠‡∏á", "‡∏•‡∏°"], ans: 1 },
    { q: "‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏ó‡∏µ‡πà '‡∏ò‡∏≤‡∏ï‡∏∏‡∏•‡∏°' ‡πÅ‡∏û‡πâ‡∏ó‡∏≤‡∏á (‡πÄ‡∏ä‡∏¥‡∏á‡∏ñ‡∏π‡∏Å‡πÄ‡∏à‡∏≤‡∏∞‡∏ó‡∏∞‡∏•‡∏ß‡∏á)?", opts: ["‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤", "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á", "‡πÑ‡∏°‡πâ", "‡∏ô‡πâ‡∏≥"], ans: 0 },
    { q: "‡∏ò‡∏≤‡∏ï‡∏∏‡πÉ‡∏î‡∏ó‡∏µ‡πà '‡∏ò‡∏≤‡∏ï‡∏∏‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á' ‡πÄ‡∏≠‡∏≤‡∏ä‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", opts: ["‡πÑ‡∏ü", "‡∏ó‡∏≠‡∏á", "‡πÑ‡∏°‡πâ", "‡∏ô‡πâ‡∏≥"], ans: 3 }
];

let state = { hp: 1000, floor: 1, hasShield: false, isBusy: false, bgm: null, quizCount: 0, usedQuestions: [] };

/** LOGIC **/
document.getElementById('btn-start').onclick = async () => {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    document.getElementById('btn-start').disabled = true;
    await initAudio();
    await playWait('start');
    state.bgm = play('back', true);
    switchScene('tower-screen');
    updateUI();
};

document.getElementById('lever-btn').onclick = async () => {
    if (state.isBusy) return;
    state.isBusy = true;
    document.getElementById('lever-btn').disabled = true;
    
    document.getElementById('visual-wheel').classList.add('spinning');
    document.getElementById('game-log').innerText = "‡∏Å‡∏á‡∏•‡πâ‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏°‡∏∏‡∏ô...";
    await playWait('wheel');
    document.getElementById('visual-wheel').classList.remove('spinning');

    let pool = [];
    if (state.floor <= 5) {
        // ‡∏õ‡∏£‡∏∞‡∏ï‡∏π(3), ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞(1), ‡∏ß‡∏≤‡∏¢‡∏∏(2), ‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£(2) = 8 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        pool = ['up','up','up', 'shield', 'wind','wind', 'water','water'];
    } else {
        // ‡∏õ‡∏£‡∏∞‡∏ï‡∏π(2), ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞(1), ‡∏ß‡∏≤‡∏¢‡∏∏(1), ‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£(1), ‡∏õ‡∏ê‡∏û‡∏µ(2), ‡∏≠‡∏±‡∏Ñ‡∏ô‡∏µ(2) = 9 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        pool = ['up','up', 'shield', 'wind', 'water', 'earth','earth', 'fire','fire'];
    }

    const res = pool[Math.floor(Math.random() * pool.length)];
    await applyEffect(res);

    if (state.hp > 0 && state.floor < 10) {
        state.isBusy = false;
        document.getElementById('lever-btn').disabled = false;
    }
};

async function applyEffect(res) {
    let log = "";
    if (res === 'up') {
        const sfx = (state.floor === 9) ? 'up1' : 'up';
        await playWait(sfx);
        state.floor++;
        log = `‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ${state.floor}!`;
        if (state.floor === 10) return startBossQuiz();
    } else if (res === 'shield') {
        state.hasShield = true;
        log = "‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡πÅ‡∏´‡πà‡∏á‡πÅ‡∏™‡∏á!";
        await playWait('shield');
    } else {
        const dMap = { wind: 100, water: 200, earth: 200, fire: 300 };
        const sfxMap = { wind: 'wind', water: 'water', earth: 'earth', fire: 'water' };
        const nMap = { wind: '‡∏ß‡∏≤‡∏¢‡∏∏‡∏•‡∏°‡∏Å‡∏•‡∏î', water: '‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏Ñ‡∏•‡∏±‡πà‡∏á', earth: '‡∏õ‡∏ê‡∏û‡∏µ‡∏Å‡∏•‡∏∑‡∏ô‡∏Å‡∏¥‡∏ô', fire: '‡∏≠‡∏±‡∏Ñ‡∏ô‡∏µ‡∏û‡∏¥‡πÇ‡∏£‡∏ò' };
        
        log = `‡πÇ‡∏î‡∏ô ${nMap[res]}!`;
        if (state.hasShield) {
            log += " ‡πÅ‡∏ï‡πà‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ!";
            state.hasShield = false;
            await playWait(sfxMap[res]);
        } else {
            state.hp -= dMap[res];
            await playWait(sfxMap[res]);
            if (state.hp <= 0) return endGame(false);
        }
    }
    document.getElementById('game-log').innerText = log;
    updateUI();
}

function startBossQuiz() {
    state.quizCount = 0;
    state.usedQuestions = [];
    switchScene('quiz-screen');
    nextQuestion();
}

function nextQuestion() {
    state.quizCount++;
    document.getElementById('quiz-progress').innerText = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${state.quizCount}/3`;
    
    // ‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥
    let qIdx;
    do { qIdx = Math.floor(Math.random() * quizDB.length); } 
    while (state.usedQuestions.includes(qIdx));
    state.usedQuestions.push(qIdx);

    const qData = quizDB[qIdx];
    document.getElementById('question-text').innerText = qData.q;
    const box = document.getElementById('quiz-options');
    box.innerHTML = "";
    
    qData.opts.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = "opt-btn";
        btn.innerText = `${['‡∏Å','‡∏Ç','‡∏Ñ','‡∏á'][i]}. ${opt}`;
        btn.onclick = () => {
            if (i === qData.ans) {
                if (state.quizCount >= 3) endGame(true);
                else nextQuestion();
            } else {
                endGame(false);
            }
        };
        box.appendChild(btn);
    });
}

function updateUI() {
    document.getElementById('hp-display').innerText = `‚ù§Ô∏è HP: ${state.hp.toLocaleString()}`;
    document.getElementById('shield-display').innerText = state.hasShield ? "üõ°Ô∏è ‡∏°‡∏µ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞" : "üõ°Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞";
    document.getElementById('floor-header').innerText = `‡∏´‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ${state.floor}`;
}

function switchScene(id) {
    document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
    const target = document.getElementById(id);
    target.classList.add('active');
    target.querySelector('h1, h2').focus();
}

async function endGame(isWin) {
    if (state.bgm) state.bgm.stop();
    switchScene('result-screen');
    const msgEl = document.getElementById('result-message');
    
    if (isWin) {
        msgEl.innerText = "‡∏ó‡πà‡∏≤‡∏ô‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏£‡∏ö 3 ‡∏Ç‡πâ‡∏≠! ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏¢‡∏≠‡∏î‡∏´‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏ß‡∏≤‡∏•‡∏π‡∏Å‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
        await playWait('winner');
    } else {
        msgEl.innerText = state.hp <= 0 ? "‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏´‡∏°‡∏î‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß..." : "‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ô‡∏¥‡∏î ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô...";
        await playWait('lost');
    }
    document.getElementById('final-stats').innerText = `‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á: ${state.floor} | HP ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${state.hp}`;
}
</script>
</body>
</html>