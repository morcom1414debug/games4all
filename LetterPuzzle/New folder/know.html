<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Puzzle - อักษรพาซน!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;800;900&display=swap');
        
        body {
            margin: 0;
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            color: #fff;
            overflow: hidden;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        #backToMenu {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.25);
            padding: 12px 28px;
            border: none;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            backdrop-filter: blur(12px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            z-index: 1000;
            transition: all 0.3s;
        }
        #backToMenu:hover {
            background: rgba(255,255,255,0.4);
            transform: translateY(-4px);
        }

        #levelSelect {
            text-align: center;
            padding-top: 15vh;
        }
        h1 {
            font-size: 4.8rem;
            margin: 0 0 10px;
            text-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        .subtitle {
            font-size: 1.9rem;
            margin-bottom: 60px;
            opacity: 0.9;
        }
        .level-buttons {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        .level-btn {
            width: 280px;
            padding: 38px 20px;
            font-size: 2.3rem;
            font-weight: 800;
            border: none;
            border-radius: 32px;
            cursor: pointer;
            box-shadow: 0 18px 40px rgba(0,0,0,0.45);
            transition: all 0.3s;
        }
        .level-btn:hover {
            transform: translateY(-18px) scale(1.06);
        }
        #easy { background: #51cf66; }
        #medium { background: #ffd43b; color: #333; }
        #hard { background: #ff6b6b; }

        #game {
            display: none;
            text-align: center;
            padding-top: 8vh;
        }
        .question-heading {
            font-size: 3.6rem;
            font-weight: 900;
            margin-bottom: 25px;
            text-shadow: 0 6px 22px rgba(0,0,0,0.5);
            padding: 18px 30px;
            background: rgba(255,255,255,0.18);
            border-radius: 25px;
            display: inline-block;
            backdrop-filter: blur(8px);
        }
        .spelling-display {
            font-size: 4.2rem;
            font-weight: bold;
            min-height: 110px;
            margin: 30px 0;
            letter-spacing: 14px;
            color: #ffd93d;
        }
        .timer {
            font-size: 2.5rem;
            margin: 25px 0;
            font-weight: 700;
        }
        .letters {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 28px;
            margin: 55px 0;
        }
        .letter-btn {
            position: relative;
            width: 100px;
            height: 100px;
            font-size: 3rem;
            font-weight: bold;
            background: #ffd93d;
            color: #333;
            border: none;
            border-radius: 26px;
            cursor: pointer;
            box-shadow: 0 12px 28px rgba(0,0,0,0.35);
            transition: all 0.3s;
        }
        .letter-btn:hover:not(.used) { transform: scale(1.15); }
        .letter-btn.used {
            background: #95e1d3 !important;
            color: white !important;
            pointer-events: none;
            transform: scale(0.92);
        }
        .letter-btn.used::after {
            content: "✓";
            position: absolute;
            top: -14px;
            right: -14px;
            background: #4ecdc4;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 2rem;
            line-height: 40px;
        }
        .letter-btn.wrong {
            background: #ff6b6b !important;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            25% { transform: translateX(-14px); }
            75% { transform: translateX(14px); }
        }

        #result {
            display: none;
            text-align: center;
            padding-top: 15vh;
        }
        #result h2 {
            font-size: 5.8rem;
            margin: 0 0 35px;
            text-shadow: 0 12px 35px rgba(0,0,0,0.5);
        }
        #score {
            font-size: 7rem;
            font-weight: 900;
            margin: 50px 0;
            text-shadow: 0 12px 35px rgba(0,0,0,0.5);
        }
        .btn-restart {
            margin: 25px 15px;
            padding: 20px 55px;
            font-size: 1.9rem;
            background: #4ecdc4;
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            box-shadow: 0 14px 30px rgba(0,0,0,0.4);
        }
        .btn-restart:hover {
            transform: translateY(-10px);
        }
    </style>
</head>
<body>

<div class="container">
    <button id="backToMenu">กลับเมนูหลัก</button>

    <div id="levelSelect">
        <h1>Letter Puzzle - อักษรพาซน!</h1>
        <p class="subtitle">เลือกระดับความยาก แล้วมาเริ่มสนุกกันเลย!</p>
        <div class="level-buttons">
            <button class="level-btn" id="easy">ง่าย<br><small>(40 วินาที/ข้อ)</small></button>
            <button class="level-btn" id="medium">ปานกลาง<br><small>(25 วินาที/ข้อ)</small></button>
            <button class="level-btn" id="hard">ปราบเซียน<br><small>(15 วินาที/ข้อ)</small></button>
        </div>
    </div>

    <div id="game">
        <h2 class="question-heading" id="question" tabindex="-1">ข้อ 1 : แมว ภาษาอังกฤษเขียนว่า</h2>
        <div class="spelling-display" id="spellingDisplay">_ _ _</div>
        <div class="timer">เวลา: <span id="timer">20</span> วินาที</div>
        <div class="letters" id="letters"></div>
    </div>

    <div id="result">
        <h2 id="resultTitle" tabindex="-1">สุดยอดมาก!</h2>
        <div id="resultMsg" style="font-size: 2.4rem; margin: 30px 0; line-height: 1.6;"></div>
        <div id="score">1000 คะแนน</div>
        <button class="btn-restart" id="restartBtn">เริ่มเล่นใหม่</button>
    </div>
</div>

<!-- เสียงเอฟเฟกต์เดิม -->
<audio id="correctSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-reward-952.mp3" preload="auto"></audio>
<audio id="wrongSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-946.mp3" preload="auto"></audio>

<!-- เสียงใหม่ที่คุณขอ (อยู่ใน folder audio) -->
<audio id="bgm" src="audio/b.mp3" preload="auto" loop></audio>
<audio id="startSound" src="audio/start.mp3" preload="auto"></audio>
<audio id="doorSound" src="audio/door.mp3" preload="auto"></audio>
<audio id="t1Sound" src="audio/t1.mp3" preload="auto"></audio>
<audio id="tSound" src="audio/t.mp3" preload="auto"></audio>
<audio id="fSound" src="audio/f.mp3" preload="auto"></audio>
<audio id="endSound" src="audio/end.mp3" preload="auto"></audio>

<script>
// คำศัพท์ 200+ ข้อ
const vocab = [
    {th:"แมว", en:"cat"}, {th:"หมา", en:"dog"}, {th:"ช้าง", en:"elephant"}, {th:"เสือ", en:"tiger"},
    {th:"ม้า", en:"horse"}, {th:"วัว", en:"cow"}, {th:"หมู", en:"pig"}, {th:"ไก่", en:"chicken"},
    {th:"เป็ด", en:"duck"}, {th:"กบ", en:"frog"}, {th:"ปลา", en:"fish"}, {th:"นก", en:"bird"},
    {th:"กระต่าย", en:"rabbit"}, {th:"งู", en:"snake"}, {th:"สิงโต", en:"lion"}, {th:"หมี", en:"bear"},
    {th:"โต๊ะ", en:"table"}, {th:"เก้าอี้", en:"chair"}, {th:"เตียง", en:"bed"}, {th:"หนังสือ", en:"book"},
    {th:"ปากกา", en:"pen"}, {th:"ดินสอ", en:"pencil"}, {th:"รถยนต์", en:"car"}, {th:"จักรยาน", en:"bicycle"},
    {th:"พ่อ", en:"father"}, {th:"แม่", en:"mother"}, {th:"พี่ชาย", en:"brother"}, {th:"น้องสาว", en:"sister"},
    {th:"ครู", en:"teacher"}, {th:"หมอ", en:"doctor"}, {th:"โรงเรียน", en:"school"}, {th:"บ้าน", en:"house"},
    {th:"ข้าว", en:"rice"}, {th:"น้ำ", en:"water"}, {th:"นม", en:"milk"}, {th:"ไข่", en:"egg"},
    {th:"กล้วย", en:"banana"}, {th:"แอปเปิ้ล", en:"apple"}, {th:"ส้ม", en:"orange"}, {th:"เค้ก", en:"cake"},
    {th:"รองเท้า", en:"shoes"}, {th:"เสื้อ", en:"shirt"}, {th:"กางเกง", en:"pants"}, {th:"หมวก", en:"hat"},
    {th:"ช้อน", en:"spoon"}, {th:"ส้อม", en:"fork"}, {th:"จาน", en:"plate"}, {th:"แก้ว", en:"glass"},
    {th:"ลูกบอล", en:"ball"}, {th:"ตุ๊กตา", en:"doll"}, {th:"ดอกไม้", en:"flower"}, {th:"ต้นไม้", en:"tree"},
    {th:"ดวงอาทิตย์", en:"sun"}, {th:"ดวงจันทร์", en:"moon"}, {th:"ดาว", en:"star"}, {th:"ฝน", en:"rain"},
    {th:"รถไฟ", en:"train"}, {th:"เครื่องบิน", en:"airplane"}, {th:"เรือ", en:"boat"},
    {th:"ยีราฟ", en:"giraffe"}, {th:"จิงโจ้", en:"kangaroo"}, {th:"ผีเสื้อ", en:"butterfly"}, {th:"เต่า", en:"turtle"},
    {th:"มะม่วง", en:"mango"}, {th:"สับปะรด", en:"pineapple"}, {th:"แตงโม", en:"watermelon"}, {th:"องุ่น", en:"grapes"},
    {th:"ช็อกโกแลต", en:"chocolate"}, {th:"ไอศกรีม", en:"ice cream"}, {th:"พิซซ่า", en:"pizza"},
    {th:"โรงพยาบาล", en:"hospital"}, {th:"สวนสาธารณะ", en:"park"}, {th:"ทะเล", en:"sea"}, {th:"ภูเขา", en:"mountain"}
];

let currentQuestions = [];
let currentQ = 0;
let score = 0;
let timerInterval;
let selectedLetters = [];
let timePerQuestion = 20;
const TOTAL_QUESTIONS = 10;

const correctSound = document.getElementById('correctSound');
const wrongSound = document.getElementById('wrongSound');
const backBtn = document.getElementById('backToMenu');

// เสียงใหม่ทั้งหมด
const bgm = document.getElementById('bgm');
const startSound = document.getElementById('startSound');
const doorSound = document.getElementById('doorSound');
const t1Sound = document.getElementById('t1Sound');
const tSound = document.getElementById('tSound');
const fSound = document.getElementById('fSound');
const endSound = document.getElementById('endSound');

function stopBGM() {
    bgm.pause();
    bgm.currentTime = 0;
}

function playWithWait(audio, callback) {
    audio.currentTime = 0;
    audio.play();
    audio.onended = () => {
        if (callback) callback();
    };
}

function shuffle(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function startGameWithTime(seconds) {
    timePerQuestion = seconds;
    document.getElementById('levelSelect').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    backBtn.style.display = 'none';

    // 1. เล่น b.mp3 แบบวนลูป + เล่น start.mp3 ก่อนเริ่มเกมจริง
    bgm.play();
    playWithWait(startSound, () => {
        currentQuestions = shuffle(vocab).slice(0, TOTAL_QUESTIONS);
        currentQ = 0;
        score = 0;
        nextQuestion();
    });
}

function nextQuestion() {
    if (currentQ >= TOTAL_QUESTIONS) {
        endGame();
        return;
    }

    selectedLetters = [];
    const word = currentQuestions[currentQ];
    document.getElementById('spellingDisplay').textContent = '_ '.repeat(word.en.length).trim();
    document.getElementById('question').textContent = `ข้อ ${currentQ + 1} : ${word.th} ภาษาอังกฤษเขียนว่า`;
    document.getElementById('question').focus();

    clearInterval(timerInterval);

    const letters = shuffle(word.en.toLowerCase().split(''));
    const lettersDiv = document.getElementById('letters');
    lettersDiv.innerHTML = '';
    letters.forEach(letter => {
        const btn = document.createElement('button');
        btn.className = 'letter-btn';
        btn.textContent = letter.toUpperCase();
        btn.onclick = () => selectLetter(btn, letter, word.en.toLowerCase());
        lettersDiv.appendChild(btn);
    });

    let timeLeft = timePerQuestion;
    document.getElementById('timer').textContent = timeLeft;
    document.getElementById('timer').style.color = "#fff";

    timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = timeLeft;
        if (timeLeft <= 5) document.getElementById('timer').style.color = "#ff6b6b";
        if (timeLeft <= 0) {
            wrongSound.play();
            playWithWait(fSound, wrongAnswer);
        }
    }, 1000);
}

function selectLetter(btn, letter, correct) {
    if (btn.classList.contains('used')) return;

    selectedLetters.push(letter);
    btn.classList.add('used');
    document.getElementById('spellingDisplay').textContent = selectedLetters.map(l => l.toUpperCase()).join(' ');

    const typed = selectedLetters.join('');

    // ถ้ายังไม่ใช่ตัวสุดท้าย และยังถูก → เล่น t1.mp3
    if (typed.length < correct.length && correct.startsWith(typed)) {
        t1Sound.currentTime = 0;
        t1Sound.play();
    }

    if (typed === correct) {
        correctSound.play();
        score++;

        // 5. ตัวสุดท้ายถูก → เล่น t.mp3 แล้วค่อยไปข้อถัดไป
        clearInterval(timerInterval);
        playWithWait(tSound, () => {
            currentQ++;
            nextQuestion();
        });
    } else if (!correct.startsWith(typed)) {
        btn.classList.add('wrong');
        wrongSound.play();
        // 6. ผิด → เล่น f.mp3 แล้วไปข้อถัดไป
        playWithWait(fSound, () => {
            currentQ++;
            nextQuestion();
        });
    }
}

function wrongAnswer() {
    clearInterval(timerInterval);
    currentQ++;
    nextQuestion();
}

function endGame() {
    stopBGM(); // หยุดเพลงพื้นหลังทันทีที่จบเกม

    document.getElementById('game').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    backBtn.style.display = 'block';

    const title = document.getElementById('resultTitle');
    const msg = document.getElementById('resultMsg');
    const scoreDiv = document.getElementById('score');

    let points;
    if (score === 10) {
        title.textContent = "สุดยอดมาก!";
        msg.innerHTML = "ตอบถูกทั้ง 10 ข้อเลย!<br>เก่งสุด ๆ ไปเลยนะ!";
        points = 1000;
        // 7. & 8. ตอบถูกหมด → เล่น end.mp3 ก่อนแสดงผล
        playWithWait(endSound, () => {
            scoreDiv.textContent = points + " คะแนน";
            title.focus();
        });
    } else {
        if (score >= 8) {
            title.textContent = "เก่งมากเลย!";
            msg.innerHTML = `ตอบถูก ${score} จาก 10 ข้อ<br>เยี่ยมมาก! ใกล้เต็มแล้ว`;
            points = 700;
        } else {
            points = score * 50;
            const encourages = [
                "ไม่เป็นไรนะ ครั้งหน้าต้องเก่งขึ้นแน่!",
                "พยายามเข้าไว้ สู้ ๆ นะจ๊ะ!",
                "เยี่ยมแล้วที่เล่นจนจบ!",
                "ทุกครั้งที่เล่น เราจะเก่งขึ้นนะ",
                "อย่ายอมแพ้นะ เดี๋ยวก็เก่งเอง!"
            ];
            title.textContent = "ไม่เป็นไร สู้ต่อไป!";
            msg.textContent = encourages[Math.floor(Math.random() * encourages.length)];
        }
        // 8. ตอบผิดอย่างน้อย 1 ข้อ → เล่น end.mp3 เหมือนกัน
        playWithWait(endSound, () => {
            scoreDiv.textContent = points + " คะแนน";
            title.focus();
        });
    }
}

// Event Listeners
document.getElementById('easy').onclick = () => startGameWithTime(40);
document.getElementById('medium').onclick = () => startGameWithTime(25);
document.getElementById('hard').onclick = () => startGameWithTime(15);

document.getElementById('restartBtn').onclick = () => {
    playWithWait(doorSound, () => {
        document.getElementById('result').style.display = 'none';
        document.getElementById('levelSelect').style.display = 'block';
        backBtn.style.display = 'block';
    });
};

backBtn.onclick = () => {
    stopBGM();
    playWithWait(doorSound, () => {
        location.href = '../index.html';
    });
};

// หยุดเพลงพื้นหลังเมื่อออกจากหน้า
window.addEventListener('beforeunload', stopBGM);
</script>
</body>
</html>