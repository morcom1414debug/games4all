<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตำนานกอบกู้ยุทธภพ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            background-color: #1a1a1a;
            color: #e5e5e5;
        }
        .chinese-border {
            border: 4px solid #8b0000;
            box-shadow: 0 0 15px rgba(139, 0, 0, 0.5);
        }
        .screen-hidden {
            display: none !important;
        }
        #death-screen, #win-screen {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 100;
        }
        #back-menu-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 50;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="game-container" class="max-w-2xl w-full bg-[#2d2d2d] rounded-lg p-6 chinese-border relative overflow-hidden min-h-[550px] flex flex-col justify-center">
        
        <!-- Back Menu Button -->
        <button id="back-menu-btn" class="bg-gray-700 hover:bg-red-900 text-white font-bold py-2 px-4 rounded transition-all screen-hidden" onclick="window.location.href = '../index.html';">
            กลับเมนูหลัก
        </button>

        <!-- Start Screen -->
        <div id="start-screen" class="text-center">
            <h1 class="text-4xl font-bold text-red-600 mb-4" id="start-heading" tabindex="0">ตำนานกอบกู้ยุทธภพ</h1>
            <p class="mb-6 text-gray-300">
                ยุทธภพกำลังลุกเป็นไฟจากแผนการร้ายของ "พรรคมังกรทมิฬ" 
                คุณคือศิษย์คนสุดท้ายของสำนักเทวะที่ต้องออกเดินทางเพื่อรวบรวมพรรคพวกและขัดขวางจอมมาร 
            </p>
            <div class="bg-black/30 p-4 rounded mb-6 text-left border border-red-900/50">
                <h2 class="text-xl font-bold text-yellow-500 mb-2">กฎกติกาการเล่น:</h2>
                <ul class="list-disc ml-6 space-y-1 text-sm">
                    <li>มีทั้งหมด 10 ด่าน แต่ละด่านมี 5 ภารกิจ</li>
                    <li>ในแต่ละสถานการณ์ จะมีคำตอบที่ถูกเพียง **ข้อเดียว**</li>
                    <li>หากเลือกผิด คุณจะถูกสังหารทันที และต้องเริ่มใหม่จาก **ด่านที่ 1**</li>
                    <li>สติและไหวพริบคืออาวุธที่สำคัญที่สุดของคุณ</li>
                </ul>
            </div>
            <button onclick="startGame()" class="bg-red-700 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105">
                เริ่มตำนานกอบกู้ยุทธภพ
            </button>
        </div>

        <!-- Gameplay Screen -->
        <div id="gameplay-screen" class="screen-hidden">
            <div class="flex justify-between items-center mb-4 border-b border-gray-600 pb-2">
                <h3 id="level-display" class="text-yellow-500 font-bold text-sm md:text-base" tabindex="0"></h3>
                <h3 id="mission-display" class="text-blue-400 font-bold text-sm md:text-base" tabindex="0"></h3>
            </div>
            
            <div id="scenario-box" class="mb-4">
                <p id="scenario-text" class="text-lg md:text-xl mb-6 leading-relaxed text-white"></p>
                <div id="options-container" class="grid grid-cols-1 gap-3">
                    <!-- Options buttons will be here -->
                </div>
            </div>
        </div>

        <!-- Death Screen -->
        <div id="death-screen" class="screen-hidden flex-col items-center justify-center p-8 text-center">
            <h2 class="text-5xl font-bold text-red-600 mb-4" id="death-heading" tabindex="0">จบสิ้นชีวิต!</h2>
            <p id="death-reason" class="text-xl text-gray-300 mb-8"></p>
            <button onclick="restartGame()" class="bg-white text-black font-bold py-3 px-8 rounded-full hover:bg-gray-200 transition-all">
                กลับสู่วังวนแห่งกรรม (เริ่มใหม่)
            </button>
        </div>

        <!-- Win Screen -->
        <div id="win-screen" class="screen-hidden flex-col items-center justify-center p-8 text-center">
            <h2 class="text-4xl font-bold text-yellow-500 mb-4" id="win-heading" tabindex="0">มหาบุรุษกอบกู้ยุทธภพ!</h2>
            <p class="mb-6 text-gray-200">คุณได้กำจัดจอมมารทมิฬและคืนความสงบสุขให้แก่แผ่นดินได้สำเร็จ ชื่อของคุณจะถูกจารึกไว้ชั่วนิรันดร์</p>
            <button onclick="restartGame()" class="bg-green-600 text-white font-bold py-3 px-8 rounded-full hover:bg-green-500 transition-all">
                สร้างตำนานใหม่
            </button>
        </div>
    </div>

    <script>
        const gameData = [
            {
                levelName: "หมู่บ้านไผ่เขียว",
                missions: [
                    {
                        text: "สมุนพรรคมังกรทมิฬกำลังบุกปล้นหมู่บ้าน พวกมันรุมล้อมชาวบ้านที่ไร้ทางสู้ คุณจะทำอย่างไร?",
                        options: [
                            { text: "บุกเข้าปะทะตรงๆ ด้วยวิชากระบี่", correct: true },
                            { text: "ตะโกนเรียกให้ชาวบ้านหนีไปก่อน", correct: false, reason: "เสียงของคุณทำให้ศัตรูรู้ตัวและรุมสังหารคุณทันที" },
                            { text: "ซุ่มรอในมุมมืดเผื่อหาจังหวะ", correct: false, reason: "ชาวบ้านถูกฆ่าตายหมด และคุณถูกล้อมกรอบจนหนีไม่พ้น" }
                        ]
                    },
                    {
                        text: "หัวหน้าสมุนถือขวานยักษ์บุกเข้ามาหาคุณ มันเงื้อขวานจะฟันลงมา!",
                        options: [
                            { text: "ใช้กระบี่รับแรงปะทะตรงๆ", correct: false, reason: "แรงขวานมหาศาลทำให้กระบี่หักและคุณถูกจามแยกเป็นสองซีก" },
                            { text: "เบี่ยงตัวหลบแล้วแทงสวนที่จุดตายใต้รักแร้", correct: true },
                            { text: "ถอยหลังหนีเพื่อตั้งหลัก", correct: false, reason: "มันขว้างขวานใส่คุณขณะถอยหลังจนเสียชีวิต" }
                        ]
                    },
                    {
                        text: "คุณพบแผนที่ลับที่ตกจากตัวสมุน แต่มันถูกเขียนด้วยรหัสลับ",
                        options: [
                            { text: "ลองเผาไฟดูเผื่อเป็นหมึกล่องหน", correct: false, reason: "แผนที่ไหม้หมดสิ้น เบาะแสหายไปและคุณโดนลอบฆ่าภายหลัง" },
                            { text: "นำไปให้ผู้เฒ่าในหมู่บ้านช่วยดู", correct: true },
                            { text: "พยายามเดารหัสด้วยตัวเอง", correct: false, reason: "คุณถอดรหัสผิดและเดินหลงเข้าไปในกับดักระเบิด" }
                        ]
                    },
                    {
                        text: "ผู้เฒ่าบอกว่ามีคนทรยศในหมู่บ้านนำทางพวกสมุนมา คนคนนั้นคือ...",
                        options: [
                            { text: "เสี่ยวเอ้อที่ดูท่าทางลนลาน", correct: false, reason: "เขาเป็นแค่คนขี้กลัว คุณฆ่าผิดคนจนชาวบ้านรุมประณามและคุณถูกลอบสังหาร" },
                            { text: "หัวหน้าหมู่บ้านที่พยายามชวนคุณดื่มสุรา", correct: true },
                            { text: "ขอทานที่นั่งหน้าหมู่บ้าน", correct: false, reason: "เขาเป็นสายลับฝ่ายธรรมะ คุณถูกเขาสังหารเพื่อป้องกันตัว" }
                        ]
                    },
                    {
                        text: "หัวหน้าหมู่บ้านชักมีดสั้นอาบยาพิษออกมาโจมตีตอนคุณเผลอ!",
                        options: [
                            { text: "ใช้ฝ่ามือสยบมารฟาดใส่หน้าอกเขา", correct: true },
                            { text: "กระโดดถอยหลังไปตั้งหลักที่ประตู", correct: false, reason: "ที่ประตูมีกับดักเข็มพิษติดตั้งไว้ คุณถูกเข็มแทงเสียชีวิต" },
                            { text: "พยายามเจรจาถามเหตุผล", correct: false, reason: "ความเมตตาที่ผิดที่ทำให้เขาแทงคุณเข้าที่หัวใจ" }
                        ]
                    }
                ]
            },
            {
                levelName: "ป่าหมอกลวงตา",
                missions: [
                    {
                        text: "คุณเข้าสู่ป่าหมอกที่มองไม่เห็นทาง และได้ยินเสียงเพลงขลุ่ยประหลาด",
                        options: [
                            { text: "อุดหูแล้วเดินตามทิศทางลม", correct: true },
                            { text: "เดินตามเสียงขลุ่ยไป", correct: false, reason: "เสียงขลุ่ยนำคุณไปสู่หน้าผาสูงชันและคุณตกลงไปตาย" },
                            { text: "ตะโกนด่าทอผู้เล่นขลุ่ย", correct: false, reason: "เสียงของคุณทำให้หมอกพิษเข้มข้นขึ้นจนคุณขาดใจตาย" }
                        ]
                    },
                    {
                        text: "มีสตรีชุดขาวปรากฏกายท่ามกลางหมอก ขอนำทางคุณออกไป",
                        options: [
                            { text: "เดินตามเธอไปอย่างเงียบๆ", correct: false, reason: "เธอคือปีศาจแมงมุมที่ลวงคุณไปกินเป็นอาหาร" },
                            { text: "ใช้เนตรธรรมะส่องดูความจริง", correct: true },
                            { text: "ชักกระบี่ขู่ให้เธอกลัว", correct: false, reason: "เธอระเบิดตัวเป็นพิษใส่คุณจนตาย" }
                        ]
                    },
                    {
                        text: "เนตรธรรมะเผยให้เห็นว่าเส้นทางข้างหน้ามีกับดักขวากหนาม",
                        options: [
                            { text: "กระโดดข้ามไป", correct: false, reason: "ข้างบนมีตาข่ายดักไว้ คุณติดกับและถูกแทงตาย" },
                            { text: "เดินเหยียบก้อนหินด้านข้างตามจังหวะ", correct: true },
                            { text: "ใช้ลมปราณเป่าขวากหนามให้พ้นทาง", correct: false, reason: "ลมปราณทำให้กับดักกลไกทำงานรอบทิศทาง" }
                        ]
                    },
                    {
                        text: "คุณเจอศิษย์พี่ที่หายสาบสูญไปนอนบาดเจ็บอยู่",
                        options: [
                            { text: "รีบเข้าไปพยุงและรักษา", correct: false, reason: "นั่นคือหุ่นเชิดระเบิดของศัตรู คุณตายคาที่" },
                            { text: "ดีดหินใส่จุดรวมปราณเพื่อทดสอบ", correct: true },
                            { text: "เดินผ่านไปเฉยๆ เพราะไม่เชื่อใจ", correct: false, reason: "ศิษย์พี่ตัวจริงตายจากความละเลยของคุณ และคุณก็โดนคำสาปตายตาม" }
                        ]
                    },
                    {
                        text: "เจ้าแห่งป่าหมอกปรากฏตัว เขาท้าคุณประลองหมากรุกเพื่อทางออก",
                        options: [
                            { text: "ยอมเล่นตามกติกา", correct: false, reason: "หมากรุกนั้นคือกับดักวิญญาณ คุณถูกขังในกระดานตลอดกาล" },
                            { text: "คว่ำกระดานแล้วฟาดดาบใส่เขาทันที", correct: true },
                            { text: "บอกว่าเล่นไม่เป็นขอสู้ด้วยกำลัง", correct: false, reason: "เขาหัวเราะและใช้มนต์ดำขังคุณไว้ในหมอกนิรันดร์" }
                        ]
                    }
                ]
            },
            {
                levelName: "หุบเขาไร้รัก",
                missions: [
                    {
                        text: "ทางเข้าหุบเขามีหินสลักคำว่า 'ต้องสละสิ่งที่รักที่สุด' คุณจะทำอย่างไร?",
                        options: [
                            { text: "วางกระบี่คู่กายทิ้งไว้หน้าถ้ำ", correct: false, reason: "จอมยุทธ์ที่ทิ้งอาวุธย่อมถูกฆ่าตายโดยง่ายในถ้ำถัดไป" },
                            { text: "เดินผ่านเข้าไปโดยไม่สนใจคำขู่", correct: true },
                            { text: "สลักชื่อคนรักลงบนหิน", correct: false, reason: "หินดูดพลังวิญญาณคุณผ่านชื่อจนคุณแห้งเหี่ยวตาย" }
                        ]
                    },
                    {
                        text: "คุณเจอแม่น้ำสีเลือดขวางทาง ลำดับการข้ามที่ถูกต้องคือ?",
                        options: [
                            { text: "ว่ายน้ำข้ามไปตรงๆ", correct: false, reason: "น้ำกรดละลายร่างคุณจนไม่เหลือแม้แต่กระดูก" },
                            { text: "ใช้ลมปราณเหยียบน้ำข้ามไป", correct: true },
                            { text: "รอให้เรือจ้างมารับ", correct: false, reason: "คนพายเรือคือยมทูตที่มารับวิญญาณคุณไปสู่ปรโลก" }
                        ]
                    },
                    {
                        text: "มีถ้ำสามถ้ำให้เลือก: ถ้ำมังกรไฟ, ถ้ำน้ำแข็งหมื่นปี, ถ้ำเงียบสงัด",
                        options: [
                            { text: "ถ้ำมังกรไฟ", correct: false, reason: "ไฟบรรลัยกัลป์เผาคุณจนเป็นจุณ" },
                            { text: "ถ้ำน้ำแข็งหมื่นปี", correct: false, reason: "ร่างคุณแข็งค้างเป็นประติมากรรมน้ำแข็งตลอดกาล" },
                            { text: "ถ้ำเงียบสงัด", correct: true }
                        ]
                    },
                    {
                        text: "ในถ้ำเงียบสงัด คุณได้ยินเสียงหัวใจตัวเองเต้นดังขึ้นเรื่อยๆ จนเจ็บปวด",
                        options: [
                            { text: "โคจรพลังย้อนกลับเพื่อต้านเสียง", correct: false, reason: "เส้นเลือดในสมองแตกจากการฝืนธรรมชาติ" },
                            { text: "เข้าสู่สภาวะว่างเปล่า ตัดการรับรู้ทางหู", correct: true },
                            { text: "พยายามตะโกนให้ดังกว่าเสียงหัวใจ", correct: false, reason: "ความดันในอกเพิ่มขึ้นจนหัวใจระเบิด" }
                        ]
                    },
                    {
                        text: "ผู้เฝ้าหุบเขาปรากฏตัวและถามว่า 'รักคืออะไร?'",
                        options: [
                            { text: "ตอบว่าเป็นความอ่อนแอ", correct: true },
                            { text: "ตอบว่าเป็นพลังที่ยิ่งใหญ่", correct: false, reason: "ที่นี่คือหุบเขาไร้รัก คำตอบของคุณขัดต่อเจตนารมณ์พื้นที่ คุณถูกสังหาร" },
                            { text: "ตอบว่าไม่รู้และไม่สนใจ", correct: false, reason: "ความเขลาทำให้คุณถูกเปลี่ยนเป็นหินประดับหุบเขา" }
                        ]
                    }
                ]
            },
            {
                levelName: "ถ้ำศิลาหยด",
                missions: [
                    {
                        text: "น้ำหยดจากเพดานถ้ำมีกลิ่นหอมประหลาด คุณรู้สึกเคลิบเคลิ้ม",
                        options: [
                            { text: "ลองชิมน้ำดูเพื่อเพิ่มพลัง", correct: false, reason: "น้ำนั้นคือสารเสพติดวิญญาณ คุณกลายเป็นทาสถ้ำตลอดกาล" },
                            { text: "ใช้ไฟจากคบเพลิงเผาอากาศรอบตัว", correct: true },
                            { text: "สูดดมให้เต็มปอดเพื่อหาที่มา", correct: false, reason: "ปอดของคุณเน่าเฟะในทันทีจากฤทธิ์ของเกสรพิษ" }
                        ]
                    },
                    {
                        text: "ค้างคาวโลหิตนับพันบินพุ่งเข้าหาคุณ!",
                        options: [
                            { text: "ใช้กระบี่ร่ายรำเป็นวงกลมป้องกัน", correct: true },
                            { text: "หมอบลงกับพื้น", correct: false, reason: "พื้นถ้ำคือรังของตะขาบยักษ์ คุณถูกกัดตาย" },
                            { text: "ใช้ระเบิดแสง", correct: false, reason: "แสงทำให้ค้างคาวคลั่งกว่าเดิมและรุมฉีกร่างคุณ" }
                        ]
                    },
                    {
                        text: "คุณพบศิลาจารึกวิชาไม้ตาย แต่ต้องสละโลหิตครึ่งกายเพื่อเปิดออก",
                        options: [
                            { text: "ใช้เลือดตัวเองป้ายศิลา", correct: false, reason: "ศิลาดูดเลือดคุณจนหมดตัว" },
                            { text: "ใช้เลือดสัตว์ที่เพิ่งฆ่ามาป้ายแทน", correct: false, reason: "ศิลารู้เท่าทันและปล่อยกระแสไฟฟ้าช็อตคุณตาย" },
                            { text: "ทำลายศิลาทิ้งเพราะเป็นวิชามาร", correct: true }
                        ]
                    },
                    {
                        text: "พื้นถ้ำเริ่มถล่มลงมาจากการทำลายศิลา!",
                        options: [
                            { text: "วิ่งย้อนกลับทางเดิม", correct: false, reason: "ทางเดิมถูกปิดตายไปแล้วและหินหล่นทับคุณ" },
                            { text: "ใช้ความไวพุ่งไปข้างหน้าที่มีแสงรำไร", correct: true },
                            { text: "หยุดรอเพื่อดูทิศทางหินตก", correct: false, reason: "หินก้อนใหญ่เกินกว่าจะหลบได้ตกใส่หัวคุณ" }
                        ]
                    },
                    {
                        text: "ทางออกถูกขวางด้วยแมงมุมยักษ์สี่ตา",
                        options: [
                            { text: "แทงเข้าที่ตาแต่ละดวง", correct: true },
                            { text: "ฟันที่ขาของมัน", correct: false, reason: "มันงอกขาใหม่ได้และพ่นใยพันร่างคุณจนตาย" },
                            { text: "พยายามมุดใต้ท้องมันออกไป", correct: false, reason: "ใต้ท้องมันมีเข็มพิษนับร้อยแทงคุณ" }
                        ]
                    }
                ]
            },
            {
                levelName: "สำนักกระบี่เลื่องชื่อ",
                missions: [
                    {
                        text: "คุณพบว่าศิษย์ในสำนักถูกสะกดจิตให้โจมตีกันเอง คุณจะหยุดยั้งอย่างไร?",
                        options: [
                            { text: "สังหารทุกคนที่ขวางทาง", correct: false, reason: "คุณกลายเป็นฆาตกรและถูกเจ้าสำนักสังหาร" },
                            { text: "ใช้เข็มทองสกัดจุดหยุดการเคลื่อนไหว", correct: true },
                            { text: "ตะโกนเรียกสติด้วยพลังเสียง", correct: false, reason: "พวกเขายิ่งคลั่งและรุมสับคุณเป็นชิ้นๆ" }
                        ]
                    },
                    {
                        text: "เจ้าสำนักกระบี่เลื่องชื่อเรียกคุณไปพบที่หอคอยลับ แต่เขาดูเปลี่ยนไป",
                        options: [
                            { text: "คุกเข่าคำนับแสดงความเคารพ", correct: false, reason: "เขาฉวยโอกาสฟันคอคุณขาดขณะก้มศีรษะ" },
                            { text: "กำกระบี่แน่นและเว้นระยะห่าง", correct: true },
                            { text: "ยื่นจดหมายลับให้เขาดู", correct: false, reason: "เขาเผาจดหมายและฆ่าคุณเพื่อปิดปาก" }
                        ]
                    },
                    {
                        text: "เจ้าสำนักที่แท้จริงถูกขังในคุกกระจกเงา คุณต้องทำลายกระจกบานที่ถูกต้อง",
                        options: [
                            { text: "บานที่ไม่มีเงาสะท้อน", correct: true },
                            { text: "บานที่สว่างที่สุด", correct: false, reason: "กระจกสะท้อนพลังดาบคุณกลับมาฆ่าตัวคุณเอง" },
                            { text: "ทำลายทุกบานพร้อมกัน", correct: false, reason: "กระจกนับพันบาดร่างคุณจนเสียชีวิต" }
                        ]
                    },
                    {
                        text: "สายลับพรรคมังกรทมิฬปลอมตัวเป็นศิษย์น้องพยายามส่งน้ำชาให้",
                        options: [
                            { text: "ดื่มเพื่อไม่ให้เสียมารยาท", correct: false, reason: "ชาอาบยาพิษที่ไม่มีทางแก้ คุณสิ้นชีพใน 3 วินาที" },
                            { text: "แกล้งทำน้ำชาหกใส่เสื้อเขา", correct: true },
                            { text: "สั่งให้เขาลองดื่มก่อน", correct: false, reason: "เขาระเบิดตัวเองตายไปพร้อมกับคุณ" }
                        ]
                    },
                    {
                        text: "คุณต้องชิง 'ตราประทับสำนัก' คืนจากจอมยุทธ์ทรยศบนหลังคา",
                        options: [
                            { text: "ใช้ท่าเท้าท่องเมฆาพุ่งเข้าประชิด", correct: true },
                            { text: "ขว้างมีดบินใส่", correct: false, reason: "เขาปัดมีดคืนใส่หน้าผากคุณพอดี" },
                            { text: "ถีบกระเบื้องหลังคาให้เขาสะดุด", correct: false, reason: "คุณสะดุดเองและตกลงมาคอหักตาย" }
                        ]
                    }
                ]
            },
            {
                levelName: "ด่านชายแดนทมิฬ",
                missions: [
                    {
                        text: "พายุทรายกำลังพัดกระหน่ำ มองไม่เห็นศัตรูที่ลอบโจมตี",
                        options: [
                            { text: "กางลมปราณคุ้มกันกายเป็นเกราะ", correct: true },
                            { text: "รีบวิ่งฝ่าพายุไป", correct: false, reason: "คุณตกหลุมพรางทรายดูดและตายอย่างทรมาน" },
                            { text: "ขุดหลุมหลบใต้ทราย", correct: false, reason: "หนอนยักษ์ใต้ทรายเขมือบคุณเป็นอาหาร" }
                        ]
                    },
                    {
                        text: "ทหารยามหอคอยตรวจพบคุณด้วยกระจกส่องวิญญาณ",
                        options: [
                            { text: "ใช้หน้ากากหนังมนุษย์ปลอมตัว", correct: false, reason: "กระจกส่องเห็นวิญญาณ ไม่ใช่หน้าตา คุณถูกธนูนับร้อยรุมยิง" },
                            { text: "ใช้ความเร็วเคลื่อนที่สลับเงา", correct: true },
                            { text: "ทำลายหอคอยด้วยฝ่ามือหนัก", correct: false, reason: "เสียงระเบิดดึงทหารทั้งกองทัพมารุมสังหารคุณ" }
                        ]
                    },
                    {
                        text: "มีสะพานไม้เก่าๆ ข้ามหุบเหวที่เต็มไปด้วยไอพิษ",
                        options: [
                            { text: "ใช้ไม้พลองยาวค้ำยันขณะข้าม", correct: false, reason: "ไม้พลองหนักเกินไปทำให้สะพานขาด คุณตกลงสู่เหว" },
                            { text: "เดินเหยียบเฉพาะจุดที่เป็นรอยต่อเหล็ก", correct: true },
                            { text: "วิ่งข้ามให้ไวที่สุดก่อนสะพานรู้ตัว", correct: false, reason: "ไม้ผุพังรับแรงกระแทกไม่ไหว คุณร่วงหล่นลงไป" }
                        ]
                    },
                    {
                        text: "คุณต้องวางยาในคลังเสบียง แต่มีสุนัขเฝ้ายามจมูกไว",
                        options: [
                            { text: "โยนเนื้อชิ้นใหญ่ให้มันกิน", correct: false, reason: "เนื้อนั้นปลุกสัญชาตญาณดุร้าย มันรุมฉีกร่างคุณ" },
                            { text: "ใช้ผงกลบกลิ่นที่ทำจากสมุนไพรขม", correct: true },
                            { text: "ฆ่าสุนัขทิ้งเงียบๆ", correct: false, reason: "สุนัขมีเครื่องส่งสัญญาณในปลอกคอ ทหารแห่มาทันที" }
                        ]
                    },
                    {
                        text: "แม่ทัพชายแดนท้าดวลดาบกับคุณกลางทุ่งหญ้า",
                        options: [
                            { text: "เน้นการตั้งรับและสวนกลับเมื่อเขาอ่อนแรง", correct: true },
                            { text: "แลกดาบต่อดาบเพื่อวัดพลัง", correct: false, reason: "พละกำลังเขาเหนือกว่ามาก ดาบเขาตัดแขนคุณขาด" },
                            { text: "ใช้ทรายสัดใส่ตาเขา", correct: false, reason: "เขาใส่หน้ากากเหล็กป้องกันไว้ และจามขวานใส่หัวคุณ" }
                        ]
                    }
                ]
            },
            {
                levelName: "ปราสาทลอยฟ้า",
                missions: [
                    {
                        text: "ทางเดินในปราสาทมีการกลับด้านแรงโน้มถ่วงเป็นระยะ",
                        options: [
                            { text: "เดินด้วยมือเพื่อรักษาสมดุล", correct: false, reason: "เลือดลงหัวจนหน้ามืดและตกลงไปในแกนปราสาท" },
                            { text: "ใช้ตะขอเกี่ยวรั้งไว้กับผนัง", correct: true },
                            { text: "พยายามกระโดดไปมาในอากาศ", correct: false, reason: "คุณลอยละล่องออกไปนอกปราสาทและตกลงสู่พื้นโลก" }
                        ]
                    },
                    {
                        text: "นกยักษ์จักรกลพุ่งเข้ามาจิกตีคุณบนระเบียงปราสาท",
                        options: [
                            { text: "ทำลายเฟืองตัวหลักที่หน้าอกมัน", correct: true },
                            { text: "พยายามขี่หลังมัน", correct: false, reason: "มันสลัดคุณหลุดจากความสูงหมื่นลี้" },
                            { text: "ใช้กระบี่ฟันปีกมัน", correct: false, reason: "ปีกทำจากเหล็กกล้า กระบี่คุณบิ่นและมันจิกหัวคุณทะลุ" }
                        ]
                    },
                    {
                        text: "คุณต้องไขปริศนาเฟืองจักรทองคำเพื่อเปิดประตูห้องโถง",
                        options: [
                            { text: "หมุนตามเข็มนาฬิกา 3 รอบ", correct: false, reason: "เฟืองขัดตัวและระเบิดใส่อกคุณ" },
                            { text: "หมุนทวนเข็มนาฬิกาจนกว่าจะได้ยินเสียงคลิก", correct: true },
                            { text: "ใช้กำลังงัดเฟืองออก", correct: false, reason: "กลไกป้องกันตัวปล่อยแก๊สพิษใส่คุณ" }
                        ]
                    },
                    {
                        text: "ทางเดินแคบๆ มีลมพายุรุนแรงพยายามพัดคุณตก",
                        options: [
                            { text: "หมอบคลานไปช้าๆ", correct: true },
                            { text: "กางร่มเหล็กเพื่อกันลม", correct: false, reason: "ร่มกลายเป็นใบเรือพัดคุณลอยไปกับลม" },
                            { text: "วิ่งสวนกระแสลมด้วยท่าเท้าเงา", correct: false, reason: "แรงลมต้านมหาศาลทำให้ปอดคุณฉีกขาด" }
                        ]
                    },
                    {
                        text: "ผู้พิทักษ์ปราสาทเป็นหุ่นยนต์ยักษ์ที่ไม่มีความรู้สึก",
                        options: [
                            { text: "ใช้พลังธาตุสายฟ้าใส่ข้อต่อ", correct: true },
                            { text: "ใช้เพลงดาบอ่อนช้อยลวงตา", correct: false, reason: "มันคำนวณด้วยสมองกลและจับคุณบี้จนเละ" },
                            { text: "ตะโกนเรียกชื่อผู้สร้างมัน", correct: false, reason: "มันไม่มีระบบจำเสียง และเหยียบคุณจมดิน" }
                        ]
                    }
                ]
            },
            {
                levelName: "คุกใต้ดินนิรันดร์",
                missions: [
                    {
                        text: "คุกมืดสนิทและเต็มไปด้วยน้ำครำ คุณได้ยินเสียงโซ่ตรวนลากพื้น",
                        options: [
                            { text: "จุดไฟแช็กเพื่อดูทาง", correct: false, reason: "ในคุกมีก๊าซไข่เน่าสะสม ไฟทำให้ระเบิดตูมเดียวตาย" },
                            { text: "ใช้สัมผัสที่หกเดินตามความเย็น", correct: true },
                            { text: "เคาะผนังเพื่อหาทางออก", correct: false, reason: "เสียงดึงดูดอสูรกายใต้ดินมากินคุณ" }
                        ]
                    },
                    {
                        text: "คุณเจอเพื่อนร่วมสำนักถูกขัง แต่เขามีอาการคลุ้มคลั่ง",
                        options: [
                            { text: "รีบไขกุญแจช่วยเขา", correct: false, reason: "เขากัดคอคุณขาดในทันทีที่ประตูเปิด" },
                            { text: "สざまจุดสลบก่อนเข้าช่วยเหลือ", correct: true },
                            { text: "ปล่อยเขาไว้แบบนั้นเพื่อความปลอดภัย", correct: false, reason: "วิญญาณเขาตามอาฆาตและหลอนคุณจนตาย" }
                        ]
                    },
                    {
                        text: "พัศดีคุกตัวมหึมาถือแส้หนามเดินตรวจตรา",
                        options: [
                            { text: "พุ่งเข้าแทงที่ดวงตาเดียวของเขา", correct: true },
                            { text: "ซ่อนตัวในถังขยะ", correct: false, reason: "เขาใช้แส้ฟาดถังจนแตกและร่างคุณขาดเป็นสองท่อน" },
                            { text: "ติดสินบนด้วยทองคำ", correct: false, reason: "เขาไม่รู้จักเงินทองและกินทองพร้อมมือคุณเข้าไป" }
                        ]
                    },
                    {
                        text: "มีประตูบานหนึ่งสลักว่า 'ทางออก' อีกบานสลักว่า 'ทางตาย'",
                        options: [
                            { text: "เข้าประตู 'ทางออก'", correct: false, reason: "มันคือกับดักหลุมศพ" },
                            { text: "เข้าประตู 'ทางตาย'", correct: true },
                            { text: "ทำลายกำแพงระหว่างประตู", correct: false, reason: "เพดานถล่มลงมาทับคุณ" }
                        ]
                    },
                    {
                        text: "นักโทษการเมืองขอร้องให้คุณพาส่งข่าวก่อนเขาจะตาย",
                        options: [
                            { text: "รับฟังรหัสลับและจดจำ", correct: true },
                            { text: "ปฏิเสธเพราะยุ่งอยู่", correct: false, reason: "เขาใช้แรงเฮือกสุดท้ายแทงเข็มพิษใส่คุณ" },
                            { text: "พยายามแบกร่างเขาไปด้วย", correct: false, reason: "น้ำหนักเขาทำให้คุณเคลื่อนที่ช้าและถูกทหารจับได้" }
                        ]
                    }
                ]
            },
            {
                levelName: "สะพานข้ามภพ",
                missions: [
                    {
                        text: "สะพานที่ดูเหมือนไม่มีวันสิ้นสุด มีเงาของคุณเดินสวนมา",
                        options: [
                            { text: "โจมตีเงาของตัวเอง", correct: false, reason: "บาดแผลที่เงาได้รับจะปรากฏบนร่างคุณ คุณตายเพราะตัวเอง" },
                            { text: "เดินผ่านเงาไปโดยไม่สบตา", correct: true },
                            { text: "พูดคุยกับเงาเพื่อถามทาง", correct: false, reason: "เงาสูบเอาตัวตนคุณไปและทิ้งร่างเปล่าไว้ที่นี่" }
                        ]
                    },
                    {
                        text: "วิญญาณบรรพบุรุษปรากฏตัวและตำหนิที่คุณมาที่นี่",
                        options: [
                            { text: "คุกเข่าขอขมา", correct: false, reason: "พวกเขาเป็นวิญญาณลวงตาที่หลอกให้คุณลดการป้องกันเพื่อฆ่า" },
                            { text: "ชักกระบี่แสดงปณิธานการกอบกู้", correct: true },
                            { text: "เถียงกลับด้วยเหตุผล", correct: false, reason: "เสียงของคุณหายไป และคุณกลายเป็นใบ้จนตาย" }
                        ]
                    },
                    {
                        text: "สะพานเริ่มกลายเป็นไฟนรกแผดเผาเท้าคุณ",
                        options: [
                            { text: "กระโดดแช่น้ำข้างสะพาน", correct: false, reason: "น้ำนั้นคือน้ำมัน คุณกลายเป็นกองเพลิงทันที" },
                            { text: "ใช้ลมปราณเย็นปกคลุมฝ่าเท้า", correct: true },
                            { text: "ถอดรองเท้าเดิน", correct: false, reason: "เท้าคุณละลายติดกับสะพาน" }
                        ]
                    },
                    {
                        text: "มีเสียงเรียกชื่อคุณจากเบื้องหลัง เป็นเสียงของแม่ที่ตายไปแล้ว",
                        options: [
                            { text: "หันกลับไปกอดท่าน", correct: false, reason: "นั่นคืออสูรกายจองจำวิญญาณที่รอให้คุณหันหลัง" },
                            { text: "ตั้งมั่นในสมาธิและเดินหน้าต่อไป", correct: true },
                            { text: "ตะโกนบอกว่า 'ลูกคิดถึงแม่'", correct: false, reason: "พลังเสียงดึงดูดวิญญาณเร่ร่อนมารุมทึ้งร่างคุณ" }
                        ]
                    },
                    {
                        text: "สุดปลายสะพานมีกรงล้อแห่งโชคชะตา คุณต้องเลือกหยุดมัน",
                        options: [
                            { text: "หยุดที่สัญลักษณ์มังกรสีน้ำเงิน", correct: true },
                            { text: "หยุดที่สัญลักษณ์กะโหลก", correct: false, reason: "โชคชะตาคุณสิ้นสุดลงตรงนี้" },
                            { text: "ปล่อยให้มันหมุนไปเรื่อยๆ", correct: false, reason: "เวลาของคุณหมดลงและคุณสลายกลายเป็นผงคลี" }
                        ]
                    }
                ]
            },
            {
                levelName: "ตำหนักมังกรทมิฬ",
                missions: [
                    {
                        text: "คุณยืนหน้าประตูตำหนักที่มีมังกรหินยักษ์สองตัวคอยจ้องมอง",
                        options: [
                            { text: "ป้อนไข่มุกวิเศษใส่ปากมังกรหิน", correct: true },
                            { text: "วิ่งฝ่ากลางเข้าไป", correct: false, reason: "มังกรหินพ่นไฟเผาคุณจนไม่เหลือซาก" },
                            { text: "ปีนกำแพงด้านข้าง", correct: false, reason: "กำแพงมีหนามพิษซ่อนอยู่ คุณถูกแทงตาย" }
                        ]
                    },
                    {
                        text: "ภายในตำหนักเต็มไปด้วยควันธูปลวงสติ",
                        options: [
                            { text: "กลั้นหายใจและใช้ผ้าชุบน้ำปิดจมูก", correct: true },
                            { text: "ใช้ฝ่ามือพัดควันให้ออกไป", correct: false, reason: "ควันยิ่งกระจายตัวเร็วขึ้นและคุณหมดสติจนตาย" },
                            { text: "นั่งสมาธิกลางควัน", correct: false, reason: "พิษซึมเข้าทางผิวหนังและคุณตายในสมาธิ" }
                        ]
                    },
                    {
                        text: "องค์รักษ์เสื้อแพรนับร้อยล้อมคุณไว้",
                        options: [
                            { text: "ใช้ท่าไม้ตายกวาดล้างรอบทิศทาง", correct: true },
                            { text: "ขอท้าสู้แบบตัวต่อตัว", correct: false, reason: "พวกเขาไม่มีเกียรติและรุมฟันคุณตาย" },
                            { text: "หลอกล่อให้พวกเขาสู้กันเอง", correct: false, reason: "พวกเขาถูกฝึกมาอย่างดีและรุมปลิดชีพคุณ" }
                        ]
                    },
                    {
                        text: "จอมมารทมิฬนั่งอยู่บนบัลลังก์และยื่นข้อเสนอให้คุณเป็นรองประมุข",
                        options: [
                            { text: "ตกลงเพื่อหาจังหวะลอบฆ่า", correct: false, reason: "เขารู้วาระจิตคุณและบีบคอคุณตายทันที" },
                            { text: "ปฏิเสธและชี้กระบี่ใส่หน้าเขา", correct: true },
                            { text: "พยายามเทศนาให้เขากลับใจ", correct: false, reason: "เขาหัวเราะและดีดนิ้วฆ่าคุณด้วยพลังปราณ" }
                        ]
                    },
                    {
                        text: "การต่อสู้ครั้งสุดท้าย! จอมมารใช้พลังเทพมังกรทมิฬพุ่งเข้าหาคุณ!",
                        options: [
                            { text: "รวมพลังทั้งหมดใช้ท่า 'เทวะพิฆาตมาร' สวนกลับ", correct: true },
                            { text: "ใช้โล่ปราณป้องกัน", correct: false, reason: "โล่แตกสลายและคุณถูกพลังบดขยี้" },
                            { text: "หลบหลีกไปด้านหลังเสา", correct: false, reason: "เสาถล่มทับคุณและจอมมารซ้ำด้วยฝ่ามือจนตาย" }
                        ]
                    }
                ]
            }
        ];

        let currentLevel = 0;
        let currentMission = 0;
        let audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let bgmSource = null;
        let correctSource = null;
        let lostSource = null;
        let winSource = null;
        let correctBuffer = null;
        let lostBuffer = null;
        let winBuffer = null;
        let bgmBuffer = null;
        let isCorrectPlaying = false;

        // Load audio buffers
        async function loadAudio(url) {
            const response = await fetch(url);
            const arrayBuffer = await response.arrayBuffer();
            return await audioContext.decodeAudioData(arrayBuffer);
        }

        async function preloadAudio() {
            bgmBuffer = await loadAudio('audio/back.mp3');
            correctBuffer = await loadAudio('audio/t.mp3');
            lostBuffer = await loadAudio('audio/lost.mp3');
            winBuffer = await loadAudio('audio/win.mp3');
        }

        // Play sound
        function playSound(buffer, loop = false, onEnded = null) {
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.loop = loop;
            source.start(0);
            if (onEnded) {
                source.onended = onEnded;
            }
            return source;
        }

        // Stop sound
        function stopSound(source) {
            if (source) {
                source.stop(0);
                source = null;
            }
        }

        // Handle correct sound with restart if quick
        function playCorrectSound(isLastMission = false) {
            if (isCorrectPlaying) {
                stopSound(correctSource);
            }
            isCorrectPlaying = true;
            correctSource = playSound(correctBuffer, false, () => {
                isCorrectPlaying = false;
                if (isLastMission) {
                    playWinSound();
                }
            });
        }

        function playLostSound() {
            stopAllSounds();
            lostSource = playSound(lostBuffer);
        }

        function playWinSound() {
            winSource = playSound(winBuffer);
        }

        function playBgm() {
            bgmSource = playSound(bgmBuffer, true);
        }

        function stopAllSounds() {
            stopSound(bgmSource);
            stopSound(correctSource);
            stopSound(lostSource);
            stopSound(winSource);
            isCorrectPlaying = false;
        }

        // Preload audio on load
        preloadAudio();

        function startGame() {
            document.getElementById('start-screen').classList.add('screen-hidden');
            document.getElementById('gameplay-screen').classList.remove('screen-hidden');
            document.getElementById('back-menu-btn').classList.add('screen-hidden');
            playBgm();
            renderMission();
        }

        function renderMission() {
            const level = gameData[currentLevel];
            const mission = level.missions[currentMission];
            
            document.getElementById('level-display').innerText = `ด่านที่: ${currentLevel + 1}/10 (${level.levelName})`;
            document.getElementById('mission-display').innerText = `ภารกิจที่: ${currentMission + 1}/5`;
            document.getElementById('scenario-text').innerText = mission.text;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            mission.options.forEach((opt) => {
                const btn = document.createElement('button');
                btn.className = "bg-gray-700 hover:bg-red-900 text-left p-4 rounded border border-gray-500 transition-colors w-full";
                btn.innerText = opt.text;
                btn.onclick = () => {
                    if (opt.correct) {
                        const isLast = (currentLevel === 9 && currentMission === 4);
                        playCorrectSound(isLast);
                        nextStep();
                    } else {
                        playLostSound();
                        showDeath(opt.reason);
                    }
                };
                optionsContainer.appendChild(btn);
            });

            // Focus on first heading after render
            setTimeout(() => {
                document.getElementById('level-display').focus();
            }, 100); // Small buffer for render
        }

        function nextStep() {
            currentMission++;
            if (currentMission >= 5) {
                currentMission = 0;
                currentLevel++;
            }

            if (currentLevel >= 10) {
                // Wait for correct sound to finish before showing win
                if (isCorrectPlaying) {
                    correctSource.onended = () => {
                        showWin();
                    };
                } else {
                    showWin();
                }
            } else {
                // Delay for 1 second before next mission
                setTimeout(() => {
                    renderMission();
                }, 1000);
            }
        }

        function showDeath(reason) {
            document.getElementById('gameplay-screen').classList.add('screen-hidden');
            document.getElementById('death-reason').innerText = reason;
            document.getElementById('death-screen').classList.remove('screen-hidden');
            document.getElementById('death-screen').style.display = 'flex';
            document.getElementById('back-menu-btn').classList.remove('screen-hidden');
            setTimeout(() => {
                document.getElementById('death-heading').focus();
            }, 100);
        }

        function showWin() {
            stopSound(bgmSource);
            document.getElementById('gameplay-screen').classList.add('screen-hidden');
            document.getElementById('win-screen').classList.remove('screen-hidden');
            document.getElementById('win-screen').style.display = 'flex';
            document.getElementById('back-menu-btn').classList.remove('screen-hidden');
            setTimeout(() => {
                document.getElementById('win-heading').focus();
            }, 100);
        }

        function restartGame() {
            stopAllSounds();
            currentLevel = 0;
            currentMission = 0;
            document.getElementById('death-screen').style.display = 'none';
            document.getElementById('win-screen').style.display = 'none';
            document.getElementById('death-screen').classList.add('screen-hidden');
            document.getElementById('win-screen').classList.add('screen-hidden');
            document.getElementById('start-screen').classList.remove('screen-hidden');
            document.getElementById('gameplay-screen').classList.add('screen-hidden');
            document.getElementById('back-menu-btn').classList.remove('screen-hidden');
            setTimeout(() => {
                document.getElementById('start-heading').focus();
            }, 100);
        }

        // Initial focus on start screen
        window.addEventListener('load', () => {
            document.getElementById('back-menu-btn').classList.remove('screen-hidden');
            document.getElementById('start-heading').focus();
        });
    </script>
</body>
</html>