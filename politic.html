<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกมจำลองการเมือง: อนาคตของชาติ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js library for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            box-sizing: border-box;
            position: relative; /* Added for positioning the back button */
        }
        .game-container {
            width: 100%;
            max-width: 800px;
            background-color: #2d3748;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .stats-bar {
            background-color: #4a5568;
            border-radius: 0.75rem;
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            text-align: center;
            font-weight: bold;
        }
        .stat {
            background-color: #1a202c;
            padding: 0.75rem;
            border-radius: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .game-output {
            background-color: #1a202c;
            border-radius: 0.75rem;
            padding: 1.5rem;
            line-height: 1.6;
        }
        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .choice-button {
            background-color: #4c51bf;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            font-weight: bold;
        }
        .choice-button:hover {
            background-color: #667eea;
        }
        .choice-button:active {
            transform: scale(0.98);
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2d3748;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            text-align: center;
            z-index: 100;
            border: 2px solid #667eea;
        }
        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 99;
        }
        /* Style for the top-left menu button */
        .top-left-menu {
            position: absolute;
            top: 1rem; /* Adjust as needed */
            left: 1rem; /* Adjust as needed */
            z-index: 101; /* Ensure it's above other elements */
        }
        .back-to-menu-button {
            background-color: #6366f1; /* Indigo 500 */
            color: #ffffff; /* White text */
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .back-to-menu-button:hover {
            background-color: #4f46e5; /* Indigo 600 */
            transform: translateY(-1px);
        }
        .back-to-menu-button:active {
            transform: translateY(0);
            box-shadow: none;
        }
    </style>
</head>
<body>

<!-- Top Left Menu Button -->
<div class="top-left-menu">
    <button class="back-to-menu-button" onclick="goBackToMainMenu()">กลับเมนูหลัก</button>
</div>

<div class="game-container">
    <h1 class="text-center text-3xl font-bold">เกมจำลองการเมือง: อนาคตของชาติ</h1>
    <div id="stats-bar" class="stats-bar">
        <div class="stat">วัน: <span id="day-stat">0</span></div>
        <div class="stat">ความนิยม: <span id="popularity-stat">50</span>%</div>
        <div class="stat">เศรษฐกิจ: <span id="economy-stat">50</span>%</div>
        <div class="stat">ความมั่นคง: <span id="stability-stat">50</span>%</div>
    </div>
    <div id="game-output" class="game-output">
        <p>ยินดีต้อนรับสู่เกมจำลองการเมือง! คุณคือผู้นำคนใหม่ของประเทศ และอนาคตของชาติอยู่ในมือคุณแล้ว เริ่มต้นการเดินทางเพื่อสร้างประเทศที่แข็งแกร่งและรุ่งเรือง!</p>
    </div>
    <div id="choices-container" class="choices-container">
        <!-- Choices will be added here by JavaScript -->
    </div>
</div>

<script>
    // Constants for game state management
    const GAME_LENGTH = 20; // 4 years * 5 days
    const STATS_LIMIT = 100;
    const GAME_OVER_THRESHOLD = 0;
    const ELECTION_WIN_POPULARITY = 50; // Popularity needed to win the election

    // Game state variables
    let popularity = 50;
    let economy = 50;
    let stability = 50;
    let currentDay = 0;
    let playedEvents = [];
    
    // DOM elements
    const gameOutput = document.getElementById('game-output');
    const choicesContainer = document.getElementById('choices-container');
    const dayStat = document.getElementById('day-stat');
    const popularityStat = document.getElementById('popularity-stat');
    const economyStat = document.getElementById('economy-stat');
    const stabilityStat = document.getElementById('stability-stat');

    // Audio elements using Tone.js
    const clickSynth = new Tone.MembraneSynth().toDestination();
    const bellSynth = new Tone.Synth({
      oscillator: { type: "sine" },
      envelope: { attack: 0.05, decay: 0.5, sustain: 0, release: 0.5 }
    }).toDestination();

    // Game event scenarios
    const allEvents = [
        {
            text: "คุณต้องเผชิญหน้ากับวิกฤตเศรษฐกิจครั้งใหญ่ในประเทศ การลงทุนจากต่างประเทศลดลงอย่างมากและอัตราการว่างงานเพิ่มสูงขึ้น ประชาชนเริ่มประท้วงเรียกร้องให้รัฐบาลดำเนินการแก้ไขอย่างเร่งด่วน คุณจะเลือกมาตรการใด?",
            choices: [
                { text: "ออกนโยบายกระตุ้นเศรษฐกิจระยะสั้นโดยการกู้เงินมาลงทุนในโครงการขนาดใหญ่", consequences: { economy: 15, popularity: 10, stability: -5 } },
                { text: "ประกาศมาตรการรัดเข็มขัด ลดงบประมาณภาครัฐ และกระตุ้นให้ประชาชนประหยัด", consequences: { economy: -5, popularity: -15, stability: 5 } },
                { text: "เจรจาขอความช่วยเหลือจากประเทศมหาอำนาจแลกกับสิทธิทางการค้า", consequences: { economy: 10, popularity: -5, stability: -10 } }
            ]
        },
        {
            text: "เกิดภัยธรรมชาติครั้งร้ายแรง น้ำท่วมใหญ่ส่งผลกระทบต่อพื้นที่เกษตรกรรมและที่อยู่อาศัยในวงกว้าง ประชาชนจำนวนมากไร้ที่อยู่อาศัยและขาดแคลนอาหาร",
            choices: [
                { text: "ระดมงบประมาณฉุกเฉินทั้งหมดเพื่อช่วยเหลือผู้ประสบภัยโดยทันที", consequences: { economy: -10, popularity: 20, stability: 15 } },
                { text: "ขอความช่วยเหลือจากนานาชาติและเปิดรับบริจาคจากภาคเอกชน", consequences: { economy: 5, popularity: 10, stability: 5 } },
                { text: "เน้นการฟื้นฟูโครงสร้างพื้นฐานที่สำคัญก่อนเพื่อป้องกันปัญหาซ้ำซ้อนในอนาคต", consequences: { economy: 15, popularity: -5, stability: 10 } }
            ]
        },
        {
            text: "กลุ่มนักเรียนและนักศึกษาออกมาเรียกร้องประชาธิปไตยและการปฏิรูปการเมืองอย่างต่อเนื่อง การประท้วงเริ่มรุนแรงขึ้นเรื่อยๆ สร้างความไม่พอใจให้กับประชาชนบางส่วนที่ต้องการความสงบเรียบร้อย",
            choices: [
                { text: "ส่งเจ้าหน้าที่ไปเจรจากับแกนนำเพื่อหาทางออกอย่างสันติ", consequences: { economy: -5, popularity: 10, stability: 5 } },
                { text: "ใช้มาตรการทางกฎหมายเพื่อสลายการชุมนุมและรักษาความสงบ", consequences: { economy: 5, popularity: -15, stability: 20 } },
                { text: "ออกกฎหมายปฏิรูปการศึกษาและเพิ่มสิทธิเสรีภาพในการแสดงออกบางส่วน", consequences: { economy: 0, popularity: 15, stability: -10 } }
            ]
        },
        {
            text: "ประเทศเพื่อนบ้านพยายามขยายอิทธิพลเข้ามาในพรมแดนของคุณ กองทัพส่งสัญญาณเตือนภัยว่าสถานการณ์อาจบานปลายได้ทุกเมื่อ",
            choices: [
                { text: "เพิ่มงบประมาณทางทหารเพื่อเสริมกำลังป้องกันประเทศ", consequences: { economy: -15, popularity: 5, stability: 15 } },
                { text: "เปิดการเจรจาทางการทูตเพื่อแก้ไขข้อพิพาทอย่างสันติ", consequences: { economy: 5, popularity: 10, stability: -5 } },
                { text: "ขอการสนับสนุนทางการทหารจากประเทศมหาอำนาจพันธมิตร", consequences: { economy: -5, popularity: -10, stability: 10 } }
            ]
        },
        {
            text: "กลุ่มทุนขนาดใหญ่พยายามล็อบบี้คุณเพื่อขอสัมปทานในโครงการพลังงานแห่งชาติ โดยเสนอผลประโยชน์มหาศาลให้กับพรรคการเมืองของคุณ",
            choices: [
                { text: "ยอมรับข้อเสนอเพื่อนำเงินมาพัฒนาประเทศ", consequences: { economy: 20, popularity: -20, stability: -10 } },
                { text: "ปฏิเสธข้อเสนอและประกาศจะดำเนินการอย่างโปร่งใส", consequences: { economy: -5, popularity: 15, stability: 5 } },
                { text: "เปิดโอกาสให้ภาคประชาชนเข้ามามีส่วนร่วมในการพิจารณาโครงการ", consequences: { economy: 0, popularity: 10, stability: -5 } }
            ]
        },
        {
            text: "ประชาชนเริ่มเบื่อหน่ายกับสถานการณ์ทางการเมืองที่ไม่แน่นอนและมีการแบ่งฝักแบ่งฝ่ายอย่างรุนแรง ความขัดแย้งทางสังคมทำให้การพัฒนาประเทศเป็นไปอย่างเชื่องช้า",
            choices: [
                { text: "ออกนโยบายปรองดองแห่งชาติและจัดตั้งคณะกรรมการอิสระเพื่อสร้างความเข้าใจ", consequences: { economy: 5, popularity: 15, stability: 15 } },
                { text: "ใช้สื่อของรัฐเพื่อเผยแพร่ข้อมูลด้านดีของรัฐบาลและลดกระแสความขัดแย้ง", consequences: { economy: 0, popularity: 5, stability: 10 } },
                { text: "ปล่อยให้สถานการณ์เป็นไปตามธรรมชาติและเน้นการทำงานด้านเศรษฐกิจเป็นหลัก", consequences: { economy: 10, popularity: -10, stability: -5 } }
            ]
        },
        {
            text: "มีการค้นพบแหล่งทรัพยากรธรรมชาติขนาดใหญ่ในประเทศ แต่มีทั้งผู้สนับสนุนให้เร่งขุดเจาะเพื่อนำรายได้มาใช้พัฒนา และกลุ่มนักอนุรักษ์ที่ต้องการรักษาสภาพแวดล้อม",
            choices: [
                { text: "เร่งการขุดเจาะเพื่อสร้างรายได้มหาศาล", consequences: { economy: 25, popularity: -5, stability: -5 } },
                { text: "ขุดเจาะอย่างระมัดระวังและนำรายได้มาใช้เพื่อฟื้นฟูสิ่งแวดล้อม", consequences: { economy: 10, popularity: 10, stability: 5 } },
                { text: "ประกาศให้พื้นที่ดังกล่าวเป็นเขตอนุรักษ์ธรรมชาติ", consequences: { economy: -10, popularity: 15, stability: 10 } }
            ]
        },
        {
            text: "ระบบสาธารณสุขของประเทศกำลังประสบปัญหาอย่างหนัก โรงพยาบาลขาดแคลนอุปกรณ์และบุคลากรทางการแพทย์ ทำให้ประชาชนเข้าไม่ถึงบริการที่จำเป็น",
            choices: [
                { text: "เพิ่มงบประมาณมหาศาลเพื่อยกระดับโรงพยาบาลและบุคลากร", consequences: { economy: -15, popularity: 20, stability: 10 } },
                { text: "สนับสนุนการแพทย์ทางเลือกและเทคโนโลยีทางการแพทย์จากภาคเอกชน", consequences: { economy: 10, popularity: 5, stability: -5 } },
                { text: "เน้นการสร้างเสริมสุขภาพและป้องกันโรคในชุมชนแทนการรักษา", consequences: { economy: -5, popularity: 10, stability: 5 } }
            ]
        },
        {
            text: "ปัญหาอาชญากรรมในประเทศเพิ่มสูงขึ้นอย่างน่าตกใจ โดยเฉพาะในเมืองใหญ่ ทำให้ประชาชนรู้สึกไม่ปลอดภัยและเกิดความวิตกกังวลในสังคม",
            choices: [
                { text: "เพิ่มกำลังเจ้าหน้าที่ตำรวจและออกกฎหมายที่รุนแรงขึ้นเพื่อปราบปราม", consequences: { economy: -10, popularity: 5, stability: 20 } },
                { text: "แก้ไขปัญหาที่ต้นเหตุด้วยการสร้างงานและพัฒนาการศึกษาในพื้นที่เสี่ยง", consequences: { economy: 10, popularity: 15, stability: 5 } },
                { text: "ประกาศใช้เทคโนโลยี AI และกล้องวงจรปิดเพื่อเฝ้าระวังอาชญากรรม", consequences: { economy: 5, popularity: -5, stability: 10 } }
            ]
        },
        {
            text: "คุณต้องเผชิญกับแรงกดดันจากกลุ่มนักการเมืองฝ่ายค้านที่พยายามรวบรวมเสียงเพื่อลงมติไม่ไว้วางใจรัฐบาลของคุณ พวกเขาชี้ให้เห็นถึงความล้มเหลวในนโยบายหลายด้าน",
            choices: [
                { text: "เปิดเผยข้อมูลการทำงานของรัฐบาลอย่างโปร่งใสและชี้แจงทุกข้อสงสัย", consequences: { economy: 5, popularity: 20, stability: 10 } },
                { text: "เจรจากับฝ่ายค้านเพื่อหาข้อตกลงและหลีกเลี่ยงการลงมติ", consequences: { economy: 5, popularity: -10, stability: 15 } },
                { text: "จัดการแถลงข่าวใหญ่เพื่อโจมตีฝ่ายค้านและระดมมวลชนออกมาสนับสนุน", consequences: { economy: -5, popularity: -5, stability: -10 } }
            ]
        },
        {
            text: "ประเทศเผชิญกับคลื่นผู้ลี้ภัยจำนวนมากจากประเทศเพื่อนบ้านที่เกิดสงครามกลางเมือง คุณจะรับมือกับปัญหานี้อย่างไร?",
            choices: [
                { text: "เปิดพรมแดนรับผู้ลี้ภัยทั้งหมดและจัดสรรงบประมาณช่วยเหลือด้านมนุษยธรรม", consequences: { economy: -15, popularity: 15, stability: -5 } },
                { text: "ปิดพรมแดนและร่วมมือกับนานาชาติเพื่อแก้ไขปัญหาต้นทาง", consequences: { economy: 10, popularity: -10, stability: 10 } },
                { text: "กำหนดโควตารับผู้ลี้ภัยและให้องค์กรเอกชนเข้ามามีบทบาทในการช่วยเหลือ", consequences: { economy: -5, popularity: 5, stability: 0 } }
            ]
        },
        {
            text: "มีการค้นพบแร่ธาตุหายากที่สำคัญต่ออุตสาหกรรมเทคโนโลยีในดินแดนของชนเผ่าพื้นเมือง คุณจะตัดสินใจอย่างไร?",
            choices: [
                { text: "ให้สิทธิ์การทำเหมืองกับบริษัทของรัฐเพื่อควบคุมผลประโยชน์ทั้งหมด", consequences: { economy: 20, popularity: 5, stability: -10 } },
                { text: "เปิดให้บริษัทต่างชาติเข้ามาลงทุนและให้ชนเผ่าพื้นเมืองมีส่วนร่วมและได้รับผลประโยชน์", consequences: { economy: 10, popularity: 10, stability: 5 } },
                { text: "ประกาศให้พื้นที่ดังกล่าวเป็นเขตอนุรักษ์ธรรมชาติ", consequences: { economy: -10, popularity: 15, stability: 10 } }
            ]
        },
        {
            text: "ปัญหาการฉ้อโกงและคอร์รัปชันในระบบราชการกำลังเป็นประเด็นร้อนแรงในสังคม ประชาชนเรียกร้องให้มีการปฏิรูประบบครั้งใหญ่",
            choices: [
                { text: "ตั้งคณะกรรมการอิสระที่มีอำนาจเต็มในการตรวจสอบและลงโทษผู้กระทำผิด", consequences: { economy: -5, popularity: 20, stability: 10 } },
                { text: "ใช้มาตรการทางกฎหมายที่เข้มงวดและเร่งรัดคดีคอร์รัปชัน", consequences: { economy: 0, popularity: 15, stability: 5 } },
                { text: "มุ่งเน้นการปฏิรูประบบการทำงานเพื่อลดโอกาสในการทุจริตในระยะยาว", consequences: { economy: 5, popularity: 10, stability: 10 } }
            ]
        },
        {
            text: "โลกกำลังเข้าสู่ยุคดิจิทัลอย่างเต็มตัว คุณต้องตัดสินใจว่าจะลงทุนในเทคโนโลยีใหม่ๆ อย่างไร เพื่อให้ประเทศไม่ล้าหลัง",
            choices: [
                { text: "ลงทุนมหาศาลในโครงสร้างพื้นฐานด้านดิจิทัลและสร้างนิคมอุตสาหกรรมเทคโนโลยี", consequences: { economy: 25, popularity: 10, stability: 5 } },
                { text: "สนับสนุนการเรียนรู้และพัฒนาบุคลากรในด้านเทคโนโลยี", consequences: { economy: 10, popularity: 15, stability: 10 } },
                { text: "เน้นการควบคุมและกำหนดนโยบายเพื่อป้องกันผลกระทบเชิงลบจากเทคโนโลยีใหม่ๆ", consequences: { economy: 5, popularity: -5, stability: 15 } }
            ]
        },
        {
            text: "ประเทศของคุณได้รับเชิญให้เข้าร่วมกลุ่มพันธมิตรทางทหารที่ทรงอิทธิพล ซึ่งจะทำให้คุณมีความมั่นคงเพิ่มขึ้นแต่ก็เสี่ยงที่จะถูกลากเข้าไปในความขัดแย้งระดับโลก",
            choices: [
                { text: "เข้าร่วมกลุ่มพันธมิตรเพื่อเพิ่มอำนาจการต่อรอง", consequences: { economy: 10, popularity: -10, stability: 20 } },
                { text: "เลือกที่จะรักษาสถานะความเป็นกลางและเน้นการเจรจาทางการทูต", consequences: { economy: 0, popularity: 15, stability: -5 } },
                { text: "สร้างพันธมิตรทางเศรษฐกิจกับประเทศที่มีอำนาจเท่าเทียมกันแทน", consequences: { economy: 15, popularity: 5, stability: -10 } }
            ]
        },
        {
            text: "อัตราเงินเฟ้อในประเทศเพิ่มสูงขึ้นอย่างรวดเร็ว ทำให้ค่าครองชีพของประชาชนพุ่งสูงขึ้นและกำลังซื้อลดลงอย่างมาก",
            choices: [
                { text: "ใช้มาตรการนโยบายการเงินที่เข้มงวด เช่น การขึ้นดอกเบี้ยเพื่อลดเงินเฟ้อ", consequences: { economy: 10, popularity: -10, stability: 5 } },
                { text: "ควบคุมราคาสินค้าอุปโภคบริโภคที่จำเป็นเพื่อบรรเทาความเดือดร้อนของประชาชน", consequences: { economy: -5, popularity: 15, stability: 10 } },
                { text: "ปล่อยให้กลไกตลาดทำงาน และใช้มาตรการช่วยเหลือผู้มีรายได้น้อยโดยตรง", consequences: { economy: 5, popularity: 5, stability: -5 } }
            ]
        },
        {
            text: "เกิดการแพร่ระบาดของโรคอุบัติใหม่ ทำให้ระบบสาธารณสุขและเศรษฐกิจของประเทศได้รับผลกระทบอย่างหนัก",
            choices: [
                { text: "ประกาศมาตรการล็อกดาวน์ที่เข้มงวดเพื่อควบคุมการระบาด", consequences: { economy: -20, popularity: -10, stability: 20 } },
                { text: "เน้นการสื่อสารให้ความรู้และขอความร่วมมือจากประชาชนในการป้องกันตนเอง", consequences: { economy: 5, popularity: 10, stability: 5 } },
                { text: "เร่งพัฒนาและนำเข้าวัคซีนเพื่อฉีดให้ประชาชนโดยเร็วที่สุด", consequences: { economy: -15, popularity: 15, stability: 15 } }
            ]
        },
        {
            text: "โลกกำลังเผชิญกับวิกฤตพลังงานครั้งใหญ่ ราคาพลังงานพุ่งสูงขึ้นและส่งผลกระทบต่อภาคอุตสาหกรรมและครัวเรือนในประเทศของคุณ",
            choices: [
                { text: "เพิ่มการลงทุนในพลังงานหมุนเวียนและลดการพึ่งพาพลังงานฟอสซิลจากต่างประเทศ", consequences: { economy: 10, popularity: 10, stability: 5 } },
                { text: "ให้เงินอุดหนุนราคาพลังงานเพื่อแบ่งเบาภาระของประชาชนและธุรกิจ", consequences: { economy: -10, popularity: 20, stability: 5 } },
                { text: "แสวงหาแหล่งพลังงานใหม่ๆ จากประเทศพันธมิตรทางการเมือง", consequences: { economy: 5, popularity: -5, stability: -10 } }
            ]
        },
        {
            text: "ข่าวลือเรื่องการทุจริตครั้งใหญ่ในรัฐบาลของคุณแพร่กระจายไปทั่วสังคม แม้จะยังไม่มีหลักฐานที่แน่ชัด แต่ความเชื่อมั่นของประชาชนก็ลดลงอย่างรวดเร็ว คุณจะจัดการกับข่าวลือนี้อย่างไร?",
            choices: [
                { text: "แถลงข่าวอย่างหนักแน่นเพื่อปฏิเสธข้อกล่าวหาทั้งหมดและฟ้องร้องผู้ที่ปล่อยข่าว", consequences: { economy: 0, popularity: -25, stability: -10 } },
                { text: "แต่งตั้งคณะกรรมการอิสระมาตรวจสอบข้อเท็จจริงอย่างโปร่งใส", consequences: { economy: -5, popularity: 15, stability: 5 } },
                { text: "เพิกเฉยต่อข่าวลือและมุ่งเน้นการทำงานเพื่อสร้างผลงานให้เป็นที่ประจักษ์", consequences: { economy: 10, popularity: -20, stability: -5 } }
            ]
        },
        {
            text: "มีรายงานข่าวที่เปิดเผยถึงการใช้อำนาจเกินกว่าเหตุของเจ้าหน้าที่ตำรวจในการสลายการชุมนุม ทำให้เกิดกระแสต่อต้านจากประชาชนและองค์กรสิทธิมนุษยชน คุณจะรับผิดชอบต่อเหตุการณ์นี้อย่างไร?",
            choices: [
                { text: "แสดงความเสียใจและตั้งคณะกรรมการสอบสวนเพื่อเอาผิดเจ้าหน้าที่ที่เกี่ยวข้อง", consequences: { economy: -5, popularity: 20, stability: 10 } },
                { text: "ปกป้องการกระทำของเจ้าหน้าที่และอ้างว่าเป็นการกระทำเพื่อรักษาความสงบ", consequences: { economy: 5, popularity: -25, stability: 15 } },
                { text: "ประกาศนโยบายปฏิรูปตำรวจเพื่อเรียกคืนความเชื่อมั่น", consequences: { economy: -10, popularity: 15, stability: -5 } }
            ]
        },
        {
            text: "เศรษฐกิจของประเทศกำลังเติบโตอย่างรวดเร็ว แต่ช่องว่างระหว่างคนรวยและคนจนกลับถ่างออกมากขึ้นเรื่อยๆ ทำให้เกิดความเหลื่อมล้ำทางสังคมอย่างรุนแรง",
            choices: [
                { text: "ออกนโยบายเก็บภาษีคนรวยเพิ่มขึ้นเพื่อนำไปช่วยเหลือคนจนและพัฒนาคุณภาพชีวิต", consequences: { economy: -5, popularity: 15, stability: 10 } },
                { text: "ส่งเสริมการลงทุนและสร้างงานในภาคเอกชน เพื่อให้ประชาชนมีโอกาสหารายได้มากขึ้น", consequences: { economy: 15, popularity: 5, stability: -5 } },
                { text: "จัดโครงการอบรมอาชีพและให้เงินทุนเพื่อสนับสนุนผู้ประกอบการรายย่อย", consequences: { economy: 10, popularity: 10, stability: 5 } }
            ]
        },
    ];

    // Function to update the stats display
    const updateStats = () => {
        popularityStat.textContent = Math.max(0, popularity);
        economyStat.textContent = Math.max(0, economy);
        stabilityStat.textContent = Math.max(0, stability);
        dayStat.textContent = currentDay;
    };

    // Function to check for game over conditions
    const checkGameOver = () => {
        if (popularity <= GAME_OVER_THRESHOLD || economy <= GAME_OVER_THRESHOLD || stability <= GAME_OVER_THRESHOLD) {
            showEndGameMessage("จบเกม! อนาคตของประเทศถึงจุดจบแล้ว ลองพยายามใหม่นะครับ");
            return true;
        }
        if (currentDay >= GAME_LENGTH) {
            // End of the 4-year term, check election results
            checkElectionResults();
            return true;
        }
        return false;
    };

    // Function to check the election results
    const checkElectionResults = () => {
        let message = `สิ้นสุดวาระการบริหาร 4 ปี!\n\nคะแนนความนิยมสุดท้ายของคุณคือ: ${popularity}%\n`;
        if (popularity >= ELECTION_WIN_POPULARITY) {
            message += "\nขอแสดงความยินดี! คุณได้รับความไว้วางใจจากประชาชนและชนะการเลือกตั้ง! คุณจะกลับมาบริหารประเทศต่อในวาระหน้า";
        } else {
            message += "\nน่าเสียดาย! คะแนนความนิยมของคุณไม่เพียงพอที่จะชนะการเลือกตั้ง ทำให้คุณต้องพ่ายแพ้และลงจากตำแหน่ง";
        }
        showEndGameMessage(message, true);
    };

    // Function to display the end game message
    const showEndGameMessage = (message, playBell = false) => {
        if (playBell) {
            // Play multiple bell sounds in a quick succession
            const noteSequence = ["G5", "C6", "G5", "C6"];
            let time = Tone.now();
            noteSequence.forEach((note, index) => {
                bellSynth.triggerAttackRelease(note, "8n", time + index * 0.2);
            });
        }
        const overlay = document.createElement('div');
        overlay.classList.add('message-overlay');
        const box = document.createElement('div');
        box.classList.add('message-box');
        box.innerHTML = `
            <p class="text-xl font-bold mb-4 whitespace-pre-wrap">${message}</p>
            <button onclick="window.location.reload()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md mt-4">เริ่มใหม่</button>
        `;
        document.body.appendChild(overlay);
        document.body.appendChild(box);
        
        // Hide the main game content to prevent further interaction
        document.getElementById('stats-bar').style.display = 'none';
        document.getElementById('game-output').style.display = 'none';
        document.getElementById('choices-container').style.display = 'none';
    };

    // Function to handle player's choice
    const handleChoice = (choice) => {
        // Play click sound on button press
        clickSynth.triggerAttackRelease("C4", "8n");
        
        // Apply consequences, ensuring stats don't exceed 100 or drop below 0
        popularity = Math.min(STATS_LIMIT, Math.max(GAME_OVER_THRESHOLD, popularity + choice.consequences.popularity));
        economy = Math.min(STATS_LIMIT, Math.max(GAME_OVER_THRESHOLD, economy + choice.consequences.economy));
        stability = Math.min(STATS_LIMIT, Math.max(GAME_OVER_THRESHOLD, stability + choice.consequences.stability));
        currentDay++;

        // Update UI and check for game over
        updateStats();
        // Check if the game is over before displaying the next event
        if (!checkGameOver()) {
            displayEvent();
        }
    };

    // Function to display the current game event
    const displayEvent = () => {
        // Get available events that haven't been played yet
        let availableEvents = allEvents.filter(event => !playedEvents.includes(event));
        
        // If all events have been played, reset the list
        if (availableEvents.length === 0) {
            playedEvents = [];
            // Recalculate available events after resetting
            availableEvents = allEvents;
        }

        const randomIndex = Math.floor(Math.random() * availableEvents.length);
        const event = availableEvents[randomIndex];
        
        // Add the chosen event to the list of played events
        playedEvents.push(event);

        gameOutput.innerHTML = `<p>${event.text}</p>`;
        choicesContainer.innerHTML = ''; // Clear previous choices

        event.choices.forEach(choice => {
            const button = document.createElement('button');
            button.classList.add('choice-button');
            button.textContent = choice.text;
            button.onclick = () => handleChoice(choice);
            choicesContainer.appendChild(button);
        });
    };

    // Function to display the game rules
    const showGameRules = () => {
        const message = `
        ยินดีต้อนรับสู่เกมจำลองการเมือง!
        
        กฎกติกา:
        
        - คุณคือผู้นำประเทศที่ต้องบริหารเป็นเวลา 4 ปี (ในเกมเท่ากับ 20 วัน)
        - แต่ละวันจะมีเหตุการณ์สำคัญให้คุณตัดสินใจ
        - การตัดสินใจของคุณจะส่งผลกระทบต่อสถิติหลัก 3 ด้าน:
            1. **ความนิยม (Popularity):** คะแนนความนิยมจากประชาชน
            2. **เศรษฐกิจ (Economy):** สภาพเศรษฐกิจของประเทศ
            3. **ความมั่นคง (Stability):** ความสงบสุขและความมั่นคงในประเทศ
        - เกมจะจบลงเมื่อวาระการบริหารครบ 4 ปี หรือเมื่อสถิติใดสถิติหนึ่งเหลือ 0%
        - เมื่อครบ 4 ปี หากคะแนนความนิยมของคุณตั้งแต่ 50% ขึ้นไป คุณจะชนะการเลือกตั้งและได้บริหารต่อในวาระหน้า
        
        ขอให้สนุกกับเกมครับ!
        `;
        const overlay = document.createElement('div');
        overlay.classList.add('message-overlay');
        const box = document.createElement('div');
        box.classList.add('message-box');
        box.innerHTML = `
            <p class="text-xl font-bold mb-4 whitespace-pre-wrap">${message}</p>
            <button id="start-game-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md mt-4">เริ่มเกม</button>
        `;
        document.body.appendChild(overlay);
        document.body.appendChild(box);

        document.getElementById('start-game-button').onclick = () => {
            document.body.removeChild(overlay);
            document.body.removeChild(box);
            updateStats();
            displayEvent();
        };
    };

    // Function to go back to the main menu (index.html)
    const goBackToMainMenu = () => {
        window.location.href = 'index.html';
    };

    // Start the game by showing the rules first
    window.onload = function() {
        showGameRules();
    };
</script>

</body>
</html>
