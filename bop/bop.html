<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>à¹€à¸à¸¡à¸à¸¶à¸ Braille Chord (Perkins Style) - Bop It! à¹à¸šà¸šà¸›à¸£à¸±à¸š</title>
  <style>
    :root {
      --bg: #0b1220; --card:#121a2b; --text:#e6ecff; --accent:#7cc4ff; --good:#2ecc71; --bad:#ff6b6b; --warning:#f39c12;
    }
    html,body{height:100%;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);-webkit-tap-highlight-color: transparent;}
    .container{max-width:950px;margin:0 auto;padding:16px;}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.08);box-shadow:0 10px 30px rgba(0,0,0,.35);border-radius:18px;padding:20px}
    .card:focus{outline:none;}
    h1{font-size:clamp(20px,4vw,36px);margin:0 0 8px 0}
    h2{font-size:clamp(18px,3vw,24px);margin:0 0 12px 0}
    p{line-height:1.6}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.6rem;padding:14px 18px;border-radius:14px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:var(--text);font-weight:700;cursor:pointer;transition:all 0.2s ease; user-select: none;}
    .btn:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.25)}
    .btn:focus{outline:3px solid var(--accent);outline-offset:2px}
    .btn:active{transform: scale(0.97);}
    .btn[disabled]{opacity:.6;cursor:not-allowed; transform: none;}
    .btn.warning{background:rgba(243,156,18,.1);border-color:rgba(243,156,18,.3);color:var(--warning)}
    .btn.warning:hover{background:rgba(243,156,18,.2)}
    .btn.small{padding:8px 12px;font-size:14px}
    .big{font-size:22px;padding:18px 22px}
    .status{display:flex;gap:12px;flex-wrap:wrap}
    .pill{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12)}
    .flex{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .panel{background:var(--card);border-radius:16px;padding:16px;border:1px solid rgba(255,255,255,.08)}
    .prompt{font-size:clamp(24px,5vw,44px);font-weight:900;letter-spacing:.5px; min-height: 50px;}
    .prompt:focus{outline:none;}
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .footer{opacity:.8; margin-top: 16px; font-size: 0.9em;}
    .stats-actions{margin-top:12px}
    .tap-hint{font-size:0.9em;opacity:0.8;margin-top:8px;font-style:italic}
    
    .mobile-only { display: none; }
    .mobile-controls {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 16px;
    }

    @media (max-width: 768px) {
        .desktop-only { display: none; }
        .mobile-only { display: grid; }
        .container { padding: 12px; }
        .card { padding: 16px; }
        .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="container">
  <button class="flex items-center rounded-md border border-slate-300 py-2 px-4 text-center text-sm transition-all shadow-sm hover:shadow-lg text-slate-600 hover:text-white hover:bg-slate-800 hover:border-slate-800 focus:text-white focus:bg-slate-800 focus:border-slate-800 active:border-slate-800 active:text-white active:bg-slate-800 disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none" type="button" onclick="location.href='../index.html'">
			à¸à¸¥à¸±à¸šà¹€à¸¡à¸™à¸¹à¸«à¸¥à¸±à¸
		   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 ml-1.5">
			<path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd" />
		  </svg>
		</button>
    <section id="game-container" class="card" aria-labelledby="title">
      <h1 id="title">à¹€à¸à¸¡à¸à¸¶à¸à¸à¸” Braille Chord (Perkins Style)</h1>
      <p>à¸à¸”à¸ˆà¸¸à¸”à¹€à¸šà¸£à¸¥à¸¥à¹Œà¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™à¸•à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸¢à¸´à¸™ / à¸­à¹ˆà¸²à¸™</p>
      
      <div class="status" aria-live="polite" aria-atomic="true">
        <div class="pill" id="scorePill" role="status">à¸„à¸°à¹à¸™à¸™: <strong id="score">0</strong></div>
        <div class="pill">à¸ªà¸–à¸´à¸•à¸´à¸ªà¸¹à¸‡à¸ªà¸¸à¸”: <strong id="best">0</strong></div>
        <div class="pill">à¸£à¸­à¸š: <strong id="round">0</strong></div>
        <div class="pill">à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§: <strong id="speed">à¸Šà¹‰à¸²</strong></div>
      </div>

      <div class="stats-actions">
        <button id="clearStatsBtn" class="btn warning" aria-describedby="clearStatsDesc">ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡à¸ªà¸–à¸´à¸•à¸´à¸ªà¸¹à¸‡à¸ªà¸¸à¸”</button>
        <div id="clearStatsDesc" class="sr-only">à¸¥à¹‰à¸²à¸‡à¸„à¸°à¹à¸™à¸™à¸ªà¸¹à¸‡à¸ªà¸¸à¸”à¸—à¸µà¹ˆà¹€à¸à¹‡à¸šà¹„à¸§à¹‰à¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ</div>
        <div id="confirmClear" class="confirm-dialog" style="display:none; margin-top:12px; background:rgba(243,156,18,.1); padding:12px; border-radius:12px; border:1px solid rgba(243,156,18,.3);">
            <p>à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸ªà¸–à¸´à¸•à¸´à¸ªà¸¹à¸‡à¸ªà¸¸à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?</p>
            <div class="flex gap-3 mt-3">
                <button id="confirmClearYes" class="btn warning small">à¹ƒà¸Šà¹ˆ, à¸¥à¹‰à¸²à¸‡à¹€à¸¥à¸¢</button>
                <button id="confirmClearNo" class="btn small">à¹„à¸¡à¹ˆ, à¸¢à¸à¹€à¸¥à¸´à¸</button>
            </div>
        </div>
      </div>

      <div class="grid" style="margin-top:16px">
        <div class="panel">
          <div id="prompt" class="prompt" role="status" aria-live="assertive">à¸à¸” "à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡" à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡</div>
          <div id="sr-aria" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
          <div class="flex gap-3 flex-wrap mt-4">
            <button id="startBtn" class="btn big">â–¶ï¸ à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡</button>
            <button id="stopBtn" class="btn" disabled>â¹ à¸«à¸¢à¸¸à¸”</button>
            <button id="audioModeBtn" class="btn">à¹‚à¸«à¸¡à¸”à¹€à¸ªà¸µà¸¢à¸‡: Audio</button>
          </div>
        </div>
      </div>

    </section>
  </main>

  <!-- Audio files -->
  <audio id="snd-1" preload="auto" src="sounds/1.mp3"></audio>
  <audio id="snd-2" preload="auto" src="sounds/2.mp3"></audio>
  <audio id="snd-3" preload="auto" src="sounds/3.mp3"></audio>
  <audio id="snd-4" preload="auto" src="sounds/4.mp3"></audio>
  <audio id="snd-5" preload="auto" src="sounds/5.mp3"></audio>
  <audio id="snd-6" preload="auto" src="sounds/6.mp3"></audio>
  <audio id="snd-7" preload="auto" src="sounds/7.mp3"></audio>
  <audio id="snd-8" preload="auto" src="sounds/8.mp3"></audio>
  <audio id="snd-9" preload="auto" src="sounds/9.mp3"></audio>

  <audio id="snd-correct" preload="auto" src="sounds/correct.mp3"></audio>
  <audio id="snd-wrong" preload="auto" src="sounds/wrong.mp3"></audio>
  <audio id="snd-tick" preload="auto" src="sounds/tick.mp3"></audio>
  <audio id="snd-start" preload="auto" src="sounds/start.mp3"></audio>
  <audio id="snd-gameover" preload="auto" src="sounds/gameover.mp3"></audio>

  <script>
  (() => {
    const qs = sel => document.querySelector(sel);
    const qsa = sel => Array.from(document.querySelectorAll(sel));

    // DOM Elements
    const gameContainer = qs('#game-container');
    const promptEl   = qs('#prompt');
    const srLive     = qs('#sr-aria');
    const scoreEl    = qs('#score');
    const bestEl     = qs('#best');
    const roundEl    = qs('#round');
    const speedEl    = qs('#speed');
    const startBtn   = qs('#startBtn');
    const stopBtn    = qs('#stopBtn');
    const audioModeBtn = qs('#audioModeBtn');
    const clearStatsBtn = qs('#clearStatsBtn');
    const confirmClearDialog = qs('#confirmClear');
    const confirmClearYesBtn = qs('#confirmClearYes');
    const confirmClearNoBtn  = qs('#confirmClearNo');
    const backBtn    = qs('.container > button[type="button"]');

    // Audio
    const audioBank = {
      1: qs('#snd-1'), 2: qs('#snd-2'), 3: qs('#snd-3'),
      4: qs('#snd-4'), 5: qs('#snd-5'), 6: qs('#snd-6'),
      7: qs('#snd-7'), 8: qs('#snd-8'), 9: qs('#snd-9'),
      correct: qs('#snd-correct'), wrong: qs('#snd-wrong'),
      tick: qs('#snd-tick'), start: qs('#snd-start'),
      gameover: qs('#snd-gameover')
    };

    let audioMode = 'file'; // 'file', 'tts', 'off'

    // Braille â†’ number mapping (à¹ƒà¸Šà¹‰à¹à¸ªà¸”à¸‡à¸œà¸¥à¹à¸¥à¸°à¹€à¸¥à¹ˆà¸™à¹€à¸ªà¸µà¸¢à¸‡)
    const patterns = [
      { num:1, dots:"1"      },
      { num:2, dots:"1,2"    },
      { num:3, dots:"1,4"    },
      { num:4, dots:"1,4,5"  },
      { num:5, dots:"1,5"    },
      { num:6, dots:"1,2,4"  },
      { num:7, dots:"1,2,4,5"},
      { num:8, dots:"1,2,5"  },
      { num:9, dots:"2,4"    }
    ];

    // Key mapping (Perkins style)
    const keyToDot = {
      'f':'1', 'd':'2', 's':'3', 'j':'4', 'k':'5', 'l':'6',
      'à¸”':'1', 'à¸':'2', 'à¸«':'3', 'à¹ˆ':'4', 'à¸²':'5', 'à¸ª':'6'
    };

    // Game state
    let currentPattern = null;
    let pressed = new Set();
    let awaitingInput = false;
    let score = 0;
    let best = Number(localStorage.getItem('braillechord_best')||0);
    let round = 0;
    let timeLimit = 3000;
    let running = false;
    let timer = null;
    let isAudioUnlocked = false;

    bestEl.textContent = best;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Audio & TTS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function stopAllSounds() {
      Object.values(audioBank).forEach(a => {
        if (a && !a.paused) {
          a.pause();
          a.currentTime = 0;
        }
      });
    }

    function speakThai(text) {
      if (audioMode !== 'tts' || !text) return;
      try {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'th-TH';
        u.rate = 1.1;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
      } catch {}
    }

    function play(name) {
      if (audioMode === 'off') return;

      if (audioMode === 'tts') {
        if (name >=1 && name <=9) {
          speakThai(`à¸à¸” ${name}`);
        } else if (name === 'correct') {
          speakThai('à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡');
        } else if (name === 'wrong') {
          speakThai('à¸œà¸´à¸”');
        }
        return;
      }

      // file mode
      const a = audioBank[name];
      if (!a) return;
      a.currentTime = 0;
      a.play().catch(()=>{});
    }

    function vibrate(ms) {
      try { navigator.vibrate?.(ms); } catch {}
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Game logic
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setPrompt(text, cls='') {
      promptEl.className = 'prompt';
      if (cls) promptEl.classList.add(cls);
      promptEl.textContent = text;
      srLive.textContent = text;
    }

    function difficultyLabel(ms) {
      if (ms > 1800) return 'à¸Šà¹‰à¸²';
      if (ms > 1200) return 'à¸›à¸²à¸™à¸à¸¥à¸²à¸‡';
      if (ms > 800)  return 'à¹€à¸£à¹‡à¸§';
      return 'à¹€à¸£à¹‡à¸§à¸¡à¸²à¸';
    }

    function nextRound() {
      awaitingInput = true;
      round++;
      roundEl.textContent = round;

      currentPattern = patterns[Math.floor(Math.random()*patterns.length)];
      const num = currentPattern.num;

      setPrompt(`${num}`);
      play(num);
      vibrate(40);

      pressed.clear();

      clearInterval(timer);
      const deadline = performance.now() + timeLimit;
      let ticked = false;

      timer = setInterval(() => {
        const now = performance.now();
        if (now > deadline) {
          clearInterval(timer);
          fail("à¸Šà¹‰à¸²à¹„à¸›!");
          return;
        }
        if (!ticked && deadline - now < 700) {
          play('tick');
          ticked = true;
        }
      }, 50);
    }

    function succeed() {
      clearInterval(timer);
      awaitingInput = false;
      score++;
      scoreEl.textContent = score;
      setPrompt('à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡!', 'good');
      play('correct');
      vibrate([30,60,30]);

      timeLimit = Math.max(550, Math.floor(timeLimit * 0.94));
      speedEl.textContent = difficultyLabel(timeLimit);

      setTimeout(nextRound, 450);
    }

    function fail(reason='à¸œà¸´à¸”!') {
      if (!running) return;
      awaitingInput = false;
      running = false;
      clearInterval(timer);
      stopAllSounds();
      play('gameover');
      setPrompt(`à¸ˆà¸šà¹€à¸à¸¡: ${reason}`, 'bad');
      vibrate([120,60,120]);

      startBtn.disabled = false;
      stopBtn.disabled = true;

      if (score > best) {
        best = score;
        localStorage.setItem('braillechord_best', best);
        bestEl.textContent = best;
      }

      backBtn.style.display = '';
      gameContainer.removeAttribute('role');
      gameContainer.removeAttribute('tabindex');
      startBtn.focus();
    }

    function startGame() {
      if (running) return;

      // Unlock audio on first interaction
      if (!isAudioUnlocked) {
        Object.values(audioBank).forEach(a => {
          if (a) { a.play().catch(()=>{}); a.pause(); a.currentTime=0; }
        });
        isAudioUnlocked = true;
      }

      play('start');
      running = true;
      score = 0; round = 0; timeLimit = 3000;
      scoreEl.textContent = '0';
      roundEl.textContent = '0';
      speedEl.textContent = difficultyLabel(timeLimit);
      startBtn.disabled = true;
      stopBtn.disabled = false;

      setPrompt('à¹€à¸•à¸£à¸µà¸¢à¸¡à¸•à¸±à¸§...');
      backBtn.style.display = 'none';
      gameContainer.setAttribute('tabindex', '0');
      gameContainer.setAttribute('role', 'application');
      gameContainer.focus();

      setTimeout(nextRound, 1800);
    }

    function stopGame() {
      if (!running) return;
      fail('à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™à¸à¸”à¸«à¸¢à¸¸à¸”');
    }

    function toggleAudioMode() {
      if (audioMode === 'file') {
        audioMode = 'tts';
        audioModeBtn.textContent = 'à¹‚à¸«à¸¡à¸”à¹€à¸ªà¸µà¸¢à¸‡: TTS';
        stopAllSounds();
      } else if (audioMode === 'tts') {
        audioMode = 'off';
        audioModeBtn.textContent = 'à¹‚à¸«à¸¡à¸”à¹€à¸ªà¸µà¸¢à¸‡: à¸›à¸´à¸”';
        speechSynthesis.cancel();
      } else {
        audioMode = 'file';
        audioModeBtn.textContent = 'à¹‚à¸«à¸¡à¸”à¹€à¸ªà¸µà¸¢à¸‡: Audio';
      }
    }

    function handleClearStatsRequest() {
      confirmClearDialog.style.display = 'block';
      clearStatsBtn.style.display = 'none';
    }

    function confirmClearAction() {
      best = 0;
      localStorage.removeItem('braillechord_best');
      bestEl.textContent = '0';
      setPrompt('à¸¥à¹‰à¸²à¸‡à¸ªà¸–à¸´à¸•à¸´à¹à¸¥à¹‰à¸§');
      vibrate([50,50,50]);
      setTimeout(() => {
        if (!running) setPrompt('à¸à¸” "à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡" à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡');
      }, 1500);
      cancelClearAction();
    }

    function cancelClearAction() {
      confirmClearDialog.style.display = 'none';
      clearStatsBtn.style.display = 'inline-flex';
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Input: Chord detection (à¸à¸”à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('keydown', e => {
      if (!running || !awaitingInput) return;

      const key = e.key.toLowerCase();
      if (!(key in keyToDot)) return;

      e.preventDefault();
      const dot = keyToDot[key];

      if (!pressed.has(dot)) {
        pressed.add(dot);
        checkChord();
      }
    });

    window.addEventListener('keyup', e => {
      if (!running || !awaitingInput) return;

      const key = e.key.toLowerCase();
      if (!(key in keyToDot)) return;

      const dot = keyToDot[key];
      pressed.delete(dot);
    });

    function checkChord() {
      if (!currentPattern) return;

      const required = new Set(currentPattern.dots.split(',').map(d=>d.trim()));
      if (pressed.size < required.size) return;

      // à¸–à¹‰à¸²à¸à¸”à¹€à¸à¸´à¸™ â†’ à¸œà¸´à¸”à¸—à¸±à¸™à¸—à¸µ
      if (pressed.size > required.size) {
        fail('à¸à¸”à¹€à¸à¸´à¸™à¸ˆà¸¸à¸”');
        return;
      }

      // à¸•à¸£à¸‡à¸à¸±à¸™à¸«à¸¡à¸” â†’ à¸–à¸¹à¸
      if ([...pressed].every(d => required.has(d))) {
        succeed();
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Event listeners
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    startBtn.addEventListener('click', startGame);
    stopBtn.addEventListener('click', stopGame);
    audioModeBtn.addEventListener('click', toggleAudioMode);
    clearStatsBtn.addEventListener('click', handleClearStatsRequest);
    confirmClearYesBtn.addEventListener('click', confirmClearAction);
    confirmClearNoBtn.addEventListener('click', cancelClearAction);

  })();
  </script>
</body>
</html>